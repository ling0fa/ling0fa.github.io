<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>å­¦ä¹ ç¬”è®°ï¼šScalaçš„Optionä»¥åŠå…¶ä»–å®¹å™¨ | ç‹ä¹å¿ƒçš„åšå®¢</title>
  
  
  <meta name="description" content="æœ¬æ–‡ä¸»è¦æ€»ç»“Optionã€Eitherã€Tryå®¹å™¨ã€‚æœ€åç®€å•ä»‹ç»ä¸‹Scalaç¬¬ä¸‰æ–¹åº“çš„Validationç±»ã€‚ æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚
1ã€Option å®¹å™¨
Optionå®¹å™¨æ¯”è¾ƒå¸¸è§ï¼ŒJava8å’ŒJavaç¬¬ä¸‰æ–¹åº“G">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="å­¦ä¹ ç¬”è®°ï¼šScalaçš„Optionä»¥åŠå…¶ä»–å®¹å™¨"/>
  <meta property="og:site_name" content="ç‹ä¹å¿ƒçš„åšå®¢"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ç‹ä¹å¿ƒçš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">ç‹ä¹å¿ƒçš„åšå®¢</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-04T03:11:14.000Z"><a href="/2016/09/04/scala-option-and-others/">2016-09-04</a></time>
      
      
  
    <h1 class="title">å­¦ä¹ ç¬”è®°ï¼šScalaçš„Optionä»¥åŠå…¶ä»–å®¹å™¨</h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“Optionã€Eitherã€Tryå®¹å™¨ã€‚æœ€åç®€å•ä»‹ç»ä¸‹Scalaç¬¬ä¸‰æ–¹åº“çš„Validationç±»ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<h3 id="1ã€Option-å®¹å™¨"><a href="#1ã€Option-å®¹å™¨" class="headerlink" title="1ã€Option å®¹å™¨"></a>1ã€Option å®¹å™¨</h3><ol>
<li>Optionå®¹å™¨æ¯”è¾ƒå¸¸è§ï¼ŒJava8å’ŒJavaç¬¬ä¸‰æ–¹åº“Guavaé‡Œéƒ½æœ‰ç±»ä¼¼çš„å®ç°ã€‚  </li>
<li>Scalaé‡Œå¸¸è§çš„å®¹å™¨åƒListã€Mapç­‰éƒ½å¯ä»¥ä½¿ç”¨foræ¨å¯¼å¼ï¼ŒScalaçš„foræ¨å¯¼å¼æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«å±•å¼€ä¸ºå¯¹foreachã€mapã€flatMapã€withFilterçš„è°ƒç”¨ï¼ŒOptionå®ç°äº†è¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨foræ¨å¯¼å¼ä¸­ä½¿ç”¨Optionå®¹å™¨ã€‚</li>
<li>Optionçš„APIå®šä¹‰ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Option</span>[+<span class="type">A</span>] </span>&#123; self =&gt;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isEmpty</span></span>: <span class="type">Boolean</span> <span class="comment">// å­ç±»ä¼šå®ç°è¿™ä¸ªå˜é‡</span></div><div class="line"></div><div class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">foreach</span></span>[<span class="type">U</span>](f:<span class="type">A</span> =&gt; <span class="type">U</span>): <span class="type">Unit</span> =</div><div class="line">    <span class="keyword">if</span> (!isEmpty) f(<span class="keyword">this</span>.get)</div><div class="line"></div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>sealed</code>å…³é”®å­—é™å®šå­ç±»å¿…é¡»å’Œçˆ¶ç±»åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œ<code>self</code>æ˜¯Optionçš„åˆ«åï¼Œ<code>final</code>é™åˆ¶å­ç±»é‡å†™ï¼Œå…¶ä½™æ–¹æ³•å®šä¹‰å’Œforeachç±»ä¼¼ã€‚</p>
<h3 id="2ã€Someå’ŒNone"><a href="#2ã€Someå’ŒNone" class="headerlink" title="2ã€Someå’ŒNone"></a>2ã€Someå’ŒNone</h3><ol>
<li>è¿™ä¸¤ä¸ªæ˜¯Optionçš„å­ç±»ï¼Œåˆ†åˆ«æ˜¯éç©ºå¯¹è±¡å’Œç©ºå¯¹è±¡ã€‚</li>
<li>ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•ï¼Œåªæœ‰å½“Optionä¸ºéç©ºæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ä¼ å…¥çš„å‡½æ•°å‚æ•°ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿‡æ»¤å‡ºç»“æœé‡Œçš„éç©ºç»“æœã€‚åˆ†å¸ƒå¼ä»»åŠ¡æ”¶é›†ç»“æœä¹Ÿä¼šåˆ©ç”¨äº†è¿™ä¸ªç‰¹æ€§ã€‚</li>
<li>ç¤ºä¾‹ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> results: <span class="type">Seq</span>[<span class="type">Option</span>[<span class="type">Int</span>]] = <span class="type">Vector</span>(<span class="type">Some</span>(<span class="number">10</span>), <span class="type">Some</span>(<span class="number">20</span>), <span class="type">None</span>)</div><div class="line"><span class="keyword">val</span> results2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results</div><div class="line">&#125; <span class="keyword">yield</span> (<span class="number">2</span> * i)</div><div class="line"><span class="comment">// results2:Seq[Int] = Vector(20, 40)</span></div></pre></td></tr></table></figure>
<p><code>Some(i) &lt;- results</code>ä¼šå¯¹resultsé‡Œçš„å…ƒç´ è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œç§»é™¤Noneå…ƒç´ ï¼Œå¹¶æŠ½å–åŒ…å«çš„æ•°å€¼ã€‚åˆ©ç”¨foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™ï¼Œå¯ä»¥è½¬åŒ–ä¸ºï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">val</span> result2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results withFilter &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; <span class="literal">true</span></div><div class="line">    <span class="keyword">case</span> <span class="type">None</span> =&gt; <span class="literal">false</span></div><div class="line">  &#125; map &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; (<span class="number">2</span> * i)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mapé‡Œçš„caseä¼šäº§ç”Ÿè­¦å‘Šï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œåœ¨withFilteré‡Œå·²ç»è¿‡æ»¤äº†Noneçš„æƒ…å†µï¼Œè¿è¡Œæ—¶ä»£ç ä¸ä¼šæŠ¥MatchErrorã€‚<br>åº”ç”¨ï¼šå¯¹ä¸€ç»„å€¼åšåˆæ³•æ€§æ£€æŸ¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Option</span>[<span class="type">Int</span>] = </div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Some</span>(i) <span class="keyword">else</span> <span class="type">None</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = Some(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>) <span class="comment">// ä¸€æ—¦è¿™é‡Œè¿”å›Noneï¼Œåç»­è¡¨è¾¾å¼ä¼šåœæ­¢æ‰§è¡Œï¼Œæ‰€ä»¥ä¸‹ä¸€å¥å¯ä»¥å¼•ç”¨i2å˜é‡</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = None</span></div></pre></td></tr></table></figure>
<h3 id="3ã€Eitherå®¹å™¨"><a href="#3ã€Eitherå®¹å™¨" class="headerlink" title="3ã€Eitherå®¹å™¨"></a>3ã€Eitherå®¹å™¨</h3><ol>
<li>Optionå®¹å™¨çš„Noneæœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸èƒ½è¿”å›ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›å€¼ã€‚æ­¤æ—¶Eitheræ˜¯æ›¿ä»£Optionçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¸å…¶å­—é¢æ„æ€ä¸€è‡´ï¼ŒOptionè¡¨ç¤ºå«æœ‰0æˆ–1ä¸ªå…ƒç´ ï¼ŒEitherè¡¨ç¤ºå«æœ‰è¿™ä¸ªæˆ–é‚£ä¸ªå…ƒç´ ã€‚  </li>
<li>Eitherçš„å®šä¹‰ï¼š<code>sealed abstract class Either[+A, +B] extends AnyRef</code>ï¼ŒAã€Bè¡¨ç¤ºEitherå¯¹è±¡å¯ä»¥æŒæœ‰çš„å¯¹è±¡ç±»å‹ï¼ˆå¯ä»¥ä¸åŒï¼‰ï¼ŒåŠ å·è¡¨ç¤ºå‚æ•°æ˜¯åå˜çš„ã€‚  </li>
<li>Eitheræœ‰ä¸¤ä¸ªå­ç±»ï¼Œ<code>Left[A]</code>å’Œ<code>Right[B]</code>ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå­ç±»ä»ä¸¤ä¸ªå¯èƒ½çš„å…ƒç´ ä¸­é€‰ä¸€ä¸ªã€‚Eitherçš„å†å²æ—©äºScalaï¼Œçº¦å®šç”¨Leftæ¥è¡¨ç¤ºé”™è¯¯ï¼ŒRightè¡¨ç¤ºæ­£å¸¸è¿”å›ç»“æœã€‚  </li>
<li>ç¤ºä¾‹ï¼šç”¨Eitheré‡å†™å‰é¢çš„ğŸŒ°ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Int</span>] =</div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Right</span>(i) <span class="keyword">else</span> <span class="type">Left</span>(<span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>).right</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>).right</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Right(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Left(non-positive number -5)</span></div></pre></td></tr></table></figure>
<p>å’Œå‰é¢ä¸€æ ·ï¼Œä¸€æ—¦è°ƒç”¨<code>.right</code>è¿”å›çš„æ˜¯Leftç±»å‹æ—¶ï¼Œè°ƒç”¨ç»“æŸï¼Œåé¢çš„ä¸å†æ‰§è¡Œã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œç›®å‰æ¥çœ‹ï¼ŒLeftå’ŒRightéƒ½å¯ä»¥è°ƒç”¨<code>left</code>å’Œ<code>right</code>æ–¹æ³•ï¼Œåˆ†åˆ«è¿”å›LeftProjectionå’ŒRightProjectionå®ä¾‹ï¼Œä½†å†å¯¹LeftProjectionå’ŒRightProjectionå–å€¼æ—¶ï¼Œforæ¨å¯¼å¼å¯ä»¥è‡ªå·±æ¨å¯¼å‡ºæ¥ã€‚æ¯”å¦‚ï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> <span class="type">L</span> = <span class="type">Left</span>(<span class="number">33</span>)</div><div class="line"><span class="keyword">val</span> left = <span class="type">L</span>.left      <span class="comment">// left = LeftProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> lvalue = left.get  <span class="comment">// lvalue = 33</span></div><div class="line"><span class="keyword">val</span> right = <span class="type">L</span>.right    <span class="comment">// right = RightProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> rvalue = right.get <span class="comment">// NoSuchElementException</span></div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹2ï¼Œå¯¹äºå‡ºç°å¼‚å¸¸çš„æƒ…å†µï¼Œå¯ä»¥å°†å¼‚å¸¸åˆ—åœ¨è¿”å›å€¼çš„Eitherå·¦å€¼é‡Œï¼Œä¸å†é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ•è·è°ƒç”¨å †æ ˆä¸­æŸäº›åº”ç”¨çš„æ§åˆ¶æƒï¼ŒåŒæ—¶è°ƒç”¨è€…æ›´èƒ½æ˜ç™½APIçš„å«ä¹‰ã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">addInts</span></span>(s1: <span class="type">String</span>, s2: <span class="type">String</span>): <span class="type">Either</span>[<span class="type">NumberFormatException</span>,<span class="type">Int</span>] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="type">Right</span>(s1.toInt + s2.toInt)</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> nfe: <span class="type">NumberFormatException</span> =&gt; <span class="type">Left</span>(nfe)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">println(addInts(<span class="string">"11"</span>, <span class="string">"22"</span>)) <span class="comment">// Right(33)</span></div><div class="line">println(addInts(<span class="string">"f"</span>, <span class="string">"33"</span>))  <span class="comment">// Left(java.lang.NumberFormatException: For input string: "f")</span></div></pre></td></tr></table></figure></p>
<h3 id="4ã€Tryå®¹å™¨"><a href="#4ã€Tryå®¹å™¨" class="headerlink" title="4ã€Tryå®¹å™¨"></a>4ã€Tryå®¹å™¨</h3><ol>
<li>scala.util.Tryçš„ç»“æ„å’ŒEitherç±»ä¼¼ï¼Œæœ‰ä¸¤ä¸ªå­ç±»Successå’ŒFailureï¼ŒSuccessä¸Rightç›¸ä¼¼ï¼Œä¿å­˜æ­£å¸¸çš„è¿”å›å€¼ï¼ŒFailureä¸Leftç›¸ä¼¼ï¼Œä½†æ€»æ˜¯åŒ…å«Throwableå¯¹è±¡ï¼Œæ‰€ä»¥Tryçš„å®šä¹‰åªæœ‰ä¸€ä¸ªæ³›å‹å‚æ•°ï¼š<code>sealed abstract class Try[+T] extends AnyRef</code>ã€‚</li>
<li>ç¤ºä¾‹ï¼šä»ä¸€ç»„Tryå€¼ä¸­ï¼Œè¿‡æ»¤æ‰Failureå¯¹è±¡ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scala.util.&#123;<span class="type">Try</span>, <span class="type">Success</span>, <span class="type">Failure</span>&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>): <span class="type">Try</span>[<span class="type">Int</span>] = <span class="type">Try</span> &#123;</div><div class="line">  assert(i &gt; <span class="number">0</span>, <span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line">  i</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Success(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Failure(java.lang.AssertionError: assert failed: non-positive number -5)</span></div></pre></td></tr></table></figure>
<h3 id="5ã€Scalazæä¾›çš„Validationç±»"><a href="#5ã€Scalazæä¾›çš„Validationç±»" class="headerlink" title="5ã€Scalazæä¾›çš„Validationç±»"></a>5ã€Scalazæä¾›çš„Validationç±»</h3><ol>
<li>ä»¥ä¸Šä»‹ç»çš„å®¹å™¨ï¼Œåœ¨foræ¨åˆ°ä¸­é‡åˆ°ä¸æ»¡è¶³æƒ…å†µä¼šç«‹å³åœæ­¢ï¼Œå¦‚æœæƒ³æ”¶é›†æ‰€æœ‰æ‰€æœ‰æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼Œå¹¶åˆ¤æ–­åé¢æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œå…¸å‹çš„åœºæ™¯å°±æ˜¯éªŒè¯ç½‘é¡µè¡¨å•ï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡å°†æ‰€æœ‰é”™è¯¯ä¿¡æ¯è¿”å›ã€‚Scalaæ ‡å‡†åº“æ— æ³•æä¾›è¿™æ ·çš„åŠŸèƒ½ï¼Œç¬¬ä¸‰æ–¹åº“Scalazæä¾›äº†Validationæ»¡è¶³è¿™ç§éœ€æ±‚ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scalaz._, std.<span class="type">AllInstance</span>._</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validName</span></span>(key: <span class="type">String</span>, name: <span class="type">String</span>): </div><div class="line">        <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">val</span> n = name.trim</div><div class="line">  <span class="keyword">if</span> (n.length &gt; <span class="number">0</span> &amp;&amp; n.matches(<span class="string">""</span><span class="string">"^\p&#123;Alpha&#125;$"</span><span class="string">""</span>)) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; n))</div><div class="line">  <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> &lt;<span class="subst">$n</span>&gt;"</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(key: <span class="type">String</span>, n: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">val</span> i = n.toInt</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; i))</div><div class="line">    <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> <span class="subst">$i</span>"</span>))</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> _: java.lang.<span class="type">NumberFormatException</span> =&gt; <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"<span class="subst">$n</span> is not a Integer"</span>))</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validForm</span></span>(firstName: <span class="type">String</span>, lastName: <span class="type">String</span>, age: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  validName(<span class="string">"first-name"</span>, firstName) </div><div class="line">  +++ validName(<span class="string">"last-name"</span>, lastName) </div><div class="line">  +++ positive(<span class="string">"age"</span>, age)</div><div class="line">&#125;</div><div class="line"></div><div class="line">validForm(<span class="string">"Dean"</span>, <span class="string">"Wampler"</span>, <span class="string">"29"</span>)</div><div class="line"><span class="comment">// Success(List((first-name,Dean),(last-name,Wampler),(age,29)))</span></div><div class="line"></div><div class="line">validForm(<span class="string">""</span>, <span class="string">"Wampler"</span>, <span class="string">"0"</span>)</div><div class="line"><span class="comment">// Failure(List(Invalid first-name &lt;&gt;, Invalid age 0))</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„Successå’ŒFailureå’ŒTryçš„ä¸¤ä¸ªå­ç±»ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚</p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/scala/">scala</a>, <a href="/tags/Option/">Option</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Kommentare</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://yoursite.com/2016/09/04/scala-option-and-others/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 ç‹ä¹å¿ƒçš„åšå®¢
  
  <p>Theme by <a href="https://caisiduo.xyz" target="_blank">LightOne</a></p>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
