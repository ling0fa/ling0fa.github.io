<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ç‹ä¹å¿ƒçš„åšå®¢</title>
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="ç‹ä¹å¿ƒçš„åšå®¢"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ç‹ä¹å¿ƒçš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">ç‹ä¹å¿ƒçš„åšå®¢</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T12:08:21.000Z"><a href="/2016/09/11/a-refactor-of-threads-calling/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/a-refactor-of-threads-calling/">è®°ä¸€æ¬¡å¤šçº¿ç¨‹è°ƒç”¨çš„é‡æ„ä¼˜åŒ–</a></h1>
  

    </header>
    <div class="entry">
      
        <blockquote>
<p>è¿™æ¬¡é‡æ„å¯¹æ•ˆç‡ä¸Šæœ‰å°å¹…æå‡ï¼Œä½†å¤§å¤§çš„ç®€åŒ–äº†è°ƒç”¨æ–¹å¼ï¼Œå¯¹åº”çš„ä»£ç ä¹Ÿå‡å°‘äº†å¾ˆå¤šã€‚</p>
</blockquote>
<p>&emsp;&emsp;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œé¡¹ç›®é‡Œæ•°æ®åº“åˆ†äº†åº“ï¼Œéœ€è¦åˆ†åº“è°ƒç”¨ï¼Œäºæ˜¯è€å‘˜å·¥å†™äº†ä¸€ä¸ªå·¥å…·ï¼Œå½“ä¸€ä¸ªè¯·æ±‚æ¥äº†åï¼ŒæŠŠè¯·æ±‚å°è£…æˆä¸€ä¸ªTaskï¼ŒæŠŠTaskä¸¢ç»™çº¿ç¨‹æ± å–æ‰§è¡Œï¼Œç„¶åå¾ªç¯ç­‰å¾…æ‰§è¡Œç»“æœã€‚ä¸‹é¢å¤§æ¦‚è¯´ä¸‹å„ä¸ªç±»çš„ä»£ç ï¼Œä¸ä¸€å®šèƒ½ç¼–è¯‘è¿‡ï¼Œå‡­è®°å¿†å†™ã€‚</p>
<p>1ã€Taskç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Object&gt; results;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String dbKey, Object object, String methodName, Object ... args)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        TaskIdentity.setIdentity(dbKey);</div><div class="line">        <span class="comment">// .......</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// other methods</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;ä¸Šé¢resultsç”¨æ¥ä¿å­˜æ‰§è¡Œå®Œåçš„ç»“æœï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªç»“æœï¼Œä¹Ÿè¿”å›åŒ…å«ä¸€ä¸ªå…ƒç´ çš„Listã€‚æ„é€ å‡½æ•°æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ•°æ®åº“åˆ†åº“çš„è·¯ç”±ï¼Œç”±è°ƒç”¨è€…çš„å‚æ•°å†³å®šã€‚ç¬¬äºŒä¸ªæ˜¯è¦è°ƒç”¨çš„æ–¹æ³•æ‰€åœ¨çš„ç±»çš„å®ä¾‹ï¼ˆå¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼‰ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è°ƒç”¨çš„æ–¹æ³•çš„å­—ç¬¦ä¸²å½¢å¼ï¼ˆå¯¹ï¼Œæ˜¯è¿™æ ·çš„ï¼‰ï¼Œæœ€åä¸€ä¸ªæ˜¯è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œæœ‰äº†ä»¥ä¸Šä¿¡æ¯ï¼Œé€šè¿‡åå°„æ¥ç¡®å®šè¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚<br>&emsp;&emsp;è®¾è®¡è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯å¯ä»¥ä¿æŒä»»ä½•ç±»å‹çš„ç»“æœï¼Œç”¨äº†List<object>ï¼Œä¸ºäº†å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„æ–¹æ³•ï¼Œæ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªå‚æ•°éƒ½è®¾è®¡çš„æœ‰ç‚¹è¿åç›´è§‰ï¼Œæœ€åä¹Ÿæ˜¯ä¸ºäº†æ¥å—ä»»æ„å‚æ•°ï¼Œä½¿ç”¨Objectçš„å¯å˜å‚æ•°ã€‚<br>&emsp;&emsp;æœ€åï¼ŒTaské‡Œè¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†å‚æ•°çš„åŒ¹é…é—®é¢˜ã€‚å› ä¸ºå‚æ•°åˆ—è¡¨å¯èƒ½æ˜¯åŸç”Ÿç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åŒ…è£…ç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯äºŒè€…çš„æ··åˆï¼Œè¿˜ä¼šåŠ ä¸Šå…¶ä»–å¼•ç”¨ç±»å‹ä»€ä¹ˆçš„ã€‚æˆ‘æ›¾ç»å°è¯•é‡å†™é‡Œé¢é€šè¿‡æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç¡®å®šæ˜¯å“ªä¸ªæ–¹æ³•çš„å‡½æ•°ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ŒåŸå› å°±æ˜¯ä¼ åŸç”Ÿç±»å‹å’ŒåŒ…è£…ç±»å‹æ—¶ï¼Œé€šè¿‡åå°„æ˜¯ä¸èƒ½ç¡®å®šåˆ°åº•æ˜¯å“ªä¸€ä¸ªã€‚æ‰€ä»¥é‡Œé¢é€šè¿‡åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å‚æ•°ç»„åˆï¼Œæ¥åå°„å¯¹åº”çš„æ–¹æ³•ï¼Œç›´åˆ°åå°„æˆåŠŸä¸ºæ­¢ï¼ˆæˆ‘è§‰å¾—ä¹Ÿåªèƒ½è¿™æ ·çš„äº†ï¼‰ã€‚<br>&emsp;&emsp;æ€»ä¹‹ï¼ŒåŠŸèƒ½è¿˜æ˜¯å®ç°äº†ï¼Œåå°„ä¹Ÿåå°„æˆåŠŸäº†ï¼Œåªæ˜¯å®ç°çš„æœ‰äº›ä¸‘é™‹ï¼Œä¸ä¼˜ç¾ï¼Œæ•´ä¸ªç±»æœ‰300è¡Œä»¥ä¸Šçš„ä»£ç ã€‚</object></p>
<p>2ã€TaskIndentityç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskIdentity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; identity = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setIdentity</span><span class="params">(String dbKey)</span> </span>&#123;</div><div class="line">        identity.set(dbKey);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getIdentity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> identity.get();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;è¿™ä¸ªç±»æ²¡å•¥è¯´çš„ï¼Œå°±æ˜¯å¯¹çº¿ç¨‹ä¿å­˜å½“å‰æ‰§è¡Œå¯¹åº”çš„æ•°æ®åº“æ ‡è¯†ï¼Œåœ¨çº¿ç¨‹åˆšå¼€å§‹æ‰§è¡Œå‰è°ƒç”¨setIndentityï¼ŒçœŸæ­£è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ•°æ®åº“è¿æ¥ï¼ˆSpringæ¥å®Œæˆï¼‰ã€‚   </p>
<p>3ã€TaskExecutorç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskExecutor</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">submitSelectTask</span><span class="params">(List&lt;Task&gt; tasks)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">submitUpdateTask</span><span class="params">(List&lt;Task&gt; tasks)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå·¥å…·ç±»ã€‚é‡Œé¢æœ‰ä¸€ä¸ªçº¿ç¨‹æ± å˜é‡ï¼Œç”¨æ¥æ‰§è¡Œä»»åŠ¡ã€‚å‚æ•°éƒ½æ˜¯ä»»åŠ¡çš„åˆ—è¡¨ï¼ˆæƒ³è¦†ç›–ä¸€ä¸ªä»»åŠ¡æˆ–å¤šä¸ªä»»åŠ¡çš„æƒ…å†µï¼‰ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŸ¥è¯¢ç±»ä»»åŠ¡ï¼Œä¾æ¬¡æäº¤äº†æ‰€æœ‰ä»»åŠ¡åï¼Œåœ¨åé¢å¾ªç¯ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå®Œæˆåå–å‡ºæ‰€æœ‰ç»“æœï¼Œå†å¼ºåˆ¶å°†Objectç±»å‹ç»“æœè½¬æ¢ä¸ºè¿”å›çš„Tç±»å‹ã€‚å…¶å®åœ¨å¾ªç¯ç­‰å¾…ç»“æœå‰ï¼Œä»£ç é‡Œä¼šç¡çœ 10æ¯«ç§’ï¼ˆåŸä½œè€…è¿™æ ·å†™çš„ï¼‰ã€‚<br>&emsp;&emsp;ç¬¬äºŒä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œæ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥ä»»åŠ¡ï¼Œè¿”å›å€¼æŒ‰ç†è¯´æ˜¯æ•´å½¢ï¼Œä¸è¿‡è®¾è®¡çš„æ—¶å€™æ²¡æœ‰æŠŠè¿™äº›å€¼è¿”å›ï¼Œè¿”å›çš„æ„ä¹‰ä¹Ÿä¸å¤§ï¼Œæ¯•ç«Ÿæ‰§è¡Œäº†å¤šä¸ªä»»åŠ¡ã€‚æ•´ä¸ªç±»å¤§æ¦‚æœ‰100~200è¡Œä»£ç ã€‚   </p>
<p>4ã€å¥½äº†ï¼Œä»‹ç»å®Œä¸Šé¢çš„ç±»ï¼Œç»ˆäºå¯ä»¥è¯´æ€ä¹ˆè°ƒç”¨äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Task task = <span class="keyword">new</span> Task(<span class="string">"dbkey"</span>, SomeObject.instance(), <span class="string">"someMethod"</span>, <span class="string">"hello"</span>, <span class="string">"world"</span>);</div><div class="line">List&lt;Task&gt; tasks = Arrays.asList(task);</div><div class="line">List&lt;String&gt; ret = TaskExecutor.submitSelectTask(tasks);</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¦‚ä¸Šã€‚åœ¨new Taskå¯¹è±¡çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Objectç±»å‹ï¼Œæ‰€ä»¥ä¼ ä»»ä½•å¼•ç”¨ç±»å‹éƒ½ä¸ä¼šæŠ¥é”™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¼ ä»»æ„çš„å­—ç¬¦ä¸²éƒ½å¯ä»¥ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯å¯å˜é•¿åº¦ï¼Œä¼ ä»»æ„ä¸ªå‚æ•°ä¹Ÿä¸ä¼šç¼–è¯‘å™¨æŠ¥é”™ã€‚æˆ‘åœ¨ä½¿ç”¨è¿™å¥—ä»£ç æä¾›çš„æ¥å£ï¼Œå¶å°”å°±ä¼šå¿˜äº†æ”¹å‚æ•°ï¼Œå¯¼è‡´åˆ°è¿è¡Œæ—¶æ‰æŠ¥é”™ï¼Œæå¾—å¾ˆå¤´ç—›ã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯æ²¡æœ‰åˆ©ç”¨Javaçš„å¼ºç±»å‹ç‰¹æ€§ï¼Œåœ¨ç¼–è¯‘æœŸæ¥é¢„é˜²é”™è¯¯çš„å‚æ•°ä¼ å…¥ã€‚   </p>
<p>5ã€é‡æ„åçš„ä»£ç <br>&emsp;&emsp;ä¸Šé¢çš„è¿™å¥—ä»£ç å…¶å®æœ‰ä¸ªè¯¯åŒºï¼Œå°±æ˜¯æƒ³æŠŠæ‰€æœ‰çš„è°ƒç”¨å°è£…èµ·æ¥ï¼Œç»Ÿä¸€å…¥å£å’Œç»Ÿä¸€å‡ºå£ã€‚å…¶å®æ ¹æœ¬ä¸ç”¨å°è£…ï¼Œåœ¨ä¸åŒçš„å¯¹å¤–æ¥å£é‡Œï¼Œèµ·ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å¯¹åº”çš„æ¥å£å°±è¡Œäº†ã€‚<br>&emsp;&emsp;é¦–å…ˆå¯¹æ‰§è¡Œä»»åŠ¡çš„å·¥å…·ç±»é‡æ„ï¼Œä¸å†å°è£…Taskï¼Œç›´æ¥æ¥æ”¶ä¸€ä¸ªCallableå­ç±»æˆ–Runnableå­ç±»ï¼Œæ•´ä¸ªå·¥å…·ç±»ä¹Ÿä¸ç”¨å»å¼ºè½¬ç»“æœçš„ç±»å‹ï¼Œä¹Ÿä¸ç”¨å¾ªç¯ç­‰å¾…ç»“æœï¼Œè°ƒç”¨æ˜¯é˜»å¡ï¼ŒTaskExceptionæ˜¯è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskExecutor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService service = Executors.newFixedThreadPool(<span class="number">8</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V&gt; <span class="function">V <span class="title">submitTask</span><span class="params">(Callable&lt;V&gt; callable)</span> <span class="keyword">throws</span> TaskException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> service.submit(callable).get(<span class="number">10</span>, TimeUnit.SECONDS);</div><div class="line">        &#125; <span class="keyword">catch</span> (RejectedExecutionException | InterruptedException | ExecutionException | TimeoutException e) &#123;</div><div class="line">            <span class="comment">// log</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TaskException(e.getMessage());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">submitTask</span><span class="params">(Runnable runnable)</span> <span class="keyword">throws</span> TaskException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            service.submit(runnable);</div><div class="line">        &#125; <span class="keyword">catch</span> (RejectedExecutionException e) &#123;</div><div class="line">            <span class="comment">// log</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TaskException(e.getMessage());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;æœ€åçœ‹ä¸‹æ€ä¹ˆè°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; ret = TaskExecutor.submitTask(<span class="keyword">new</span> Callable&lt;List&lt;String&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        TaskIdentity.setIdentity(<span class="string">"dbkey"</span>);</div><div class="line">        <span class="keyword">return</span> SomeObject.someMethod(<span class="string">"param1"</span>, <span class="string">"param2"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;åœ¨è°ƒç”¨æ—¶å€™ï¼Œä¸å†new Taskå¯¹è±¡ï¼Œåœ¨callæ–¹æ³•é‡Œè®¾ç½®æ•°æ®åº“è·¯ç”±ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸å†æœ‰ç¡¬ç¼–ç ï¼Œä»»ä½•ç±»å‹çš„ä¸åŒ¹é…éƒ½ä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼Œä¸å†æœ‰å¯¹ç»“æœçš„å¼ºåˆ¶è½¬æ¢ï¼Œå’Œå¯¹ç»“æœçš„å¾ªç¯ç­‰å¾…ï¼Œè°ƒç”¨æ–¹å¼ä¹Ÿç®€å•æ˜äº†äº†è®¸å¤šï¼ŒTaskç±»ä¹Ÿå¯ä»¥å»æ‰äº†ï¼Œæ•´ä¸ªåŠŸèƒ½ä»£ç é‡ä¸è¿‡100è¡Œã€‚<br>&emsp;&emsp;è¿˜æœ‰ä¸€ä¸ªä¸åŒçš„æ˜¯é‡æ„ä»¥åï¼Œåªæ¥æ”¶ä¸€ä¸ªä»»åŠ¡ã€‚å…¶å®åœ¨æˆ‘é‡æ„ä»¥å‰ï¼Œæˆ‘æ²¡æœ‰ä»»ä½•ä¸€æ¬¡æ˜¯ä¼ äº†å¤šä¸ªä»»åŠ¡ç»™è€æ¥å£ï¼Œæ¯æ¬¡éƒ½è¦å»æ„é€ ä¸€ä¸ªList<task>å»é…åˆä»¥å‰çš„æ¥å£ï¼Œä¸ºæ­¤æˆ‘è¿˜ä¸“é—¨å†™äº†ä¸€ä¸ªä¸­é—´å·¥å…·ç±»åªæ¥æ”¶ä¸€ä¸ªTaskï¼Œæ‰€ä»¥ä¼ å¤šä¸ªTaskæƒ…å†µå¾ˆå°‘å¾ˆå°‘ï¼Œä¸è¿‡é‡æ„åè¿™äº›ç±»éƒ½å¯ä»¥å»æ‰äº†ã€‚<br>&emsp;&emsp;æ•´ä¸ªè¿‡ç¨‹å›è¿‡å¤´æ¥çœ‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯åŸå…ˆçš„æ¥å£ä½œè€…ä¼°è®¡ä¸çŸ¥é“æœ‰Callableè¿™ä¸ªä¸œè¥¿ï¼Œæˆ–è€…æ˜¯ä¸ºäº†å·¥å…·åŒ–è€Œå·¥å…·åŒ–ã€‚é‡æ„åä¹Ÿæ²¡ä»€ä¹ˆé«˜å¤§ä¸Šçš„ä¸œè¥¿ï¼Œä¸è¿‡æ•ˆæœæ˜¯å¥½çš„ï¼ŒåŠŸèƒ½ä¸å˜ï¼Œå‡å°‘äº†ä»£ç é‡å’Œå¤æ‚åº¦ã€‚</task></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T06:01:09.000Z"><a href="/2016/09/11/scala-pattern-match/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/scala-pattern-match/">å­¦ä¹ ç¬”è®°ï¼šScalaçš„æ¨¡å¼åŒ¹é…</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“æ¨¡å¼åŒ¹é…çš„ç”¨æ³•ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<p>Scalaçš„æ¨¡å¼åŒ¹é…æœ‰ç‚¹åƒä»¥å‰æ¥è§¦çš„switch-caseè¯­å¥ï¼Œä½†åŠŸèƒ½æ¯”switch-caseä¸°å¯Œå¾ˆå¤šï¼Œæ˜¯ä¸€ç§å¼ºå¤§çš„â€œåè®®â€ã€‚</p>
<h3 id="1ã€ç®€å•åŒ¹é…"><a href="#1ã€ç®€å•åŒ¹é…" class="headerlink" title="1ã€ç®€å•åŒ¹é…"></a>1ã€ç®€å•åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> bools = <span class="type">Seq</span>(<span class="literal">true</span>, <span class="literal">false</span>)</div><div class="line"><span class="keyword">for</span> (bool &lt;- bools) &#123;</div><div class="line">  bool <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="literal">true</span> =&gt; println(<span class="string">"hello"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="literal">false</span> =&gt; println(<span class="string">"world"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// hello</span></div><div class="line"><span class="comment">// world</span></div></pre></td></tr></table></figure>
<p>caseåé¢æ²¡æœ‰è·Ÿbreakè¯­å¥ã€‚å¦‚æœå°†ä¸Šé¢ä»»æ„ä¸€ä¸ªcaseè¯­å¥æ³¨é‡Šï¼Œç¼–è¯‘å™¨ä¼šæŠ›å‡ºMatchErrorï¼Œå› ä¸ºcaseè¯­å¥æ²¡æœ‰åŒ…å«æ‰€æœ‰å¯èƒ½å‡ºç°çš„æƒ…å†µã€‚</p>
<h3 id="2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹"><a href="#2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹" class="headerlink" title="2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹"></a>2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  x &lt;- <span class="type">Seq</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3.7</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="symbol">'four</span>)</div><div class="line">&#125; &#123;</div><div class="line">  <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>          =&gt; <span class="string">"int 1"</span></div><div class="line">    <span class="keyword">case</span> i: <span class="type">Int</span>     =&gt; <span class="string">"other int :"</span> + i                <span class="comment">// é™¤1ä»¥å¤–çš„æ‰€æœ‰æ•´æ•°</span></div><div class="line">    <span class="keyword">case</span> d: <span class="type">Double</span>  =&gt; <span class="string">"a double:"</span> + d</div><div class="line">    <span class="keyword">case</span> <span class="string">"one"</span>      =&gt; <span class="string">"String one"</span></div><div class="line">    <span class="keyword">case</span> s: <span class="type">String</span>  =&gt; <span class="string">"other string:"</span> + s</div><div class="line">    <span class="keyword">case</span> unexpected =&gt; <span class="string">"unexpected value:"</span> + unexpected <span class="comment">// åŒ¹é…å…¶ä»–çš„æƒ…å†µï¼Œxçš„å€¼èµ‹å€¼ç»™unexpectedï¼Œç±»å‹ä¸ºAny</span></div><div class="line">  &#125;</div><div class="line">  println(str)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸Šé¢åºåˆ—æœ€åä¸€ä¸ªæ˜¯Scalaçš„Symbolå¯¹è±¡ã€‚strçš„ç±»å‹æ˜¯æ‰€æœ‰caseè¯­å¥è¿”å›å€¼ç±»å‹çš„æœ€è¿‘å…¬å…±çˆ¶ç±»ã€‚å¦å¤–ï¼Œ<strong>åŒ¹é…å…·ä½“çš„caseè¯­å¥è¦å‡ºç°åœ¨åŒ¹é…å®½æ³›çš„caseè¯­å¥å‰</strong>ï¼Œå¦åˆ™å…·ä½“çš„caseè¯­å¥æ°¸è¿œæ²¡æœ‰æœºä¼šåŒ¹é…ä¸Šï¼ˆç¼–è¯‘å™¨ä¹Ÿå¯ä»¥è¯†åˆ«è¿™ç§é”™è¯¯ï¼‰ã€‚åœ¨åŒ¹é…Doubleç±»å‹æ—¶ï¼Œä¸ºäº†é¿å…èˆå…¥è¯¯å·®å¯¼è‡´çš„æ— æ³•åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  x &lt;- <span class="type">Seq</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3.7</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="symbol">'four</span>)</div><div class="line">&#125; &#123;</div><div class="line">  <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>          =&gt; <span class="string">"int 1"</span></div><div class="line">    <span class="keyword">case</span> _: <span class="type">Int</span>     =&gt; <span class="string">"other int :"</span> + x                </div><div class="line">    <span class="keyword">case</span> _: <span class="type">Double</span>  =&gt; <span class="string">"a double:"</span> + x</div><div class="line">    <span class="keyword">case</span> <span class="string">"one"</span>      =&gt; <span class="string">"String one"</span></div><div class="line">    <span class="keyword">case</span> _: <span class="type">String</span>  =&gt; <span class="string">"other string:"</span> + x</div><div class="line">    <span class="keyword">case</span> _          =&gt; <span class="string">"unexpected value:"</span> + x</div><div class="line">  &#125;</div><div class="line">  println(str)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä½¿ç”¨å ä½ç¬¦<code>_</code>æ›¿ä»£äº†å˜é‡ï¼Œä½¿ç”¨xæ¥è·å–åŒ¹é…çš„å€¼ã€‚ç¼–å†™caseè¯­å¥æ—¶æœ‰ä¸ªé™·é˜±ï¼Œå°±æ˜¯ç¼–è¯‘å™¨ä¼šå‡å®šå¤§å†™å­—æ¯å¼€å¤´çš„æ˜¯ç±»å‹åï¼Œå°å†™å­—æ¯å¼€å¤´çš„æ˜¯å˜é‡åã€‚å¦‚æœè¦å¼•ç”¨åœ¨å‰é¢å®šä¹‰çš„å˜é‡æ—¶ï¼Œç”¨åå¼•å·å°†å…¶æ‹¬èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkY</span></span>(y:<span class="type">Int</span>) = &#123;</div><div class="line">  <span class="keyword">for</span> &#123;</div><div class="line">    x &lt;- <span class="type">Seq</span>(<span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>)</div><div class="line">  &#125; &#123;</div><div class="line">    <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">      <span class="keyword">case</span> `y` =&gt; <span class="string">"found y!"</span></div><div class="line">      <span class="keyword">case</span> i:<span class="type">Int</span> =&gt; <span class="string">"found other"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ‰æ—¶ä¸åŒçš„åŒ¹é…è¯­å¥éœ€è¦å¤„ç†ç›¸åŒçš„é€»è¾‘ä»£ç ï¼Œä¸ºäº†é¿å…å†—ä½™ï¼Œå¯ä»¥ä½¿ç”¨â€œ|â€ç¬¦å·ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> _:<span class="type">Int</span> | <span class="keyword">case</span> _:<span class="type">Double</span> =&gt; <span class="string">"found number:"</span> + x</div><div class="line">  <span class="keyword">case</span> _:<span class="type">Any</span> =&gt; <span class="string">"found other"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3ã€åºåˆ—çš„åŒ¹é…"><a href="#3ã€åºåˆ—çš„åŒ¹é…" class="headerlink" title="3ã€åºåˆ—çš„åŒ¹é…"></a>3ã€åºåˆ—çš„åŒ¹é…</h3><p>å…ˆçœ‹ä¸€ä¸ªScalaçš„è¯­æ³•ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> x +: y = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// x: Int = 1</span></div><div class="line"><span class="comment">// y: List[Int] = List(2, 3)</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>+:</code>æ˜¯åºåˆ—çš„æ„é€ æ“ä½œç¬¦ï¼ˆå…¶å®å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼‰ï¼ŒScalaé‡Œä»¥<code>:</code>ç»“å°¾çš„æ–¹æ³•æ˜¯å‘å³ç»“åˆçš„ï¼Œæ‰€æœ‰xåªæœ‰ä¸€ä¸ªå¤´éƒ¨ï¼ŒyåŒ…å«æ•´ä¸ªå°¾éƒ¨ã€‚ç±»ä¼¼çš„è¿˜æœ‰<code>++:</code>ã€<code>/:</code>ç­‰ã€‚å¯¹åºåˆ—å°±å¯ä»¥è¿™æ ·åŒ¹é…ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">seqToString</span></span>[<span class="type">T</span>](seq: <span class="type">Seq</span>[<span class="type">T</span>]): <span class="type">String</span> = seq <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> head +: tail =&gt; <span class="string">s"<span class="subst">$head</span> +: "</span> + seqToString(tail)</div><div class="line">  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; <span class="string">"Nil"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">seqToString(<span class="type">Seq</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>))</div><div class="line"><span class="comment">// String = 2 +: 3 +: 4 +: 1 +: Nil</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä½¿ç”¨<code>+:</code>æ¥<strong>æå–</strong>åºåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨æ”¾åˆ°headå’Œtailå˜é‡é‡Œï¼ŒSeqé‡Œä¹Ÿæœ‰headå’Œtailæ–¹æ³•ï¼Œå’Œè¿™é‡Œçš„æ˜¯ä¸ä¸€æ ·æ¦‚å¿µã€‚è¿”å›çš„å­—ç¬¦ä¸²æ˜¯å¤´éƒ¨åŠ å°¾éƒ¨çš„é€’å½’è°ƒç”¨è¿”å›çš„ç»“æœã€‚ä¸‹é¢æ˜¯ç”¨Nilæ¥åŒ¹é…ç©ºåºåˆ—ã€‚ä¸¤ä¸ªcaseè¯­å¥åŒ…å«äº†åºåˆ—å¯èƒ½å‡ºç°çš„æ‰€æœ‰å¯ä»¥åŒ¹é…çš„æƒ…å†µï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Œåºåˆ—è¦ä¹ˆåŒ…å«ä¸€ä¸ªä»¥ä¸Šçš„å…ƒç´ ï¼Œè¦ä¹ˆä¸ºç©ºï¼Œéç©ºçš„æ—¶å€™å¯ä»¥è°ƒç”¨<code>+:</code>ï¼ŒåŒ¹é…ç¬¬ä¸€ä¸ªcaseï¼Œç©ºçš„æ—¶å€™å°±åŒ¹é…ç¬¬äºŒä¸ªcaseï¼Œç›¸å½“äºåˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ã€‚<br><code>+:</code>å…¶å®æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªç±»å‹åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå³ç¼–è¯‘å™¨åœ¨caseè¯­å¥ä¸­ç”¨æ¥æå–æ•°æ®çš„unapplyæ–¹æ³•ï¼Œunapplyçš„ç¤ºæ„ï¼ˆéå®Œæ•´ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>[<span class="type">T</span>, <span class="type">Coll</span>](collection:<span class="type">Coll</span>):<span class="type">Option</span>[(<span class="type">T</span>, <span class="type">Coll</span>)]</div></pre></td></tr></table></figure>
<p>å¤´éƒ¨ç±»å‹è¢«æ¨æ–­ä¸ºTï¼Œå‰©ä½™éƒ¨åˆ†çš„ç±»å‹å’Œåºåˆ—æœ¬èº«ç±»å‹ä¸€è‡´ï¼ˆå¯èƒ½ä¸ºç©ºåºåˆ—ï¼‰ã€‚<code>case head +: tail =&gt; â€¦</code>æ˜¯ä¸­ç¼€è¡¨è¾¾å¼çš„å†™æ³•ï¼Œå¯¹åº”çš„å½¢å¼æ˜¯<code>case +:(head, tail)</code>ï¼ŒçœŸæ­£è°ƒç”¨æ˜¯<code>+:.unapply(collection)</code>ã€‚ç›¸å¯¹çš„ï¼Œä½¿ç”¨<code>:+</code>å¯ä»¥è¾¾åˆ°ç›¸åçš„æ•ˆæœï¼Œ<code>prefix :+ end</code>å‰åä¸¤ä¸ªå˜é‡åˆ†åˆ«æå–äº†å‰N-1ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚   </p>
<p>ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯Optionå‘¢ï¼Ÿå…¶å®è¿™æ˜¯ä¸ºäº†å…è®¸åœ¨è‡ªå®šä¹‰unapplyé‡Œè¿”å›éœ€è¦çš„å±æ€§ï¼Œå¯¹å¤–éšè—å†…éƒ¨çš„ç»†èŠ‚ï¼Œæ¯”å¦‚å¹´é¾„ã€ä½å€ä»€ä¹ˆçš„ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½è¿”å›Noneã€‚</p>
<h3 id="4ã€å…ƒç»„çš„åŒ¹é…"><a href="#4ã€å…ƒç»„çš„åŒ¹é…" class="headerlink" title="4ã€å…ƒç»„çš„åŒ¹é…"></a>4ã€å…ƒç»„çš„åŒ¹é…</h3><p>ç›´æ¥ä¸¾æ —å­æŠŠï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> langs = <span class="type">Seq</span>(</div><div class="line">  (<span class="string">"Scala"</span>, <span class="string">"Martin"</span>),</div><div class="line">  (<span class="string">"Clojure"</span>, <span class="string">"Rich"</span>),</div><div class="line">  (<span class="string">"Lisp"</span>, <span class="string">"John"</span>)</div><div class="line">)</div><div class="line"><span class="keyword">for</span> (tuple &lt;- langs) &#123;</div><div class="line">  tuple <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> (_, <span class="string">"Martin"</span>) =&gt; println(<span class="string">"found Scala"</span>)</div><div class="line">    <span class="keyword">case</span> (lang, name) =&gt; println(<span class="string">s"found other language:<span class="subst">$lang</span> (<span class="subst">$name</span>)"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŒ¹é…å…ƒç»„æ—¶å¯ä»¥åŒ¹é…ä¸€éƒ¨åˆ†ï¼Œlangå’Œnameéƒ½è¢«æ¨æ–­ä¸ºStringã€‚</p>
<h3 id="5ã€caseä¸­çš„guardè¯­å¥"><a href="#5ã€caseä¸­çš„guardè¯­å¥" class="headerlink" title="5ã€caseä¸­çš„guardè¯­å¥"></a>5ã€caseä¸­çš„guardè¯­å¥</h3><p>å’Œforæ¨å¯¼å¼ä¸­ä¸€æ ·ï¼Œcaseè¯­å¥ä¹Ÿå¯ä»¥æœ‰guardè¯­å¥ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i &lt;- <span class="type">Seq</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)) &#123;</div><div class="line">  i <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> _ <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> =&gt; println(<span class="string">"even"</span>)</div><div class="line">    <span class="keyword">case</span> _               =&gt; println(<span class="string">"odd"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6ã€caseç±»çš„åŒ¹é…"><a href="#6ã€caseç±»çš„åŒ¹é…" class="headerlink" title="6ã€caseç±»çš„åŒ¹é…"></a>6ã€caseç±»çš„åŒ¹é…</h3><p>caseç±»çš„æˆå‘˜éƒ½æ˜¯valä¿®é¥°çš„ï¼Œæ‰€ä»¥ç±»çš„å¯¹è±¡å’Œå…ƒç»„æœ‰ç‚¹åƒã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span>(<span class="params">street:<span class="type">String</span>, city:<span class="type">String</span>, country:<span class="type">String</span></span>)</span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name:<span class="type">String</span>, age:<span class="type">Int</span>, address:<span class="type">Address</span></span>)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> alice = <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(<span class="string">"1 Lane"</span>, <span class="string">"Chicago"</span>, <span class="string">"USA"</span>))</div><div class="line"><span class="keyword">val</span> bob   = <span class="type">Person</span>(<span class="string">"Bob"</span>, <span class="number">33</span>, <span class="type">Address</span>(<span class="string">"2 Ave"</span>, <span class="string">"Miami"</span>, <span class="string">"USA"</span>))</div><div class="line"><span class="keyword">val</span> charlie = <span class="type">Person</span>(<span class="string">"Charlie"</span>, <span class="number">21</span>, <span class="type">Address</span>(<span class="string">"3 Ct"</span>, <span class="string">"Boston"</span>, <span class="string">"USA"</span>))</div><div class="line"></div><div class="line"><span class="keyword">for</span> (person &lt;- <span class="type">Seq</span>(alice, bob, charlie)) &#123;</div><div class="line">  person <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(_, <span class="string">"Chicago"</span>, _)) =&gt; println(<span class="string">"hi Alice"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(<span class="string">"Bob"</span>, <span class="number">33</span>, <span class="type">Address</span>(<span class="string">"2 Ave"</span>, <span class="string">"Miami"</span>, <span class="string">"USA"</span>)) =&gt; println(<span class="string">"hi bob"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(name, age, _) =&gt; println(<span class="string">s"who is <span class="subst">$name</span>, age is <span class="subst">$age</span>"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå’ŒåŒ¹é…å…ƒç»„ç±»ä¼¼ï¼Œä¹Ÿç”¨äº†é€šé…ç¬¦ï¼ŒåŒ¹é…éœ€è¦çš„éƒ¨åˆ†ã€‚æœ€åä¸€æ¡åŒ¹é…å…¶ä½™çš„æƒ…å†µã€‚åŒ¹é…caseç±»çš„åŸç†ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†caseç±»çš„unapplyæ–¹æ³•ï¼Œè¿”å›Option[TupleN[ ]]ï¼ŒNè¡¨ç¤ºç±»é‡Œæˆå‘˜å˜é‡ä¸ªæ•°ã€‚</p>
<h3 id="7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…"><a href="#7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…" class="headerlink" title="7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…"></a>7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lists = <span class="type">Seq</span>(</div><div class="line">  <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),</div><div class="line">  <span class="type">List</span>(<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">)</div><div class="line"><span class="keyword">for</span> (list &lt;- lists) &#123;</div><div class="line">  list <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">List</span>(_, _)         =&gt; println(<span class="string">"2 elements"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">List</span>(<span class="number">1</span>, vals @ _*) =&gt; println(<span class="string">"tail:"</span> + vals)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// tail:List(2, 3)</span></div><div class="line"><span class="comment">// 2 elements</span></div></pre></td></tr></table></figure>
<h3 id="8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…"><a href="#8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…" class="headerlink" title="8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…"></a>8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> bookRE = <span class="string">""</span><span class="string">"Book: title=([^,]+),\s+issue=(.+)"</span><span class="string">""</span>.r   <span class="comment">// åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</span></div><div class="line"><span class="keyword">val</span> catalog = <span class="string">"Book: title=Programming Scala, author=Deam Wampler"</span></div><div class="line"></div><div class="line">catalog <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> bookRE(title, author) =&gt; println(<span class="string">"title is $titile,author is $author"</span>)</div><div class="line">  <span class="keyword">case</span> notmatch              =&gt; println(<span class="string">"not match"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨titleå’Œauthoræ¥åœ¨åŒ¹é…çš„åŒæ—¶ï¼Œæå–å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´"><a href="#9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´" class="headerlink" title="9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´"></a>9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´</h3><p>è€ƒè™‘ä¸‹é¢çš„åŒ¹é…è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x match &#123;</div><div class="line">  case s1:Seq[Double] =&gt; println(&quot;Double&quot;)</div><div class="line">  case s2:Seq[String] =&gt; println(&quot;String&quot;)</div><div class="line">  case _              =&gt; println(&quot;unkonwn&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„åŒ¹é…è¯­å¥çœ‹ä¼¼æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå…¶å®ç¼–è¯‘ä¼šäº§ç”Ÿå‘Šè­¦ã€‚é—®é¢˜å‡ºåœ¨JVMçš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨è®¤ä¸ºç¬¬äºŒä¸ªcaseè¯­å¥ä¸å¯è¾¾ã€‚æœ‰ä¸€ä¸ªä¸å¤ªç¾è§‚ä½†æœ‰æ•ˆçš„è§£å†³åŠæ³•ï¼Œå…ˆåŒ¹é…å¤´éƒ¨ï¼Œæ ¹æ®å¤´éƒ¨ç±»å‹åˆ¤æ–­æ€ä¹ˆå¤„ç†ï¼Œå¯¹ç©ºåˆ—è¡¨åˆ™å•ç‹¬å¤„ç†ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; <span class="string">"nothing"</span></div><div class="line">  <span class="keyword">case</span> head +: _ =&gt; head <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> _:<span class="type">Double</span> =&gt; <span class="string">"do with double"</span></div><div class="line">    <span class="keyword">case</span> _:<span class="type">String</span> =&gt; <span class="string">"do with string"</span></div><div class="line">    <span class="keyword">case</span> _        =&gt; <span class="string">"un-matched"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="10ã€å…¶ä»–"><a href="#10ã€å…¶ä»–" class="headerlink" title="10ã€å…¶ä»–"></a>10ã€å…¶ä»–</h3><h4 id="1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…"><a href="#1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…" class="headerlink" title="1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…"></a>1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…</h4><p>ç”¨æšä¸¾æ¥åŒ¹é…çš„åå¤„æ˜¯ç¼–è¯‘å™¨æ— æ³•åˆ¤å®šcaseè¯­å¥æ˜¯å¦ä»¥åŠå…¨è¦†ç›–ï¼Œåªæœ‰åˆ°äº†è¿è¡Œæ—¶æ‰ä¼šæŠ›å‡ºMatchErrorå¼‚å¸¸ã€‚</p>
<h4 id="2ã€æå–æƒ³è¦çš„å€¼"><a href="#2ã€æå–æƒ³è¦çš„å€¼" class="headerlink" title="2ã€æå–æƒ³è¦çš„å€¼"></a>2ã€æå–æƒ³è¦çš„å€¼</h4><p>ä»¥å‰é¢çš„Personå’ŒAddressä¸ºä¾‹ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> <span class="type">Persion</span>(name, age, <span class="type">Address</span>(_, state, _)) = <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(<span class="string">"1 Lane"</span>, <span class="string">"Chicago"</span>, <span class="string">"USA"</span>))</div></pre></td></tr></table></figure>
<p>æƒ³è¦æå–çš„å€¼éƒ½ä¿æŒåœ¨å˜é‡nameã€ageç­‰å˜é‡é‡Œã€‚åŒæ ·å¯¹Listä¹Ÿå¯ä»¥æœ‰ç±»ä¼¼æ“ä½œï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> head +: tail = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// head = 1, tail:List[Int] = List(2,3)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> head1 +: head2 +: tail = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// head1 = 1, head2 = 2, tail = List(3)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> <span class="type">Seq</span>(a,b,c) = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// a = 1, b = 2, c = 3</span></div></pre></td></tr></table></figure>
<p>å›é¡¾å‰é¢çš„ç”¨æ³•ï¼Œå¾ˆå¤šæ—¶å€™æ¨¡å¼åŒ¹é…éƒ½ä¼šç”¨æ¥æå–å¯¹åº”çš„å€¼ï¼Œå†è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T02:27:42.000Z"><a href="/2016/09/11/scala-for-comprehension/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/scala-for-comprehension/">å­¦ä¹ ç¬”è®°ï¼šScalaçš„foræ¨å¯¼å¼</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“foræ¨å¯¼å¼çš„ç”¨æ³•å’Œå†…éƒ¨åŸç†ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<h3 id="1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•"><a href="#1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•" class="headerlink" title="1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•"></a>1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•</h3><p>1 foræ¨å¯¼å¼åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª<strong>ç”Ÿæˆå™¨</strong>è¡¨è¾¾å¼ï¼Œå¤–åŠ å¯é€‰çš„<strong>ä¿æŠ¤è¡¨è¾¾å¼</strong>ï¼ˆç”¨äºè¿‡æ»¤è¯—å¥ï¼‰ã€‚<br>2 æ¨å¯¼å¼å¯ä»¥ç”¨äºç”Ÿæˆæ–°çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå…·æœ‰å‰¯ä½œç”¨çš„ä»£ç å—ï¼ˆæ‰“å°è¾“å‡ºï¼‰ã€‚<br>3 ç¤ºä¾‹ï¼Œç§»é™¤æ–‡æœ¬ä¸­çš„ç©ºè¡Œï¼š   </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">RemeoveBlanks</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(path:<span class="type">String</span>, compressWhiteSpace:<span class="type">Boolean</span>=<span class="literal">false</span>):<span class="type">Seq</span>[<span class="type">String</span>]=</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">      line &lt;- scala.io.<span class="type">Source</span>.fromFile(path).getLines.toSeq        <span class="comment">// 1</span></div><div class="line">      <span class="keyword">if</span> line.matches(<span class="string">""</span><span class="string">"^\s*$"</span><span class="string">""</span>) == <span class="literal">false</span>                        <span class="comment">// 2</span></div><div class="line">      line2 = <span class="keyword">if</span> (compressWhiteSpace) line replaceAll(<span class="string">"\\s+"</span>, <span class="string">" "</span>) <span class="comment">// 3</span></div><div class="line">              <span class="keyword">else</span> line</div><div class="line">    &#125; <span class="keyword">yield</span> line2                                                  <span class="comment">// 4</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args:<span class="type">Array</span>[<span class="type">String</span>]) = <span class="keyword">for</span> &#123;</div><div class="line">    path2 &lt;- args                                                  <span class="comment">// 5</span></div><div class="line">    (compress, path) = <span class="keyword">if</span> (path2 startWith <span class="string">"-"</span>) (<span class="literal">true</span>, path2.substring(<span class="number">1</span>))</div><div class="line">                       <span class="keyword">else</span> (<span class="literal">false</span>, path2)                         <span class="comment">// 6</span></div><div class="line">    line &lt;- apply(path, compress)</div><div class="line">  &#125; println(line)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ³¨é‡Šä¸­ï¼š<br>&emsp;&emsp;1ã€ getLinesè¿”å›çš„å¯¹è±¡æ˜¯scala.collection.Iteratorï¼Œæ— æ³•ç”¨äºforæ¨å¯¼å¼ï¼Œæ•…ä½¿ç”¨toSeqè½¬æ¢ä¸ºåºåˆ—ã€‚<br>&emsp;&emsp;2ã€ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å‡ºéç©ºç™½è¡Œã€‚<br>&emsp;&emsp;3ã€ å¦‚æœå‹ç¼©æ ‡è®°ä¸ºtrueï¼Œåˆ™å°†æ‰€æœ‰ç©ºç™½å­—ç¬¦æ›¿æ¢ä¸ºä¸€ä¸ªç©ºæ ¼ã€‚<br>&emsp;&emsp;4ã€ ä½¿ç”¨yieldè¿”å›å†…å®¹ã€‚<br>&emsp;&emsp;5ã€ å¯¹å‚æ•°é‡Œçš„æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚<br>&emsp;&emsp;6ã€ å¦‚æœæ–‡ä»¶è·¯å¾„ä»¥â€œ-â€å¼€å¤´ï¼Œåˆ™æ ‡è®°ä¸ºå‹ç¼©ç©ºç™½å­—ç¬¦ï¼Œå¦åˆ™ä¸å‹ç¼©ã€‚<br>&emsp;&emsp;1ã€3ã€5ã€6æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œ2æ˜¯ä¿æŠ¤è¡¨è¾¾å¼ã€‚</p>
<p>æ³¨æ„ï¼Œæ ‡è®°4ç”¨äº†yieldï¼Œè¡¨æ˜è¿”å›ç»“æœæ˜¯æƒ°æ€§çš„ï¼Œå¦‚æœè°ƒç”¨applyæ–¹æ³•è¿”å›ç»“æœé‡Œåªä¼šè®¡ç®—å‡ºå¤´éƒ¨ï¼Œåºåˆ—çš„å‰©ä½™éƒ¨åˆ†ï¼ˆç”¨?è¡¨ç¤ºï¼‰åªæœ‰ä½¿ç”¨åˆ°äº†æ‰ä¼šè®¡ç®—å‡ºæ¥ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> lines = <span class="type">RemeoveBlanks</span>.apply(<span class="string">"src/main/scala/for-comreh/test-file.txt"</span>)</div><div class="line">lines:<span class="type">Seq</span>[<span class="type">String</span>] = <span class="type">Stream</span>(test-content, ?)</div></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼å¤„ç†å¤§æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚å¦å¤–ï¼Œmainå’Œapplyé‡Œçš„foræ¨å¯¼å¼æ¯æ¬¡è¿­ä»£éƒ½ä¸ä¼šä¿å­˜çŠ¶æ€ï¼Œæ‰€ä»¥å†…å­˜é‡Œä¿å­˜çš„æ•°æ®ä¸ä¼šå¤šäºä¸€è¡Œã€‚</p>
<h3 id="2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶"><a href="#2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶" class="headerlink" title="2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶"></a>2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶</h3><p>1 foræ¨å¯¼å¼çš„è¯­æ³•å®é™…æ˜¯ç¼–è¯‘å™¨çš„è¯­æ³•ç³–ï¼Œå®ƒä¼šè°ƒç”¨å®¹å™¨çš„foreachã€mapã€flatMapã€withFilteræ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ç°äº†è¿™å‡ ä¸ªæ–¹æ³•çš„å®¹å™¨éƒ½å¯ä»¥ç”¨äºforæ¨å¯¼å¼ã€‚<br>2 å…·ä½“æ€ä¹ˆè°ƒç”¨çš„ï¼Œçœ‹ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;s &lt;- states&#125; <span class="keyword">yield</span> s.toUpperCase</div><div class="line"><span class="comment">// List[String] = List(ALABAMA, ALASKA, VIRGINIA, WYOMING)</span></div><div class="line"></div><div class="line">states map (_.toUpperCase)</div><div class="line"><span class="comment">// List[String] = List(ALABAMA, ALASKA, VIRGINIA, WYOMING)</span></div></pre></td></tr></table></figure>
<p>ç”Ÿæˆå™¨è¡¨è¾¾å¼é‡ŒåŒ…å«äº†ä¸€æ¬¡mapæ“ä½œï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆå™¨è¡¨è¾¾å¼å†³å®šäº†æœ€ç»ˆçš„å®¹å™¨ç±»å‹ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªç”Ÿæˆå™¨çš„ç±»å‹æ˜¯List[String]ï¼Œè¿”å›çš„ç»“æœä¹Ÿæ˜¯List[String]ã€‚</p>
<p>3 å¦‚æœæœ‰å¤šä¸ªç”Ÿæˆå™¨æ—¶ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">&#125; <span class="keyword">yield</span> <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line"><span class="comment">// List(A-A, l-L, a-A, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq map (c =&gt; <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>))</div><div class="line"><span class="comment">// List(A-A, l-L, a-A, ...)</span></div></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªç”Ÿæˆå™¨ä¼šéå†å­—ç¬¦ä¸²sã€‚å¦‚æœæœ‰å¤šä¸ªç”Ÿæˆå™¨ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼Œå…¶ä»–ç”Ÿæˆå™¨ä¼šè¢«è½¬æ¢ä¸ºflatMapè°ƒç”¨ï¼Œæœ€åä¸€ä¸ªç”Ÿæˆå™¨åˆ™å¯¹åº”mapè°ƒç”¨ï¼Œä»è¾“å‡ºç»“æœå¯ä»¥è¯æ˜ã€‚</p>
<p>4 å¦‚æœå†æ·»åŠ ä¸€ä¸ªä¿æŠ¤ç”Ÿæˆå™¨ï¼Œä¼šåœ¨æœ€åmapè°ƒç”¨ä¹‹å‰æ’å…¥ä¸€æ¡withFilterè¯­å¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">  <span class="keyword">if</span> c.isLower</div><div class="line">&#125; <span class="keyword">yield</span> <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq withFilter (_.isLower) map (c =&gt; <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>))</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div></pre></td></tr></table></figure>
<p>5 æœ€åçœ‹ä¸‹åœ¨foræ¨å¯¼å¼é‡Œæ·»åŠ å˜é‡çš„æƒ…å†µï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">  <span class="keyword">if</span> c.isLower</div><div class="line">  c2 = <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line">&#125; <span class="keyword">yield</span> c2</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq withFilter (_.isLower) map &#123;</div><div class="line">  <span class="keyword">val</span> c2 = <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>)</div><div class="line">  c2</div><div class="line">&#125;</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div></pre></td></tr></table></figure>
<h3 id="3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™"><a href="#3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™" class="headerlink" title="3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™"></a>3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™</h3><p>1 é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­å¤§æ¦‚å¯¹foræ¨å¯¼å¼è½¬åŒ–æˆå®¹å™¨æ–¹æ³•çš„è°ƒç”¨æœ‰äº†åˆæ­¥äº†è§£ï¼Œä¸‹é¢å°†è¯¦ç»†è®¨è®ºè½¬åŒ–çš„ç»†èŠ‚ã€‚<br>2 Scalaä¼šè¯†åˆ«è¡¨è¾¾å¼é‡Œçš„æ¨¡å¼è¡¨è¾¾å¼ã€‚åƒ<code>pat &lt;- expr</code>è¿™ç§å½¢å¼ï¼ŒScalaä¼šåœ¨foræ¨å¯¼å¼è½¬åŒ–æ—¶è½¬åŒ–ä¸ºï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat &lt;- expr</span></div><div class="line">pat &lt;- expr.withFilter &#123;<span class="keyword">case</span> pat =&gt; <span class="literal">true</span>; <span class="keyword">case</span> _ <span class="literal">false</span>&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åScalaä¼šé‡å¤ä¸Šè¿°åŠ¨ä½œï¼Œç›´åˆ°æ‰€æœ‰è¡¨è¾¾å¼è½¬åŒ–å®Œæˆã€‚å¦‚æœforæ¨å¯¼å¼åŒ…å«ä¸€ä¸ªç”Ÿæˆå™¨å’Œyieldè¡¨è¾¾å¼ï¼Œé‚£è¡¨è¾¾å¼ä¼šè¢«è½¬åŒ–ä¸ºï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat &lt;- expr1) yield expr2</span></div><div class="line">expr map &#123;<span class="keyword">case</span> pat =&gt; expr2&#125;</div></pre></td></tr></table></figure>
<p>åŒ…å«å¤šä¸ªè¡¨è¾¾å¼ç”Ÿæˆå™¨å’Œyieldè¯­å¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat1 &lt;- expr1; pat2 &lt;- expr2; ...) yield exprN</span></div><div class="line">expr1 flatMap &#123;<span class="keyword">case</span> pat1 =&gt; <span class="keyword">for</span> (pat2 &lt;- expr2) ... &#125; <span class="keyword">yield</span> exprN</div></pre></td></tr></table></figure>
<p>å…¶å®çœ‹åˆ°è¿™é‡Œå°±å’Œå‰é¢æœ‰ç‚¹åƒäº†ï¼Œå¤šä¸ªç”Ÿæˆå™¨ä¼šå…ˆflatMapè°ƒç”¨ï¼Œå†åšmapè°ƒç”¨ï¼ˆå‰©ä¸‹çš„ä¸€ä¸ªforç”Ÿæˆå™¨ï¼‰ã€‚ç„¶åä¿æŠ¤å¼çš„è½¬åŒ–å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat1 &lt;- expr1 if guard</span></div><div class="line">pat1 &lt;- expr1 withFilter ((arg1,arg2,...) =&gt; guard)</div></pre></td></tr></table></figure>
<p>ä¸Šé¢filterå‚æ•°åˆ—å‡ºäº†å¤šä¸ªï¼Œä¸è¿‡ä¸€èˆ¬éƒ½åªæœ‰ä¸€ä¸ªå‚æ•°ã€‚å¯¹å¤šä¸ªåŒ…å«å¤šä¸ªç”Ÿæˆå™¨çš„forå¾ªç¯å°†è¢«ç¿»è¯‘æˆï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat1 &lt;- expr1; pat2 &lt;- expr2; ...) exprN</span></div><div class="line">expr1 foreach &#123;<span class="keyword">case</span> pat1 =&gt; <span class="keyword">for</span> (pat2 &lt;- expr2 ... ) <span class="keyword">yield</span> exprN&#125;</div></pre></td></tr></table></figure>
<p>3 åœ¨çœ‹æœ€åä¸€ç§æƒ…å†µï¼Œç”Ÿæˆå™¨é‡ŒåŒ…å«å€¼å®šä¹‰å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªScalaçš„è¯­æ³•ã€‚   </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> z @ (x, y) = (<span class="number">1</span> -&gt; <span class="number">2</span>)</div><div class="line">z:(<span class="type">Int</span>, <span class="type">Int</span>) = (<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">x:<span class="type">Int</span> <span class="number">1</span></div><div class="line">y:<span class="type">Int</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>å˜é‡zä¿å­˜å…ƒç»„çš„å€¼ï¼Œè€Œå˜é‡xå’Œyåˆ™å¯¹åº”å…ƒç»„å„ä¸ªéƒ¨åˆ†çš„å€¼ã€‚å¥½äº†è§£çš„è¿™ä¸ªè¯­æ³•ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªè½¬åŒ–ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat &lt;- expr1; pat2 = expr2</span></div><div class="line">(pat1, pat2) &lt;- <span class="keyword">for</span> &#123;        <span class="comment">// 1</span></div><div class="line">  x1 @ pat1 &lt;- expr1         <span class="comment">// 2</span></div><div class="line">&#125; <span class="keyword">yield</span> &#123;</div><div class="line">  <span class="keyword">val</span> x2 @ pat2 = expr2      <span class="comment">// 3</span></div><div class="line">  (x1, x2)                   <span class="comment">// 4</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;1ã€foræ¨å¯¼å¼å°†è¿”å›åŒ…å«ä¸¤ä¸ªæ¨¡å¼çš„pairå¯¹è±¡ã€‚<br>&emsp;&emsp;2ã€x1 @ pat1 è¯­å¥å°†ä¼šæŠŠæ•´ä¸ªè¡¨è¾¾å¼ä¸­pat1æ‰€åŒ¹é…çš„å€¼èµ‹å€¼ç»™x1ï¼Œè¯¥å€¼ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚<br>&emsp;&emsp;3ã€å°†pat2èµ‹å€¼ç»™x2ã€‚<br>&emsp;&emsp;4ã€è¿”å›å…ƒç»„ã€‚<br>4 ä¸¾ä¸ªå…·ä½“çš„è½¬åŒ–ä¾‹å­å§ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> map = <span class="type">Map</span>(<span class="string">"one"</span> -&gt; <span class="number">1</span>, <span class="string">"two"</span> -&gt; <span class="number">2</span>)</div><div class="line"><span class="keyword">val</span> list1 = <span class="keyword">for</span> &#123;</div><div class="line">  (key, value) &lt;- map</div><div class="line">  i10 = value + <span class="number">10</span></div><div class="line">&#125; <span class="keyword">yield</span> i10</div><div class="line"><span class="comment">// list1: scala.collection.immutable.Iterable[Int] = List(11, 12)</span></div><div class="line"></div><div class="line"><span class="comment">// ç¿»è¯‘åçš„è¯­å¥</span></div><div class="line"><span class="keyword">val</span> list2 = <span class="keyword">for</span> &#123;</div><div class="line">  (i, i10) &lt;- <span class="keyword">for</span> &#123;               <span class="comment">// foræ¨å¯¼å¼è¿”å›å…ƒç»„</span></div><div class="line">    x1 @ (key, value) &lt;- map      <span class="comment">// x1å°±æ˜¯ä¸€ä¸ªkey-valueçš„å…ƒç»„å¯¹è±¡</span></div><div class="line">  &#125; <span class="keyword">yield</span> &#123;</div><div class="line">    <span class="keyword">val</span> x2 @ i10 = value + <span class="number">10</span>     <span class="comment">// x2å’Œi10å€¼ä¸€æ ·</span></div><div class="line">    (x1, x2)                      <span class="comment">// è¿”å›x1ã€x2ï¼Œèµ‹å€¼ç»™(i, i10)</span></div><div class="line">  &#125;</div><div class="line">&#125; <span class="keyword">yield</span> (i10)                     <span class="comment">// å…¶å®æœ€åè¿”å›çš„æ˜¯i10ï¼Œå³x2çš„å€¼</span></div></pre></td></tr></table></figure>
<p>5 æœ€åï¼Œå†™äº†è¿™ä¹ˆå¤šforæ¨å¯¼å¼çš„å·¥ä½œåŸç†ï¼Œå…¶å®å°±æ˜¯å¯¹foræ¨å¯¼å¼å†…å®¹çš„è½¬åŒ–ï¼Œè½¬åŒ–æ—¶éµå¾ªä¸€å®šè§„åˆ™ï¼Œè½¬åŒ–æ—¶è°ƒç”¨å®¹å™¨çš„foreachã€mapã€flatmapã€withFilteræ–¹æ³•ï¼Œå…·ä½“çš„è§„åˆ™å¯èƒ½ä¸éœ€è¦æŒæ¡ï¼ŒçŸ¥é“æ˜¯æ€ä¹ˆå›äº‹å°±å¥½äº†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-04T03:11:14.000Z"><a href="/2016/09/04/scala-option-and-others/">2016-09-04</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/04/scala-option-and-others/">å­¦ä¹ ç¬”è®°ï¼šScalaçš„Optionä»¥åŠå…¶ä»–å®¹å™¨</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“Optionã€Eitherã€Tryå®¹å™¨ã€‚æœ€åç®€å•ä»‹ç»ä¸‹Scalaç¬¬ä¸‰æ–¹åº“çš„Validationç±»ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<h3 id="1ã€Option-å®¹å™¨"><a href="#1ã€Option-å®¹å™¨" class="headerlink" title="1ã€Option å®¹å™¨"></a>1ã€Option å®¹å™¨</h3><ol>
<li>Optionå®¹å™¨æ¯”è¾ƒå¸¸è§ï¼ŒJava8å’ŒJavaç¬¬ä¸‰æ–¹åº“Guavaé‡Œéƒ½æœ‰ç±»ä¼¼çš„å®ç°ã€‚  </li>
<li>Scalaé‡Œå¸¸è§çš„å®¹å™¨åƒListã€Mapç­‰éƒ½å¯ä»¥ä½¿ç”¨foræ¨å¯¼å¼ï¼ŒScalaçš„foræ¨å¯¼å¼æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«å±•å¼€ä¸ºå¯¹foreachã€mapã€flatMapã€withFilterçš„è°ƒç”¨ï¼ŒOptionå®ç°äº†è¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨foræ¨å¯¼å¼ä¸­ä½¿ç”¨Optionå®¹å™¨ã€‚</li>
<li>Optionçš„APIå®šä¹‰ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Option</span>[+<span class="type">A</span>] </span>&#123; self =&gt;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isEmpty</span></span>: <span class="type">Boolean</span> <span class="comment">// å­ç±»ä¼šå®ç°è¿™ä¸ªå˜é‡</span></div><div class="line"></div><div class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">foreach</span></span>[<span class="type">U</span>](f:<span class="type">A</span> =&gt; <span class="type">U</span>): <span class="type">Unit</span> =</div><div class="line">    <span class="keyword">if</span> (!isEmpty) f(<span class="keyword">this</span>.get)</div><div class="line"></div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>sealed</code>å…³é”®å­—é™å®šå­ç±»å¿…é¡»å’Œçˆ¶ç±»åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œ<code>self</code>æ˜¯Optionçš„åˆ«åï¼Œ<code>final</code>é™åˆ¶å­ç±»é‡å†™ï¼Œå…¶ä½™æ–¹æ³•å®šä¹‰å’Œforeachç±»ä¼¼ã€‚</p>
<h3 id="2ã€Someå’ŒNone"><a href="#2ã€Someå’ŒNone" class="headerlink" title="2ã€Someå’ŒNone"></a>2ã€Someå’ŒNone</h3><ol>
<li>è¿™ä¸¤ä¸ªæ˜¯Optionçš„å­ç±»ï¼Œåˆ†åˆ«æ˜¯éç©ºå¯¹è±¡å’Œç©ºå¯¹è±¡ã€‚</li>
<li>ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•ï¼Œåªæœ‰å½“Optionä¸ºéç©ºæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ä¼ å…¥çš„å‡½æ•°å‚æ•°ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿‡æ»¤å‡ºç»“æœé‡Œçš„éç©ºç»“æœã€‚åˆ†å¸ƒå¼ä»»åŠ¡æ”¶é›†ç»“æœä¹Ÿä¼šåˆ©ç”¨äº†è¿™ä¸ªç‰¹æ€§ã€‚</li>
<li>ç¤ºä¾‹ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> results: <span class="type">Seq</span>[<span class="type">Option</span>[<span class="type">Int</span>]] = <span class="type">Vector</span>(<span class="type">Some</span>(<span class="number">10</span>), <span class="type">Some</span>(<span class="number">20</span>), <span class="type">None</span>)</div><div class="line"><span class="keyword">val</span> results2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results</div><div class="line">&#125; <span class="keyword">yield</span> (<span class="number">2</span> * i)</div><div class="line"><span class="comment">// results2:Seq[Int] = Vector(20, 40)</span></div></pre></td></tr></table></figure>
<p><code>Some(i) &lt;- results</code>ä¼šå¯¹resultsé‡Œçš„å…ƒç´ è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œç§»é™¤Noneå…ƒç´ ï¼Œå¹¶æŠ½å–åŒ…å«çš„æ•°å€¼ã€‚åˆ©ç”¨foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™ï¼Œå¯ä»¥è½¬åŒ–ä¸ºï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">val</span> result2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results withFilter &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; <span class="literal">true</span></div><div class="line">    <span class="keyword">case</span> <span class="type">None</span> =&gt; <span class="literal">false</span></div><div class="line">  &#125; map &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; (<span class="number">2</span> * i)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mapé‡Œçš„caseä¼šäº§ç”Ÿè­¦å‘Šï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œåœ¨withFilteré‡Œå·²ç»è¿‡æ»¤äº†Noneçš„æƒ…å†µï¼Œè¿è¡Œæ—¶ä»£ç ä¸ä¼šæŠ¥MatchErrorã€‚<br>åº”ç”¨ï¼šå¯¹ä¸€ç»„å€¼åšåˆæ³•æ€§æ£€æŸ¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Option</span>[<span class="type">Int</span>] = </div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Some</span>(i) <span class="keyword">else</span> <span class="type">None</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = Some(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>) <span class="comment">// ä¸€æ—¦è¿™é‡Œè¿”å›Noneï¼Œåç»­è¡¨è¾¾å¼ä¼šåœæ­¢æ‰§è¡Œï¼Œæ‰€ä»¥ä¸‹ä¸€å¥å¯ä»¥å¼•ç”¨i2å˜é‡</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = None</span></div></pre></td></tr></table></figure>
<h3 id="3ã€Eitherå®¹å™¨"><a href="#3ã€Eitherå®¹å™¨" class="headerlink" title="3ã€Eitherå®¹å™¨"></a>3ã€Eitherå®¹å™¨</h3><ol>
<li>Optionå®¹å™¨çš„Noneæœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸èƒ½è¿”å›ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›å€¼ã€‚æ­¤æ—¶Eitheræ˜¯æ›¿ä»£Optionçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¸å…¶å­—é¢æ„æ€ä¸€è‡´ï¼ŒOptionè¡¨ç¤ºå«æœ‰0æˆ–1ä¸ªå…ƒç´ ï¼ŒEitherè¡¨ç¤ºå«æœ‰è¿™ä¸ªæˆ–é‚£ä¸ªå…ƒç´ ã€‚  </li>
<li>Eitherçš„å®šä¹‰ï¼š<code>sealed abstract class Either[+A, +B] extends AnyRef</code>ï¼ŒAã€Bè¡¨ç¤ºEitherå¯¹è±¡å¯ä»¥æŒæœ‰çš„å¯¹è±¡ç±»å‹ï¼ˆå¯ä»¥ä¸åŒï¼‰ï¼ŒåŠ å·è¡¨ç¤ºå‚æ•°æ˜¯åå˜çš„ã€‚  </li>
<li>Eitheræœ‰ä¸¤ä¸ªå­ç±»ï¼Œ<code>Left[A]</code>å’Œ<code>Right[B]</code>ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå­ç±»ä»ä¸¤ä¸ªå¯èƒ½çš„å…ƒç´ ä¸­é€‰ä¸€ä¸ªã€‚Eitherçš„å†å²æ—©äºScalaï¼Œçº¦å®šç”¨Leftæ¥è¡¨ç¤ºé”™è¯¯ï¼ŒRightè¡¨ç¤ºæ­£å¸¸è¿”å›ç»“æœã€‚  </li>
<li>ç¤ºä¾‹ï¼šç”¨Eitheré‡å†™å‰é¢çš„ğŸŒ°ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Int</span>] =</div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Right</span>(i) <span class="keyword">else</span> <span class="type">Left</span>(<span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>).right</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>).right</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Right(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Left(non-positive number -5)</span></div></pre></td></tr></table></figure>
<p>å’Œå‰é¢ä¸€æ ·ï¼Œä¸€æ—¦è°ƒç”¨<code>.right</code>è¿”å›çš„æ˜¯Leftç±»å‹æ—¶ï¼Œè°ƒç”¨ç»“æŸï¼Œåé¢çš„ä¸å†æ‰§è¡Œã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œç›®å‰æ¥çœ‹ï¼ŒLeftå’ŒRightéƒ½å¯ä»¥è°ƒç”¨<code>left</code>å’Œ<code>right</code>æ–¹æ³•ï¼Œåˆ†åˆ«è¿”å›LeftProjectionå’ŒRightProjectionå®ä¾‹ï¼Œä½†å†å¯¹LeftProjectionå’ŒRightProjectionå–å€¼æ—¶ï¼Œforæ¨å¯¼å¼å¯ä»¥è‡ªå·±æ¨å¯¼å‡ºæ¥ã€‚æ¯”å¦‚ï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> <span class="type">L</span> = <span class="type">Left</span>(<span class="number">33</span>)</div><div class="line"><span class="keyword">val</span> left = <span class="type">L</span>.left      <span class="comment">// left = LeftProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> lvalue = left.get  <span class="comment">// lvalue = 33</span></div><div class="line"><span class="keyword">val</span> right = <span class="type">L</span>.right    <span class="comment">// right = RightProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> rvalue = right.get <span class="comment">// NoSuchElementException</span></div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹2ï¼Œå¯¹äºå‡ºç°å¼‚å¸¸çš„æƒ…å†µï¼Œå¯ä»¥å°†å¼‚å¸¸åˆ—åœ¨è¿”å›å€¼çš„Eitherå·¦å€¼é‡Œï¼Œä¸å†é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ•è·è°ƒç”¨å †æ ˆä¸­æŸäº›åº”ç”¨çš„æ§åˆ¶æƒï¼ŒåŒæ—¶è°ƒç”¨è€…æ›´èƒ½æ˜ç™½APIçš„å«ä¹‰ã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">addInts</span></span>(s1: <span class="type">String</span>, s2: <span class="type">String</span>): <span class="type">Either</span>[<span class="type">NumberFormatException</span>,<span class="type">Int</span>] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="type">Right</span>(s1.toInt + s2.toInt)</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> nfe: <span class="type">NumberFormatException</span> =&gt; <span class="type">Left</span>(nfe)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">println(addInts(<span class="string">"11"</span>, <span class="string">"22"</span>)) <span class="comment">// Right(33)</span></div><div class="line">println(addInts(<span class="string">"f"</span>, <span class="string">"33"</span>))  <span class="comment">// Left(java.lang.NumberFormatException: For input string: "f")</span></div></pre></td></tr></table></figure></p>
<h3 id="4ã€Tryå®¹å™¨"><a href="#4ã€Tryå®¹å™¨" class="headerlink" title="4ã€Tryå®¹å™¨"></a>4ã€Tryå®¹å™¨</h3><ol>
<li>scala.util.Tryçš„ç»“æ„å’ŒEitherç±»ä¼¼ï¼Œæœ‰ä¸¤ä¸ªå­ç±»Successå’ŒFailureï¼ŒSuccessä¸Rightç›¸ä¼¼ï¼Œä¿å­˜æ­£å¸¸çš„è¿”å›å€¼ï¼ŒFailureä¸Leftç›¸ä¼¼ï¼Œä½†æ€»æ˜¯åŒ…å«Throwableå¯¹è±¡ï¼Œæ‰€ä»¥Tryçš„å®šä¹‰åªæœ‰ä¸€ä¸ªæ³›å‹å‚æ•°ï¼š<code>sealed abstract class Try[+T] extends AnyRef</code>ã€‚</li>
<li>ç¤ºä¾‹ï¼šä»ä¸€ç»„Tryå€¼ä¸­ï¼Œè¿‡æ»¤æ‰Failureå¯¹è±¡ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scala.util.&#123;<span class="type">Try</span>, <span class="type">Success</span>, <span class="type">Failure</span>&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>): <span class="type">Try</span>[<span class="type">Int</span>] = <span class="type">Try</span> &#123;</div><div class="line">  assert(i &gt; <span class="number">0</span>, <span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line">  i</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Success(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Failure(java.lang.AssertionError: assert failed: non-positive number -5)</span></div></pre></td></tr></table></figure>
<h3 id="5ã€Scalazæä¾›çš„Validationç±»"><a href="#5ã€Scalazæä¾›çš„Validationç±»" class="headerlink" title="5ã€Scalazæä¾›çš„Validationç±»"></a>5ã€Scalazæä¾›çš„Validationç±»</h3><ol>
<li>ä»¥ä¸Šä»‹ç»çš„å®¹å™¨ï¼Œåœ¨foræ¨åˆ°ä¸­é‡åˆ°ä¸æ»¡è¶³æƒ…å†µä¼šç«‹å³åœæ­¢ï¼Œå¦‚æœæƒ³æ”¶é›†æ‰€æœ‰æ‰€æœ‰æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼Œå¹¶åˆ¤æ–­åé¢æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œå…¸å‹çš„åœºæ™¯å°±æ˜¯éªŒè¯ç½‘é¡µè¡¨å•ï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡å°†æ‰€æœ‰é”™è¯¯ä¿¡æ¯è¿”å›ã€‚Scalaæ ‡å‡†åº“æ— æ³•æä¾›è¿™æ ·çš„åŠŸèƒ½ï¼Œç¬¬ä¸‰æ–¹åº“Scalazæä¾›äº†Validationæ»¡è¶³è¿™ç§éœ€æ±‚ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scalaz._, std.<span class="type">AllInstance</span>._</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validName</span></span>(key: <span class="type">String</span>, name: <span class="type">String</span>): </div><div class="line">        <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">val</span> n = name.trim</div><div class="line">  <span class="keyword">if</span> (n.length &gt; <span class="number">0</span> &amp;&amp; n.matches(<span class="string">""</span><span class="string">"^\p&#123;Alpha&#125;$"</span><span class="string">""</span>)) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; n))</div><div class="line">  <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> &lt;<span class="subst">$n</span>&gt;"</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(key: <span class="type">String</span>, n: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">val</span> i = n.toInt</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; i))</div><div class="line">    <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> <span class="subst">$i</span>"</span>))</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> _: java.lang.<span class="type">NumberFormatException</span> =&gt; <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"<span class="subst">$n</span> is not a Integer"</span>))</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validForm</span></span>(firstName: <span class="type">String</span>, lastName: <span class="type">String</span>, age: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  validName(<span class="string">"first-name"</span>, firstName) </div><div class="line">  +++ validName(<span class="string">"last-name"</span>, lastName) </div><div class="line">  +++ positive(<span class="string">"age"</span>, age)</div><div class="line">&#125;</div><div class="line"></div><div class="line">validForm(<span class="string">"Dean"</span>, <span class="string">"Wampler"</span>, <span class="string">"29"</span>)</div><div class="line"><span class="comment">// Success(List((first-name,Dean),(last-name,Wampler),(age,29)))</span></div><div class="line"></div><div class="line">validForm(<span class="string">""</span>, <span class="string">"Wampler"</span>, <span class="string">"0"</span>)</div><div class="line"><span class="comment">// Failure(List(Invalid first-name &lt;&gt;, Invalid age 0))</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„Successå’ŒFailureå’ŒTryçš„ä¸¤ä¸ªå­ç±»ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-30T13:53:26.000Z"><a href="/2016/07/30/Hello-Hexo/">2016-07-30</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/30/Hello-Hexo/">Hello Hexo</a></h1>
  

    </header>
    <div class="entry">
      
        <p>é—²çš„è›‹ç–¼çš„æˆ‘åˆå¼€å§‹æŠ˜è…¾äº†ï¼Œè¿™æ¬¡æ˜¯é€šè¿‡Hexoæ¥æ­å»ºä¸ªäººåšå®¢ï¼Œéœ€è¦æå‰äº†è§£ä¸€äº›åŒ…æ‹¬githubã€nodejsçš„åŸºæœ¬ä½¿ç”¨ï¼Œæ€ä¹ˆæ­å»ºçš„è¿‡ç¨‹å°±ä¸å¤šè¯´äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ª<a href="http://beiyuu.com/github-pages" target="_blank" rel="external">æ•™ç¨‹1</a>ã€<a href="http://www.jianshu.com/p/05289a4bc8b2" target="_blank" rel="external">æ•™ç¨‹2</a>ï¼Œé‡Œé¢å¾ˆè¯¦ç»†çš„ä»‹ç»äº†æ•´ä¸ªè¿‡ç¨‹ã€‚   </p>
<p>è¿™é‡Œä¸»è¦è®°å½•ä¸‹æˆ‘åœ¨æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚   </p>
<h3 id="1ã€-SSH-keyå’Œä½¿ç”¨å¤šä¸ªgithubè´¦å·"><a href="#1ã€-SSH-keyå’Œä½¿ç”¨å¤šä¸ªgithubè´¦å·" class="headerlink" title="1ã€ SSH keyå’Œä½¿ç”¨å¤šä¸ªgithubè´¦å·"></a>1ã€ SSH keyå’Œä½¿ç”¨å¤šä¸ªgithubè´¦å·</h3><p>ä¸Šé¢çš„ä¸¤ä¸ªæ•™ç¨‹é‡Œæœ‰è¯´æ€ä¹ˆåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªssh keyï¼Œå¹¶æ·»åŠ åˆ°githubçš„è¿‡ç¨‹ï¼Œå¦‚æœè¦ä½¿ç”¨ç¬¬äºŒä¸ªè´¦å·æ—¶ï¼Œæœ‰äº›ä¸åŒçš„åœ°æ–¹ã€‚é¦–å…ˆè¿›å…¥ä¿å­˜ssh keyçš„ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> ~/.ssh</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç›®å½•æ˜¯éšè—çš„ï¼Œç”¨lså‘½ä»¤ä¸ä¼šå›æ˜¾ã€‚è¿›å…¥ä¹‹åï¼Œå¦‚æœä¹‹å‰å·²ç»åˆ›å»ºäº†keyï¼Œä¼šæœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id_rsa  id_rsa.pub</div></pre></td></tr></table></figure>
<p>æœ‰å°è±¡å§ï¼Œç„¶åå†èµ°ä¸Šä¸€æ¬¡çš„æµç¨‹ï¼Œåœ¨.sshç›®å½•è¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ ssh-keygen -t rsa -C <span class="string">"your-email@xxx.com"</span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key(~/.ssh): second_key</div><div class="line">...</div></pre></td></tr></table></figure>
<p>æ³¨æ„è¦åœ¨ä¸Šé¢çš„<strong>second_key</strong>é‚£é‡Œè¾“å…¥æ–°çš„keyåè¯ï¼Œç„¶ååé¢ä¸€è·¯å›è½¦ã€‚å®Œäº†ç›®å½•ä¸‹ä¼šæ–°å¢ä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">second  second.pub</div></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯åœ¨å…¶ä»–ç›®å½•ç”Ÿæˆçš„è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æ‹·è´åˆ°.sshç›®å½•ã€‚æŠŠsecond.pubé‡Œçš„å†…å®¹æ·»åŠ åˆ°githubè´¦å·ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸Šé¢çš„ä¸¤ä¸ªæ•™ç¨‹ã€‚<br>å†åœ¨.sshç›®å½•æ–°å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Host defaultgit</div><div class="line">    HostName github.com</div><div class="line">    PreferredAuthentications publickey</div><div class="line">    IdentityFile ~/.ssh/id_rsa</div><div class="line"></div><div class="line">Host secondgit</div><div class="line">    HostName github.com</div><div class="line">    PreferredAuthentications publickey</div><div class="line">    IdentityFile ~/.ssh/second</div></pre></td></tr></table></figure>
<p>Host åç§°å¯ä»¥éšæ„èµ·ï¼Œè¡¨ç¤ºSSHè¿æ¥çš„å•ç‹¬ä»£å·ï¼ŒIdentityFileå‘Šè¯‰SSHå»å“ªé‡Œè¯»ç§é’¥ã€‚æ‰§è¡Œssh-addæ·»åŠ æ–°ç”Ÿæˆçš„ç§é’¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh-add ~/.ssh/second</div></pre></td></tr></table></figure>
<p>ç„¶åæµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ssh -T git@defaultgit</div><div class="line">Hi yourname1! You have successfully ...</div><div class="line"></div><div class="line">$ ssh -T git@secondgit</div><div class="line">Hi yourname2! You have successfully ...</div></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºç°ä¸Šé¢çš„æç¤ºï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚ä»¥åç”¨åˆ°é‚£ä¸ªè´¦å·ï¼Œå°±ä½¿ç”¨å“ªä¸ªè´¦å·Hostå¯¹åº”çš„åç§°ï¼Œä¾‹å¦‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git@defaultgit:xxx/yyy.git</div><div class="line">git <span class="built_in">clone</span> git@secondgit:xxx/yyy.git</div></pre></td></tr></table></figure>
<p>ä¸Šé¢å…‹éš†äº†åŒä¸€ä¸ªä»“åº“ï¼Œä½†ä½¿ç”¨çš„æ˜¯ä¸åŒçš„SSHè¿æ¥ã€‚ä¹Ÿå¯ä»¥åªåœ¨é¡¹ç›®ä¸‹é…ç½®åŒºåˆ«äºå…¨å±€çš„è®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git config --global --unset user.name</div><div class="line">git config --global --unset user.email</div><div class="line"></div><div class="line">git config user.name <span class="string">"new name"</span></div><div class="line">git config user.email <span class="string">"new email"</span></div></pre></td></tr></table></figure>
<p>ç”¨æˆ·åçš„é‚®ç®±å°±æ˜¯æ³¨å†Œgithubè´¦å·ä½¿ç”¨çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œè¿™æ ·åœ¨æ¯ä¸ªç›®å½•ä¸‹æäº¤å°±å¯ä»¥è‡ªåŠ¨è¯†åˆ«githubè´¦å·äº†ã€‚</p>
<h3 id="2ã€éƒ¨ç½²Hexo"><a href="#2ã€éƒ¨ç½²Hexo" class="headerlink" title="2ã€éƒ¨ç½²Hexo"></a>2ã€éƒ¨ç½²Hexo</h3><p>é…ç½®Hexoçš„éƒ¨ç½²éƒ¨åˆ†ï¼Œrepoçš„é…ç½®ç‰¹åˆ«æ³¨æ„ï¼Œéœ€è¦githubç½‘å€URL+ç”¨æˆ·å+repoåï¼Œå¦‚ä¸‹åœ¨deployèŠ‚ç‚¹</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">deploy:</span></div><div class="line"><span class="attr">    type:</span> git</div><div class="line"><span class="attr">    repo:</span> https://github.com/user-name/repo-name</div><div class="line"><span class="attr">    branch:</span> master</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„user-nameå’Œrepo-nameæ˜¯githubè´¦æˆ·çš„ç”¨æˆ·åå’Œä»“åº“åï¼Œä¸€èˆ¬æ ¼å¼ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://github.com/ngbyte/ngbyte.github.com</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰å°±æ˜¯éƒ¨ç½²æ—¶å€™å¦‚æœæç¤ºæ‰¾ä¸åˆ°ä»“åº“ï¼Œå¤šåŠå°±æ˜¯deployèŠ‚ç‚¹çš„repoæ²¡æœ‰é…ç½®å¥½ï¼ŒæŒ‰ç…§ä¸Šé¢æ ¼å¼æ¥å¡«å†™å°±å¯ä»¥äº†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-02T06:15:20.000Z"><a href="/2016/07/02/program-with-OOP-md/">2016-07-02</a></time>
      
      
  
    <h1 class="title"><a href="/2016/07/02/program-with-OOP-md/">é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€äº›ä½“ä¼š</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1-åˆè¯†"><a href="#1-åˆè¯†" class="headerlink" title="1 åˆè¯†"></a>1 åˆè¯†</h3><p>å¤§å­¦é‡Œå­¦äº†C++ï¼Œæ²¡æ€ä¹ˆå­¦ä¼šï¼Œè€ƒè¯•ä¹Ÿè€ƒçš„ä¸€èˆ¬ï¼Œç›´åˆ°å¤§å››æ‰¾å·¥ä½œäº†ï¼Œåˆæ‹¿å‡ºæ¥å¤ä¹ äº†ä¸€æŠŠã€‚å½“æ—¶å­¦é•¿é€äº†æˆ‘ä¸€æœ¬ã€Šç¨‹åºå‘˜é¢è¯•æŒ‡å—ã€‹å¼€å§‹ä¸´æ—¶æŠ±ä½›è„šï¼ŒåŸºæœ¬ä¸ŠæŠŠè¿™æœ¬ä¹¦è¿‡äº†ä¸€éï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤§çš„ï¼Œä¸€æ¬¡äº¬ä¸œçš„ç¬”è¯•æœ‰ä¸ªé¢˜é—®æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡çš„å¤šæ€ï¼Œæˆ‘åªå†™äº†ä¸€å¥è¯è®°å¾—æ˜¯ï¼šè¿è¡Œæ—¶çˆ¶ç±»å¯ä»¥æŒ‡å‘å­ç±»çš„ç‰¹æ€§ã€‚ç°åœ¨çœ‹å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆä¸å¯¹ã€‚</p>
<h3 id="2-é¡¹ç›®é‡Œå®è·µ"><a href="#2-é¡¹ç›®é‡Œå®è·µ" class="headerlink" title="2 é¡¹ç›®é‡Œå®è·µ"></a>2 é¡¹ç›®é‡Œå®è·µ</h3><p>æ¯•ä¸šå»äº†ç¬¬ä¸€å®¶å…¬å¸ï¼ŒåšJava Webçš„é¡¹ç›®ï¼Œå¸¦æˆ‘çš„è€å‘˜å·¥ç»™äº†æˆ‘ä¸€æœ¬ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹ä¹Ÿæ²¡çœ‹æ‡‚å¤šå°‘å°±å¼€å§‹å†™ä»£ç ã€‚åˆšå¼€å§‹é‚£æ®µæ—¶é—´ï¼Œå½“æ—¶å†™è¿‡çš„ä¸€ä¸ªå‡½æ•°ï¼Œè®°å¾—å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">doSomeThing</span><span class="params">(List&lt;T extends BaseModel&gt; list)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ... ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¡¹ç›®é‡Œï¼ŒBaseModelæ˜¯çˆ¶ç±»ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­ç±»ï¼Œæˆ‘è¿™é‡Œå†™äº†ä¸€ä¸ªå…¬å…±çš„æ–¹æ³•ï¼Œå¯ä»¥æ¥æ”¶å¯¹åº”ä¸‰ä¸ªå­ç±»çš„åˆ—è¡¨å‚æ•°ï¼Œåšä¸€äº›å…¬å…±çš„å¤„ç†åè¿”å›ã€‚è¿™ä¸ªå†™æ³•ä¹Ÿæ˜¯ä»ç½‘ä¸Šæœæ¥çš„ï¼Œç”¨èµ·æ¥ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…¶å®å¹¶æ²¡æœ‰å®Œå…¨ç†è§£ã€‚è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ç”¨åˆ°äº†ç»§æ‰¿å’Œå¤šæ€çš„çŸ¥è¯†ï¼Œä»»ä½•ç»§æ‰¿äº†BaseModelçš„ç±»çš„åˆ—è¡¨éƒ½å¯ä»¥ä½œä¸ºæ–¹æ³•çš„åˆæ³•å‚æ•°ã€‚</p>
<h3 id="3-æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨"><a href="#3-æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨" class="headerlink" title="3 æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨"></a>3 æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨</h3><p>æœ€è¿‘åšä¸€ä¸ªé¡¹ç›®ï¼Œç”¨JQueryçš„Datatableæ¥å±•ç¤ºè¡¨æ ¼ï¼Œç”±äºè¦æŠŠListç»“æœè½¬æ¢æˆç”¨å­—ç¬¦ä¸²è¡¨ç¤ºçš„äºŒç»´æ•°ç»„å½¢å¼ï¼Œå†è¿”å›ç»™Ajaxè¯·æ±‚ï¼Œè¿™æ ·jsä»£ç é‡Œåšå°‘é‡å¤„ç†å°±å¯ä»¥å±•ç¤ºå‡ºè¡¨æ ¼ã€‚ç”±äºæˆ‘ä¸­é€”æ¥æ‰‹è¿™ä¸ªé¡¹ç›®ï¼ŒæŠŠç›´æ¥ç”¨+æ‹¼æ¥åæ¥ä¸ªå±æ€§çš„ä»£ç æå–å‡ºæ¥ï¼ŒæŠŠModelç±»éƒ½æ·»åŠ ä¸€ä¸ªform()æ–¹æ³•ï¼ŒæŠŠæ‹¼æ¥å±æ€§çš„æ–¹æ³•æ”¾åœ¨é‡Œé¢ï¼ˆæ”¹ç”¨StringBuilderï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleModel</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> String birth;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">wrap</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"\""</span> + obj.toString() + <span class="string">"\""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">wrapComma</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"\""</span> + obj.toString() + <span class="string">"\","</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">form</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        sb.append(<span class="string">"["</span>);</div><div class="line">        sb.append(wrapComma(name));</div><div class="line">        sb.append(wrapComma(age));</div><div class="line">        sb.append(wap(birth));</div><div class="line">        sb.append(<span class="string">"]"</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼ŒwrapComma(Objet)æ¯”wrap(Object)å¤šè¿”å›ä¸€ä¸ªé€—å·ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ”¾åœ¨å¦å¤–ä¸€ä¸ªå·¥å…·ç±»é‡Œæ¥è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘æ”¾åœ¨ä¸€èµ·æ–¹ä¾¿é˜…è¯»ï¼Œæœ€åform()æ–¹æ³•çš„è¿”å›çš„ä¸€èˆ¬æ ¼å¼å°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[&quot;å¼ ä¸‰&quot;, &quot;22&quot;, &quot;1990-01-01&quot;]</div></pre></td></tr></table></figure>
<p>ç”±äºè¿”å›çš„æ˜¯å¤šè¡Œï¼Œæ‰€ä»¥ç”¨å¾ªç¯æ¥å®Œæˆï¼Œä¸“é—¨å†™ä¸€ä¸ªå·¥å…·æ–¹æ³•æ¥åšè½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertList2StringArray</span><span class="params">(List&lt;ExampleModel&gt; list)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"[[]]"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">"["</span>);</div><div class="line">    <span class="keyword">for</span> (ExampleModel model : list) &#123;</div><div class="line">        sb.append(model.form());</div><div class="line">        sb.append(<span class="string">","</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    sb.replace(sb.length() - <span class="number">1</span>, sb.length(), <span class="string">"]"</span>);</div><div class="line">    <span class="keyword">return</span> sb.toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œè¿”å›çš„ç»“æœä¸€èˆ¬æ ¼å¼ä¸ºäºŒç»´æ•°ç»„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[&quot;å¼ ä¸‰&quot;, &quot;22&quot;, &quot;1990-01-01&quot;], [&quot;å¼ å››&quot;, &quot;23&quot;, &quot;1990-01-02&quot;]] æˆ–è€… [[]]</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ˆä¸æ˜¯æŒ–æ˜æœºæŠ€æœ¯å“ªå®¶å¼ºï¼‰ï¼Œé¡¹ç›®é‡ŒModelå¤šå¦‚ç‹—ï¼Œä¸€ä¸ªè¡¨æ ¼å°±å¯¹åº”ä¸€ä¸ªModelï¼Œè¿™æ ·åšæ˜¾ç„¶æ˜¯ä¸å¤Ÿï¼Œè¿™ä¸ªæ—¶å€™å¾ˆè‡ªç„¶çš„æƒ³åˆ°ï¼Œå¤šæ€å°±æ´¾ä¸Šç”¨åœºã€‚å½“ç„¶æˆ‘ä»¬ä¸ä¼šä½¿ç”¨çˆ¶ç±»ï¼Œä½¿ç”¨æ¥å£è®©Modelé‡å†™ç‰¹å®šçš„æ–¹æ³•å°±è¡Œã€‚å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICommonForm</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¿”å›æè¿°Modelç‰¹å®šçš„å­—ç¬¦ä¸²å½¢å¼</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">form</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åè®©å¯¹åº”è¦å±•ç¤ºçš„Modeléƒ½å®ç°è¿™ä¸ªæ¥å£ï¼Œä¾‹å¦‚ä¸Šé¢çš„ExampleModelã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleModel</span> <span class="keyword">implements</span> <span class="title">ICommonForm</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">form</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        sb.append(<span class="string">"["</span>);</div><div class="line">        sb.append(wrapComma(name));</div><div class="line">        sb.append(wrapComma(age));</div><div class="line">        sb.append(wrap(birth));</div><div class="line">        sb.append(<span class="string">"]"</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åï¼Œå†ä¿®æ”¹ä¸‹convertList2StringArray(List)æ–¹æ³•ï¼Œä½¿ä¹‹æ›´ä¸ºé€šç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertList2StringArray</span><span class="params">(List&lt;? extends ICommonForm&gt; list)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"[[]]"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">"["</span>);</div><div class="line">    <span class="keyword">for</span> (ICommonForm model : list) &#123;</div><div class="line">        sb.append(model.form());</div><div class="line">        sb.append(<span class="string">","</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    sb.replace(sb.length() - <span class="number">1</span>, sb.length(), <span class="string">"]"</span>);</div><div class="line">    <span class="keyword">return</span> sb.toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–°çš„æ–¹æ³•é‡Œï¼Œå‚æ•°å®šä¹‰å’Œforè¯­å¥å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯ç‰¹å®šçš„ç±»ï¼Œåªè¦æ˜¯å®ç°äº†ICommonFormæ¥å£çš„ç±»çš„åˆ—è¡¨ï¼Œéƒ½æ˜¯åˆæ³•çš„å‚æ•°ï¼Œå’Œå‰é¢æåˆ°çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">doSomeThing</span><span class="params">(List&lt;T extends BaseModel&gt; list)</span></span></div></pre></td></tr></table></figure>
<p>éå¸¸ç›¸ä¼¼ã€‚<br>è®¾è®¡æ¨¡å¼é‡Œï¼Œå¾ˆå¤šæ¨¡å¼éƒ½ç”¨åˆ°äº†å¤šæ€ï¼Œå¯ä»¥ç®€åŒ–ä»£ç å’Œç»“æ„ã€‚ä¸«å†™äº†å¿«ä¸¤å¹´Javaä»£ç ï¼Œæ‰ç»ˆäºèƒ½è‡ªç„¶çš„ã€ä¸»åŠ¨çš„æƒ³åˆ°ç”¨å¤šæ€æ¥è§£å†³é—®é¢˜â€¦â€¦</p>
<h3 id="4-é‡æ„è¶…é•¿çš„switch-caseè¯­å¥ï¼ˆ2016-09-04æ›´æ–°ï¼‰"><a href="#4-é‡æ„è¶…é•¿çš„switch-caseè¯­å¥ï¼ˆ2016-09-04æ›´æ–°ï¼‰" class="headerlink" title="4 é‡æ„è¶…é•¿çš„switch-caseè¯­å¥ï¼ˆ2016-09-04æ›´æ–°ï¼‰"></a>4 é‡æ„è¶…é•¿çš„switch-caseè¯­å¥ï¼ˆ2016-09-04æ›´æ–°ï¼‰</h3><p>æœ€è¿‘é¡¹ç›®é‡Œåšä¸€ä¸ªéœ€æ±‚ï¼Œè¦å¯¹å¤šä¸ªæŒ‡æ ‡æ±‡æ€»ï¼Œä½†æ¥å£å›ºå®šï¼Œé€šè¿‡å‚æ•°åŒºåˆ†æ˜¯å“ªä¸ªæŒ‡æ ‡ï¼Œå†…éƒ¨ç”¨äº†ä¸€ä¸ªswitch-caseæ¥åˆ¤æ–­ï¼Œè¶Šåˆ°åæ¥çªç„¶å‘ç°å·²ç»æœ‰äº†12ä¸ªcaseè¯­å¥ï¼Œä»£ç æŒç»­é›†æˆä¹Ÿæ˜¾ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªGod Classï¼Œå¦‚æ­¤çœ‹æ¥ï¼Œæ˜¯éœ€è¦é‡æ„è¿™ä¸ªswitch-caseè¯­å¥äº†ã€‚<br>æ€»ä½“æ€è·¯å°±æ˜¯å£°æ˜ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»ï¼Œæ·»åŠ æŠ½è±¡æ–¹æ³•å’Œä¸€äº›å…¬å…±çš„æˆå‘˜ï¼Œè®©å­ç±»æ¥ç»§æ‰¿å¹¶é‡å†™æ–¹æ³•ã€‚ä¸šåŠ¡é€»è¾‘é‡ŒæŠŠæŒ‡æ ‡ï¼ˆæšä¸¾ï¼‰åškeyï¼Œå­ç±»å®ä¾‹åšvalueï¼Œæ”¾åœ¨mapå¯¹è±¡é‡Œã€‚è¿™æ ·è°ƒç”¨æ—¶é€šè¿‡æŒ‡æ ‡è·å–å­ç±»å®ä¾‹ï¼Œç„¶åä¼ å…¥å‚æ•°ä¸€é€šæ“ä½œå°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Parent</span><span class="params">()</span> </span>&#123; &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child01</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Child01</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(String p1, String p2)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">int</span> ints = ...</div><div class="line">            <span class="keyword">return</span> ints;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            <span class="comment">// log</span></div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å…¶ä»–å­ç±»ç±»ä¼¼ï¼Œç»§æ‰¿Parentï¼Œå®ç°è‡ªå·±çš„é€»è¾‘</span></div></pre></td></tr></table></figure>
<p>åœ¨ä¸šåŠ¡é€»è¾‘é‡Œï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Map&lt;EnumType, Parent&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    map.put(EnumType.TYPE1, <span class="keyword">new</span> Child01());</div><div class="line">    map.put(EnumType.TYPE2, <span class="keyword">new</span> Child02());</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResultByType</span><span class="params">(EnumType type, String param1, String param2)</span> </span>&#123;</div><div class="line">    Optional&lt;Parent&gt; op = Optional.fromNullable(map.get(type)) <span class="comment">// Guava Optional</span></div><div class="line">    <span class="keyword">if</span> (op.isPresent()) &#123;</div><div class="line">        <span class="keyword">return</span> op.get().apply(param1, param2);</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ï¼Œä¸šåŠ¡é€»è¾‘é‡Œè¿è¡Œæ—¶ç»‘å®šï¼Œé€šè¿‡ä¸åŒæšä¸¾è·å–ä¸åŒå®ä¾‹ï¼Œå†è°ƒç”¨applyæ–¹æ³•ï¼Œå¤šæ€çš„åˆä¸€æ¬¡åº”ç”¨ï¼Œå…·ä½“çš„ä¸šåŠ¡å¤„ç†æ”¾åˆ°äº†å…·ä½“çš„å­ç±»ä¸­ï¼Œæ•´ä¸ªä»£ç ç»“æ„ä¹Ÿå˜å¾—æ¸…æ™°äº†å¾ˆå¤šã€‚ï¼ˆä½†æ˜¯ç±»çš„æ•°é‡çˆ†ç‚¸äº†è¯¶ğŸ’¥ï¼‰</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-17T06:09:16.000Z"><a href="/2016/04/17/add-env-var-on-OSX-md/">2016-04-17</a></time>
      
      
  
    <h1 class="title"><a href="/2016/04/17/add-env-var-on-OSX-md/">åœ¨OS Xä¸Šæ·»åŠ ç¯å¢ƒå˜é‡</a></h1>
  

    </header>
    <div class="entry">
      
        <p>åœ¨ Windows ä¸Šæ·»åŠ ç¯å¢ƒå˜é‡çš„æ“ä½œéƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚ä½†æ˜¯åœ¨ OSX ä¸Šè¿˜æ˜¯å¾ˆç”Ÿç–ï¼Œä¸Šæ¬¡åœ¨ OSX ä¸Šæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œè¿˜æ˜¯åœ¨åˆšä¹°ç¬”è®°æœ¬ï¼Œæ·»åŠ  Java ç¯å¢ƒå˜é‡ï¼Œå½“æ—¶æ·»åŠ å®Œäº†ï¼Œèµ·ä½œç”¨åå°±æ²¡ç®¡äº†ï¼Œä»Šå¤©åˆè¦æ·»åŠ  Scala ç¯å¢ƒå˜é‡æ—¶ï¼ŒåŸºæœ¬å¿˜äº†æ€ä¹ˆå¼„ï¼Œç°åœ¨æŠŠæ•´ä¸ªè¿‡ç¨‹è®°ä¸‹æ¥ã€‚   </p>
<p>OSX ä¸Šæ·»åŠ ç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªåœ°æ–¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ /etc/profile</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯å…¨å±€å…¬æœ‰é…ç½®ï¼Œä¸ç®¡å“ªä¸ªç”¨æˆ·ç™»å½•ï¼Œéƒ½ä¼šè¯»å–è¯¥æ–‡ä»¶ã€‚æ‰€ä»¥ä¸å»ºè®®åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ·»åŠ ã€‚</p>
<p>ç¬¬äºŒä¸ªåœ°æ–¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ /etc/bashrc</div></pre></td></tr></table></figure></p>
<p>ä¹Ÿæ˜¯å…¨å±€å…¬æœ‰é…ç½®ï¼Œä¸€èˆ¬åœ¨é‡Œé¢æ·»åŠ ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡ï¼Œæ‰§è¡Œ bash shell æ—¶ï¼Œä¼šè¯»å–è¯¥æ–‡ä»¶ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªåœ°æ–¹ï¼Œbash_profileï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ~/.bash_profile</div></pre></td></tr></table></figure></p>
<p>å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºè¯¥æ–‡ä»¶å³å¯ï¼Œç„¶åå¾€é‡Œé¢å†™å…¥ç¯å¢ƒå˜é‡å€¼ã€‚å½“çœ‹åˆ° bash_profile è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œçªç„¶æƒ³èµ·å½“åˆé… Java ç¯å¢ƒå˜é‡å¥½åƒå·²ç»å»ºå¥½äº†è¿™ä¸ªæ–‡ä»¶ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤æ‰“å¼€ä¸€çœ‹æœç„¶æœ‰ Java çš„ç¯å¢ƒå˜é‡é…ç½®ã€‚é…ç½®è¿‡ç¨‹å¦‚ä¸‹ã€‚<br>è¾“å…¥å¦‚ä¸‹å‘½ä»¤åï¼ŒæŒ‰ä¸‹ <kbd>i</kbd> é”®ï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim ~/.bash_profile</div></pre></td></tr></table></figure></p>
<p>æ·»åŠ ç¯å¢ƒå˜é‡å¯¹åº”çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼Œéœ€è¦æ·»åŠ  Scala ç¯å¢ƒå˜é‡è·¯å¾„ï¼Œåœ¨æ–‡ä»¶æœ€åå†™å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=&quot;$PATH:/usr/local/scala-path/bin&quot;</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ï¼Œscala-path æ˜¯ä»å®˜ç½‘ä¸‹è½½ä¸‹æ¥çš„è§£å‹åçš„æ–‡ä»¶å¤¹ï¼Œæ”¾åœ¨ /usr/local/ç›®å½•ä¸‹ã€‚å®ŒæˆåæŒ‰ <kbd>esc</kbd> é”®ï¼Œè¿›å…¥æ™®é€šæ¨¡å¼ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ä¿å­˜å¹¶é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:wq</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶é‡å¯ç»ˆç«¯ï¼Œè¾“å…¥ Scalaï¼Œå°±è¿›å…¥äº† Scala çš„å‘½ä»¤æ¨¡å¼ã€‚æ­¤æ—¶ä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Welcome to Scala 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0).</div><div class="line">Type in expressions for evaluation. Or try :help.</div></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦é€€å‡º Scala å‘½ä»¤æ¨¡å¼ï¼Œè¾“å…¥ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:q  æˆ–è€…  :quit</div></pre></td></tr></table></figure></p>
<p>æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚:)</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-10T06:01:39.000Z"><a href="/2016/04/10/a-simple-python-spider-md/">2016-04-10</a></time>
      
      
  
    <h1 class="title"><a href="/2016/04/10/a-simple-python-spider-md/">ä¸€ä¸ªç®€å•çš„Pythonçˆ¬è™«</a></h1>
  

    </header>
    <div class="entry">
      
        <p>ç”±äºæˆ‘ç»å¸¸é€›å¾®åšï¼Œçœ‹åˆ°æŸäº›åšä¸»çš„å›¾ç‰‡éƒ½å¾ˆå¥½çœ‹ï¼ˆä½ æ‡‚çš„ï¼‰ï¼Œå°±æƒ³å¹²è„†ä¸‹è½½åˆ°æœ¬åœ°ï¼Œäºæ˜¯èŒç”Ÿäº†æä¸ªçˆ¬è™«çš„æƒ³æ³•ã€‚ä¹‹å‰å¬è¯´ Python ç½‘ç»œçˆ¬è™«ï¼Œå¬èµ·æ¥é«˜å¤§ä¸Šï¼Œåœ¨å®è·µäº†åæ„Ÿè§‰ä¹Ÿä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œç°åœ¨æ¥çœ‹è‡ªå·±å®ç°çš„çˆ¬è™«éƒ½å¾ˆç®€å•ï¼Œä»¥åè¦å®ç°æ›´å¤æ‚çš„çˆ¬è™«çš„è¯ï¼Œçœ‹äº†è¿™ç¯‡åšå®¢å’Œä»£ç ï¼Œèƒ½è®©è‡ªå·±ä¹Ÿèƒ½å¿«é€Ÿçš„æ¡èµ·æ¥ï¼Œè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p>
<p>é™¤äº†éœ€è¦ Python ç¯å¢ƒå¤–ï¼Œè¿˜éœ€è¦å®‰è£… requestsã€BeautifulSoup4ç­‰ã€‚è·å–å¾®åšé¡µé¢å†…å®¹æ—¶ä½¿ç”¨cookieçš„æ–¹å¼ï¼Œè¿™æ ·ä¸éœ€è¦ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥è¯·æ±‚åˆ°å¾®åšã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install requests BeautifulSoup4</div></pre></td></tr></table></figure></p>
<p>å¥½äº†ï¼Œå‡†å¤‡å·¥ä½œåŸºæœ¬OKã€‚è¿™ä¸ªçˆ¬è™«æ˜¯ä»æ–°æµªå¾®åšä¸Šçˆ¬å–æŸä¸ªåšä¸»çš„æ‰€æœ‰å›¾ç‰‡ï¼Œåœ¨è§‚å¯Ÿäº†æ–°æµªå¾®åšé‡Œå›¾ç‰‡URLçš„è§„å¾‹åï¼Œå‘ç°é“¾æ¥ä¸»è¦æœ‰3éƒ¨åˆ†æ„æˆï¼Œå¦‚ä¸‹ã€‚img-key éƒ¨åˆ†æˆ‘ä¼°è®¡æ˜¯å­˜å–å›¾ç‰‡çš„å”¯ä¸€IDå€¼ï¼Œpart2 å–ä¸åŒçš„å€¼ï¼Œä¼šå¾—åˆ°ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œæœ€å¤§å°ºå¯¸æ—¶ï¼Œpart2å–å€¼ â€˜largeâ€™ï¼Œæœ‰äº†è¿™ä¸ªè§„å¾‹å°±å¥½åŠäº†ï¼Œå°†é¡µé¢æ‰€æœ‰å›¾ç‰‡æ»¡è¶³3æ®µå¼çš„é“¾æ¥ä¸­é—´é‚£éƒ¨åˆ†æ›¿æ¢æˆâ€™largeâ€™ï¼Œå†ä¸‹è½½å›¾ç‰‡å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://ww2.sinaimg.cn/part2/img-key.jpg</div></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ <em>weibo.cn</em> åŸŸåï¼Œä»æµè§ˆå™¨é‡Œå¾—åˆ°æ˜¯ä¸€å¼ å›¾ç‰‡å’Œä¸€ä¸ª<strong>æ›´å¤š</strong>ä½œä¸ºé“¾æ¥ï¼Œç‚¹äº†é“¾æ¥æ‰çœ‹å¾—åˆ°æ‰€æœ‰å›¾ç‰‡ï¼Œæ‰€ä»¥çˆ¬æ¯ä¸ªé¡µé¢æœ‰ä¸ªäºŒæ¬¡è¯·æ±‚ï¼Œå°†æ›´å¤šçš„å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ã€‚ä¸ºäº†é¿å…é‡å¤ä¸‹è½½å¯¼è‡´å›¾ç‰‡éš¾ä»¥ç»´æŠ¤ï¼Œä¿å­˜å›¾ç‰‡æ—¶ï¼Œå°†å¾®åšçš„å‘å¸ƒæ—¥æœŸå’Œå›¾ç‰‡é“¾æ¥çš„MD5å€¼ç»„åˆæˆå›¾ç‰‡åç§°ï¼Œè¿™æ ·ä¸‹è½½åˆ°æœ¬åœ°åï¼Œå›¾ç‰‡ä¼šä»¥åœ¨å¾®åšä¸Šå‘å¸ƒçš„æ—¥æœŸæ’åºï¼ŒåŒæ—¶ï¼Œå†æ¬¡è¿è¡Œçˆ¬è™«æ—¶ï¼Œå°†å›¾ç‰‡åç§°ååŠæˆªçš„MD5å€¼æå–å‡ºæ¥ï¼Œåœ¨ä¸‹è½½æ—¶å€™å¯¹æ¯”è¯¥å›¾ç‰‡çš„é“¾æ¥MD5å€¼æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œé¿å…é‡å¤ä¸‹è½½ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸‹è½½ä¸€ä¸ªé¡µé¢é‡Œæ‰€æœ‰å›¾ç‰‡çš„å‡½æ•°ä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_one_page</span><span class="params">(soup, user_id, exists)</span>:</span></div><div class="line"><span class="string">"""</span></div><div class="line">download all pictures on the website</div><div class="line">:param soup: web page soup</div><div class="line">:param user_id: the weibo user id</div><div class="line">:param exists exists pic names</div><div class="line">:return: find weibo divs, return True, else False</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="comment"># ten weibo div in every page</span></div><div class="line">divs = soup.find_all(div_filter_func)</div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> divs:</div><div class="line">    <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> div <span class="keyword">in</span> divs:</div><div class="line">    spans = div.find_all(<span class="string">'span'</span>)</div><div class="line">    wb_post_time = get_weibo_post_time(spans[<span class="number">1</span>].text)</div><div class="line"></div><div class="line">    <span class="comment"># abstract a link</span></div><div class="line">    all_img = div.find_all(<span class="string">'img'</span>)</div><div class="line">    img_link = filter(<span class="keyword">lambda</span> x: x.endswith(<span class="string">'.jpg'</span>), [all_img[<span class="number">0</span>].get(<span class="string">'src'</span>)] <span class="keyword">if</span> all_img <span class="keyword">else</span> [])</div><div class="line"></div><div class="line">    <span class="comment"># abstract more links</span></div><div class="line">    more_links = [link[<span class="string">'href'</span>] <span class="keyword">for</span> link <span class="keyword">in</span> div.find_all(<span class="string">'a'</span>) <span class="keyword">if</span> link.get(<span class="string">'href'</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>]</div><div class="line">    more_links_real = [x <span class="keyword">for</span> x <span class="keyword">in</span> more_links <span class="keyword">if</span> <span class="string">'picAll'</span> <span class="keyword">in</span> x]</div><div class="line">    <span class="keyword">if</span> more_links_real:</div><div class="line">        more_content = requests.get(more_links_real[<span class="number">0</span>], cookies = get_cookie())</div><div class="line">        more_soup = BeautifulSoup(more_content.content, <span class="string">'html.parser'</span>)</div><div class="line">        more_soup_urls = get_more_page_image_url(more_soup)</div><div class="line">        img_link = more_soup_urls <span class="keyword">if</span> more_soup_urls <span class="keyword">else</span> img_link</div><div class="line"></div><div class="line">    <span class="comment"># download</span></div><div class="line">    <span class="keyword">for</span> idx, link <span class="keyword">in</span> enumerate(img_link):</div><div class="line">        md5 = calculate_md5(link)</div><div class="line">        <span class="keyword">if</span> md5 <span class="keyword">not</span> <span class="keyword">in</span> exists:</div><div class="line">            large_link = replace_part2_in_link(link)</div><div class="line">            image_content = requests.get(large_link, cookies = get_cookie())</div><div class="line"></div><div class="line">            image_name = <span class="string">"&#123;&#125;&gt;&#123;&#125;_&#123;&#125;"</span>.format(wb_post_time, str(idx), md5)</div><div class="line">            <span class="keyword">with</span> open(<span class="string">'./downloads/&#123;&#125;/&#123;&#125;.jpg'</span>.format(user_id, image_name), <span class="string">'wb'</span>) <span class="keyword">as</span> jpg:</div><div class="line">                jpg.write(image_content.content)</div><div class="line"></div><div class="line">                exists.add(image_name)</div><div class="line">                print(<span class="string">'download'</span>, large_link, image_name, datetime.datetime.now())</div><div class="line">                time.sleep(random.random())</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            print(<span class="string">'jump over:'</span>, link)</div><div class="line"></div><div class="line">sleep = <span class="number">8</span> * random.random()</div><div class="line">print(<span class="string">'sleep'</span>, sleep, <span class="string">'seconds'</span>)</div><div class="line">time.sleep(sleep)</div><div class="line"><span class="keyword">return</span> <span class="keyword">True</span></div></pre></td></tr></table></figure>
<p>åœ¨æŸæ¬¡æ‰“ç®—çˆ¬å–å¤§é‡æŸä¸ªåšä¸»çš„å›¾ç‰‡æ—¶ï¼Œå‡ºç°äº†è¯·æ±‚å¤±è´¥ï¼ŒæŸ¥äº†èµ„æ–™å‘ç°æ˜¯ç½‘ç«™æœ‰åçˆ¬è™«åŠŸèƒ½ï¼Œäºæ˜¯ä½¿ç”¨äº†ä¸€äº›ç®€å•çš„ç­–ç•¥ï¼Œæ¯”å¦‚è¯·æ±‚åŠ ä¸Šå¤´æ¶ˆæ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">header = &#123;</div><div class="line">      <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36'</span>,</div><div class="line">      <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</div><div class="line">      <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8,en;q=0.6'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹è¯·æ±‚çš„cookieä¹Ÿåœ¨æœ«å°¾æ·»åŠ éšæœºæ•°ï¼Œæ¯æ¬¡ç”¨ä¸åŒçš„cookieå»è¯·æ±‚ï¼Œå¹¶ä¸”ï¼Œæ¯çˆ¬å–å®Œä¸€ä¸ªé¡µé¢çš„å†…å®¹ï¼Œéšæœºä¼‘çœ 0-8ç§’ï¼Œè¿™æ ·åšè™½ç„¶æŠ“å–é€Ÿåº¦æ…¢äº†ç‚¹ï¼Œä½†è‡³å°‘èƒ½ä¿è¯æ¯æ¬¡æŠ“å–ä¸ä¼šåŠé€”æŠ¥é”™ã€‚</p>
<p>å®Œæ•´çš„ä»£ç ç¤ºä¾‹<a href="https://github.com/hsqs/spiders/blob/master/weibo/weibo_miner.py" target="_blank" rel="external">ç‚¹è¿™é‡Œ</a>ã€‚    </p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-03-27T05:53:45.000Z"><a href="/2016/03/27/use-virtualenv-md/">2016-03-27</a></time>
      
      
  
    <h1 class="title"><a href="/2016/03/27/use-virtualenv-md/">åœ¨OS Xä¸Šä½¿ç”¨virtualenv</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1ï¼Œç†è§£virtualenv"><a href="#1ï¼Œç†è§£virtualenv" class="headerlink" title="1ï¼Œç†è§£virtualenv"></a>1ï¼Œç†è§£virtualenv</h3><p>virtualenvä»å­—é¢æ„æ€æ¥ç†è§£çš„è¯ï¼Œå°±æ˜¯è™šæ‹Ÿç¯å¢ƒçš„æ„æ€ï¼Œè¿™ä¸ªç¬¬ä¸€å°è±¡å®¹æ˜“å¯¹æˆ‘ä»¬äº§ç”Ÿè¯¯å¯¼ï¼Œå…¶å®å¹¶ä¸æ˜¯è™šæ‹Ÿç¯å¢ƒï¼Œä»¥æˆ‘çš„ç†è§£æ˜¯ä¸€ä¸ª<strong>ç‹¬ç«‹</strong>ç¯å¢ƒã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¥½æ¯”ä¸€å°ç”µè„‘ä¸Šè£…å¥½Pythonä»¥åï¼Œå¯ä»¥æŠŠå®‰è£…çš„Pythonæ‹·è´åˆ°å¦ä¸€ä¸ªç›®å½•(å®˜æ–¹:å…¶å®å¹¶æ²¡æœ‰çœŸæ­£å®‰è£…å¤šä¸ª Python å‰¯æœ¬ï¼Œä½†æ˜¯å®ƒç¡®å®æä¾›äº†ä¸€ç§å·§å¦™çš„æ–¹å¼æ¥è®©å„é¡¹ç›®ç¯å¢ƒä¿æŒç‹¬ç«‹)ï¼Œè¿™æ ·ä¸¤ä¸ªPythonç¯å¢ƒç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œé‚£æœ‰äº†å¤šä¸ªPythonç¯å¢ƒï¼Œåœ¨ä»€ä¹ˆæ—¶å€™å¯ç”¨è°ç¦ç”¨è°å‘¢ï¼Ÿvirtualenvè¿™ä¸ªæ—¶å€™å°±æ´¾ä¸Šç”¨åœºäº†ã€‚å®˜æ–¹å¯¹virtualenvçš„è§£é‡Šï¼š<a href="https://virtualenv.pypa.io/" target="_blank" rel="external">virtualenv is a tool to create isolated Python environments</a>.</p>
<h3 id="2ï¼Œå®‰è£…virtualenv"><a href="#2ï¼Œå®‰è£…virtualenv" class="headerlink" title="2ï¼Œå®‰è£…virtualenv"></a>2ï¼Œå®‰è£…virtualenv</h3><p>å®‰è£…å°±å¤ªç®€å•äº†ï¼Œä½¿ç”¨pipå®‰è£…å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install virtualenv</div></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰æƒé™é—®é¢˜ï¼Œå‰é¢åŠ ä¸€ä¸ªsudo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo pip install virtualenv</div></pre></td></tr></table></figure>
<h3 id="3ï¼Œä½¿ç”¨virtualenv"><a href="#3ï¼Œä½¿ç”¨virtualenv" class="headerlink" title="3ï¼Œä½¿ç”¨virtualenv"></a>3ï¼Œä½¿ç”¨virtualenv</h3><p>é¦–å…ˆæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ç©ºæ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯é‡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼ˆPythonå·²ç»å®‰è£…åˆ°ç”µè„‘ä¸Šï¼‰ï¼š</p>
<pre><code>$ virtualenv [-p python3] dir-name
</code></pre><p>å¦‚æœç”µè„‘ä¸Šå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„Pythonï¼Œé»˜è®¤ä¼šä½¿ç”¨OS Xè‡ªå¸¦çš„2.7ç‰ˆæœ¬ï¼Œå¦‚æœæƒ³åˆ›å»º3.0ä»¥ä¸Šçš„ç‰ˆæœ¬çš„è¯ï¼ŒæŒ‡å®šç‰ˆæœ¬å‚æ•°å³å¯ã€‚è¾“å…¥å®Œæˆå›è½¦ï¼Œå¯ä»¥åˆ°Finderé‡ŒæŸ¥çœ‹ç›®å½•dir-nameï¼Œé‡Œé¢æœ‰binã€includeã€libä¸‰ä¸ªç›®å½•ã€‚æœ€åä¸€æ­¥ï¼Œç»§ç»­åœ¨ç»ˆç«¯é‡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæ¿€æ´»è¿™ä¸ªåˆšåˆšåˆ›å»ºçš„ç¯å¢ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">source</span> dir-name/bin/activate</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ï¼Œå½“å‰Pythonç¯å¢ƒå°±æ¿€æ´»äº†ï¼Œç»ˆç«¯ä¹Ÿä¼šæœ‰ç›¸åº”çš„å˜åŒ–ï¼Œåœ¨æœ€å‰é¢ä¼šå‡ºç°å½“å‰ç¯å¢ƒçš„åå­—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(dir-name)your-computer-name $:</div></pre></td></tr></table></figure>
<p>hahï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªè€Œç¯å¢ƒé‡Œå¼€å‘Flaskåº”ç”¨ï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install Flask</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼ŒFlaskä¼šå®‰è£…åœ¨dir-nameé‡Œï¼Œè€Œä¸ä¼šå®‰è£…åœ¨å…¶ä»–ç¯å¢ƒï¼Œè¿™æ ·å°±è¾¾åˆ°äº†isolatedçš„æ•ˆæœã€‚å¦‚æœä¸å†ä½¿ç”¨å½“å‰ç¯å¢ƒï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ deactivate</div></pre></td></tr></table></figure>
<h3 id="4ï¼Œåˆ é™¤virtualenv"><a href="#4ï¼Œåˆ é™¤virtualenv" class="headerlink" title="4ï¼Œåˆ é™¤virtualenv"></a>4ï¼Œåˆ é™¤virtualenv</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rmvirtualenv env-name</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-12-27T05:36:04.000Z"><a href="/2015/12/27/some-usage-of-mybatis-md/">2015-12-27</a></time>
      
      
  
    <h1 class="title"><a href="/2015/12/27/some-usage-of-mybatis-md/">Mybatisä½¿ç”¨ç»éªŒæ€»ç»“</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Mybatiså‰ååœ¨é¡¹ç›®é‡Œä¸€å…±ç”¨äº†å¤§æ¦‚1å¹´æ—¶é—´ï¼Œå½“æ—¶ä¸ºäº†èµ¶è¿›åº¦ï¼Œåªå­¦äº†äº›åŸºæœ¬çš„ç”¨æ³•ï¼Œåæ¥æ…¢æ…¢ç§¯ç´¯äº†ä¸€äº›å°æŠ€å·§ï¼Œå…¶å®è¿™äº›éƒ½åœ¨å®˜æ–¹æ–‡æ¡£é‡Œéƒ½æœ‰è¯´æ˜ï¼Œåªæ˜¯è‡ªå·±ç”¨åˆ°è€Œå·²ã€‚</p>
<h3 id="1ã€foreach-inçµæ´»ä½¿ç”¨"><a href="#1ã€foreach-inçµæ´»ä½¿ç”¨" class="headerlink" title="1ã€foreach-inçµæ´»ä½¿ç”¨"></a>1ã€foreach-inçµæ´»ä½¿ç”¨</h3><p>åœ¨ä½¿ç”¨ foreach æ ‡ç­¾æ—¶ï¼Œé€šå¸¸ç”¨äºæ„å»º IN å­æŸ¥è¯¢æˆ–æ’å…¥æ•°æ®è¯­å¥ï¼Œæ„å»º IN è¯­å¥çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"m"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">    #&#123;m&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div></pre></td></tr></table></figure>
<p>foreach çš„å„é¡¹å‚æ•°å°±ä¸ç”¨å¤šè§£é‡Šäº†ï¼Œè¿™é‡Œï¼Œopen å’Œ close éƒ½æ˜¾ç¤ºçš„å†™åˆ°äº†foreachæ ‡ç­¾é‡Œã€‚åŒç†ï¼Œå½“æ„å»ºæ’å…¥å¤šæ¡æ•°æ®çš„è¯­å¥æ—¶ï¼ŒåŒæ ·çš„è¯­æ³•ï¼Œä¸è¿‡ç¨æœ‰ç‚¹å˜åŒ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"m"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></div><div class="line">    (#&#123;m.id&#125;, #&#123;m.name&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œforeach é‡Œçš„è¯­å¥æ˜¯å¸¦äº†åœ†æ‹¬å·ï¼Œå»æ‰äº† open å’Œ close å±æ€§ï¼Œåˆ†éš”ç¬¦ä¾æ—§æ˜¯,ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€ç§å¯¹ values åé¢ SQL çš„ä¸€ç§åˆ†è§£æ–¹å¼ï¼Œæˆ–è€…ç”¨ä¸‹é¢è¿™ç§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"m"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">"),("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">    #&#123;m.id&#125;, #&#123;m.name&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œå”¯ä¸€æ³¨æ„çš„æ˜¯ separator çš„å˜åŒ–ï¼Œè¿™ä¸¤ç§æ’å…¥æ•°æ®æ—¶çš„å†™æ³•ï¼Œæ•ˆæœéƒ½æ˜¯ä¸€è‡´çš„ã€‚æƒ³åˆ°è¿™é‡Œï¼Œseparator å¯ä»¥æ˜¯å¤šä¸ªå­—ç¬¦ï¼Œç”šè‡³æ˜¯SQLè¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œæ€ä¹ˆä½¿ç”¨å°±çœ‹ä¸šåŠ¡åœºæ™¯äº†ã€‚</p>
<h3 id="2ã€SQL-æ³¨è§£"><a href="#2ã€SQL-æ³¨è§£" class="headerlink" title="2ã€SQL æ³¨è§£"></a>2ã€SQL æ³¨è§£</h3><p>å¯¹äºæ¯”è¾ƒç®€å•çš„ä¸€ä¸¤è¡Œçš„ SQLï¼Œå¯ä»¥ä¸ç”¨åœ¨ mapper æ–‡ä»¶é‡Œå†™é…ç½®ï¼Œç›´æ¥åœ¨Javaä»£ç é‡Œæ·»åŠ æ³¨è§£çš„æ–¹å¼æ¥å®ç°ã€‚è¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨å†å»æ‰¾ xml æ–‡ä»¶é‡Œçš„ SQL ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Select</span>(<span class="string">"SELECT name FROM user WHERE province_id = #&#123;address&#125; AND gender = #&#123;gender&#125;"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">selectName</span><span class="params">(@Param(<span class="string">"address"</span>)</span>Integer address, @<span class="title">Param</span><span class="params">(<span class="string">"gender"</span>)</span><span class="keyword">char</span> gender)</span>;</div></pre></td></tr></table></figure>
<p>é™¤äº†@Select æ³¨è§£ï¼Œè¿˜æœ‰@Insertã€@Updateã€@Deleteï¼Œä½¿ç”¨æ–¹æ³•åŒä¸Šã€‚è¿™æ ·SQLå’ŒJavaä»£ç æ”¾åœ¨ä¸€èµ·ï¼Œ<br>æŸ¥çœ‹èµ·æ¥éå¸¸çš„æ–¹ä¾¿ã€‚</p>
<h3 id="3ã€æ³¨è§£å‚æ•°"><a href="#3ã€æ³¨è§£å‚æ•°" class="headerlink" title="3ã€æ³¨è§£å‚æ•°"></a>3ã€æ³¨è§£å‚æ•°</h3><p>åœ¨ä¼ å…¥å¤šä¸ªå‚æ•°åˆ° Mybatis çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨Listã€Mapä¼ é€’ï¼Œå¯¹äºMapè¿™ç§æƒ…å†µæ¯”è¾ƒéº»çƒ¦ï¼Œé¦–å…ˆè¦ä¸“é—¨æ„é€ ä¸€ä¸ªMapï¼Œå¦å¤–æœ€éš¾ä»¥å¿å—çš„æ˜¯ç”¨Mapä¼ å¤šä¸ªå‚æ•°ä¸çŸ¥é“é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆå†…å®¹ï¼Œåªæœ‰åˆ°æ‰§è¡ŒSQLæ—¶æ‰ä¼šæŠ¥å‡ºé—®é¢˜ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿæä¸ºéº»çƒ¦ã€‚<br>è¿™é‡Œå¯ä»¥ä½¿ç”¨å‚æ•°æ³¨è§£ï¼Œçœå»è¿™ä¸€å †æ­¥éª¤ã€‚åŒæ—¶ï¼Œç›´è§‚çš„å±•ç¤ºæœ‰å“ªäº›å˜é‡ä¼ å…¥SQLï¼Œè¿™æ ·è°ƒç”¨æ¥å£ä¼ å‚æ•°å°±å¯ä»¥äº†ï¼Œè°ƒç”¨è€…ä¸ç”¨å…³å¿ƒ SQL é‡Œå‚æ•°ç”¨çš„æ˜¯å“ªä¸ªåå­—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">selectName</span><span class="params">(@Param(<span class="string">"address"</span>)</span>List&lt;Integer&gt; addrs, @<span class="title">Param</span><span class="params">(<span class="string">"gender"</span>)</span><span class="keyword">char</span> gds)</span>;</div></pre></td></tr></table></figure>
<p>åœ¨mapperæ–‡ä»¶é‡Œï¼Œç”¨ @Param é‡Œçš„æ³¨è§£åç§°æ¥å–å‚æ•°ï¼Œä¾‹å¦‚è¿™é‡Œçš„addresså’Œgenderï¼ŒSQLé‡Œå–å‚æ•°æ–¹å¼ä¸å˜ï¼Œç”¨#{gender}æˆ–${gender}ã€‚</p>
<h3 id="4ã€insertå’Œselectè¯­å¥è°ƒä¼˜ï¼ˆ2016-07-21-è¡¥å……ï¼‰"><a href="#4ã€insertå’Œselectè¯­å¥è°ƒä¼˜ï¼ˆ2016-07-21-è¡¥å……ï¼‰" class="headerlink" title="4ã€insertå’Œselectè¯­å¥è°ƒä¼˜ï¼ˆ2016-07-21 è¡¥å……ï¼‰"></a>4ã€insertå’Œselectè¯­å¥è°ƒä¼˜ï¼ˆ2016-07-21 è¡¥å……ï¼‰</h3><p>åœ¨æ’å…¥æˆ–æŸ¥è¯¢æ—¶ï¼Œåœ¨mapperæ–‡ä»¶é‡Œï¼Œselectè¦å†™resultMapæ ‡ç­¾æ¥æ˜ å°„å±æ€§å’Œåˆ—çš„å…³ç³»ï¼Œinsertè¯­å¥è¦å†™ä¸€ä¸ªforeachè¯­å¥æ¥æ‹¼æ¥valuesåé¢çš„å†…å®¹ï¼Œè¿™ä¸€åˆ‡éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“ä¸€æ¬¡æ€§æŸ¥è¯¢æˆ–æ’å…¥ä¸Šåƒã€ä¸Šä¸‡æ¡æ•°æ®ï¼ŒMybatiså°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚Mybatisè™½ç„¶æœ‰å¼ºå¤§çš„åŠ¨æ€æ‹¼æ¥SQLçš„èƒ½åŠ›ï¼Œä½†æ­¤æ—¶åº”ç”¨æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥è€ƒè™‘å°½é‡å‡å°‘Mybatisçš„å·¥ä½œï¼ŒæŠŠå®ƒä»…ä»…å½“åšæ˜¯SQLè¯­å¥æ¥æ‰§è¡Œã€‚     </p>
<p>å¯¹insertè¯­å¥ï¼Œvaluesåé¢çš„å†…å®¹å¯ä»¥é¢„å…ˆåœ¨Javaä»£ç é‡Œæ‹¼æ¥å¥½ï¼Œç›´æ¥ä¼ å…¥ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertPOJO"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span>&gt;</span></div><div class="line">    insert into </div><div class="line">        table(...)</div><div class="line">    values</div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"value"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">            $&#123;value&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ç”šè‡³ï¼Œè¿foreachæ ‡ç­¾ä¹Ÿå»æ‰ï¼Œåœ¨Javaé‡Œå°±å…¨éƒ¨æ‹¼æ¥å¥½ã€‚ä¸è¿‡æˆ‘æ¯”è¾ƒå€¾å‘äºä¸Šé¢è¿™ç§ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯æ’å…¥å¤šæ¡æ•°æ®ï¼Œåˆä¸è‡³äºæ’å…¥é€Ÿç‡å¤ªæ…¢ã€‚  </p>
<p>å¯¹selectè¯­å¥ç±»ä¼¼ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPOJO"</span> <span class="attr">resultType</span>=<span class="string">"java.util.Map"</span>&gt;</span></div><div class="line">    select </div><div class="line">        *</div><div class="line">    from</div><div class="line">        table</div><div class="line">    where</div><div class="line">        ...    </div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œè®©è¿”å›å€¼ä¸ºMapï¼Œåœ¨Javaé‡Œç”¨ List&lt;Map&lt;Object, Object&gt;&gt; æ¥æ”¶ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å°†è¿”å›ç»“æœå†è½¬æ¢ä¸ºList&lt;Pojo&gt;å¯¹è±¡ã€‚å·¥ä½œé‡å¢åŠ äº†ä¸€äº›ï¼Œä½†å¯¹æ•°æ®æµè¾ƒå¤§çš„æŸ¥è¯¢ï¼Œæ€§èƒ½æå‡æ¯”è¾ƒæ˜æ˜¾ï¼ŒæŸ¥ä¸€ä¸‡æ¡ï¼ˆæ¯æ¡æ¥è¿‘40åˆ—ï¼‰ä»æ¥è¿‘ä¸¤ç§’å‡å°‘åˆ°ä¸åˆ°ä¸€ç§’ï¼Œè¿˜æ˜¯å€¼å¾—çš„ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 ç‹ä¹å¿ƒçš„åšå®¢
  
  <p>Theme by <a href="https://caisiduo.xyz" target="_blank">LightOne</a></p>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
