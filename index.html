<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Ling0fa çš„åšå®¢</title>
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Ling0fa çš„åšå®¢"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Ling0fa çš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Ling0fa çš„åšå®¢</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-07-22T06:54:52.000Z"><a href="/2018/07/22/tune-idea-on-startup/">2018-07-22</a></time>
      
      
  
    <h1 class="title"><a href="/2018/07/22/tune-idea-on-startup/">Idea å¯åŠ¨è°ƒä¼˜</a></h1>
  

    </header>
    <div class="entry">
      
        <p>è¯´å®è¯ï¼Œidea çœŸçš„æ˜¯ç¬¬ä¸€æ¬¡ç”¨å°±å–œæ¬¢ä¸Šäº†ï¼Œä½†å¹³æ—¶å¼€å‘éƒ½åœ¨å…¬å¸ï¼Œç”µè„‘å’Œä»£ç éƒ½ä¸å…è®¸å¸¦å›å®¶ï¼Œåœ¨å®¶å†™ä»£ç çš„æ—¶å€™å¾ˆå°‘ï¼Œæ‰€ä»¥å®‰è£… Community ç‰ˆè¶³å¤Ÿäº†ï¼Œä¸ç„¶æ—©å°±ä¹°äº† Ultimate ç‰ˆã€‚<br><img src="/pic/takemymoney.jpg" alt="shut up and take my money"></p>
<h3 id="å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶"><a href="#å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶" class="headerlink" title="å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶"></a>å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶</h3><p>å…ˆå®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œå½“å‰æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Version: 2018.1.6</div><div class="line">Build: 181.5540.7</div><div class="line">Released: July 12, 2018</div></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåæ‰“å¼€å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶ï¼Œæˆ‘ç”¨çš„æ˜¯ Macï¼Œå¯ä»¥åœ¨ <code>Application</code> é‡Œæ‰¾åˆ° <code>IntelliJ Idea CE</code> åé¼ æ ‡å³é”®é€‰æ‹©<code>æ˜¾ç¤ºåŒ…å†…å®¹</code>ï¼Œæ‰¾åˆ° <code>Contents/bin/idea.vmoptions</code> æ–‡ä»¶å°±æ˜¯ idea çš„å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶ã€‚æ‰“å¼€çœ‹ä¸€ä¸‹é»˜è®¤é…ç½®ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">-Xms128m</div><div class="line">-Xmx750m</div><div class="line">-XX:ReservedCodeCacheSize=240m</div><div class="line">-XX:+UseCompressedOops</div><div class="line">-Dfile.encoding=UTF-8</div><div class="line">-XX:+UseConcMarkSweepGC</div><div class="line">-XX:SoftRefLRUPolicyMSPerMB=50</div><div class="line">-ea</div><div class="line">-Dsun.io.useCanonCaches=false</div><div class="line">-Djava.net.preferIPv4Stack=true</div><div class="line">-XX:+HeapDumpOnOutOfMemoryError</div><div class="line">-XX:-OmitStackTraceInFastThrow</div><div class="line">-Xverify:none</div><div class="line"></div><div class="line">-XX:ErrorFile=$USER_HOME/java_error_in_idea_%p.log</div><div class="line">-XX:HeapDumpPath=$USER_HOME/java_error_in_idea.hprof</div><div class="line"></div><div class="line">-XX:+PrintGCDetails</div><div class="line">-XX:+PrintGCDateStamps</div><div class="line">-Xloggc:./idea.gc.log</div></pre></td></tr></table></figure>
<p><code>-Xverify:none</code> ç¦æ­¢äº†å­—èŠ‚ç éªŒè¯ï¼Œæ¯•ç«Ÿ idea ä»£ç çš„å¯é æ€§æ˜¯ç»è¿‡æ— æ•°æ¬¡çš„è¿è¡ŒéªŒè¯äº†çš„ï¼Œæ‰€ä»¥å¯åŠ¨æ—¶è¿™ä¸€æ­¥å¯ä»¥å…³é—­ã€‚æœ€åä¸‰è¡Œæ˜¯æˆ‘åŠ çš„ï¼Œå…¶ä½™æ²¡æœ‰åšä¿®æ”¹ã€‚æœ‰å‡ ä¸ªä¸å¤ªå¸¸ç”¨çš„å‚æ•°ï¼Œå‚è€ƒäº† JVMPocket ç­‰èµ„æ–™ï¼Œåœ¨ JDK8 é‡Œçš„å«ä¹‰å¦‚ä¸‹ï¼š<br>|å‚æ•°|å«ä¹‰|<br>|â€”â€“|â€”â€“|<br>|-XX:ReservedCodeCacheSize|å’Œ <code>-Xmaxjitcodesize</code> ç­‰ä»·ï¼Œç”¨æ¥è®¾ç½® CodeCache çš„æœ€å¤§å€¼ï¼ŒCodeCache æ˜¯ç”¨æ¥å­˜æ”¾ JIT ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼ŒJDK8 64 ä½ç³»ç»Ÿä¸‹é»˜è®¤ 240Mï¼Œå¦‚æœ CodeCache æ»¡äº†ï¼Œä¼šè¾“å‡º <em>CodeCache is full</em> æ—¥å¿—ï¼Œå¹¶ç¦æ­¢å³æ—¶ç¼–è¯‘ï¼Œå¦‚æœå¯ç”¨ <code>-XX:+UseCodeCacheFlushing</code> å‚æ•°ï¼Œä¼šä¸¢å¼ƒä¸€èˆ¬è€çš„ä»£ç ï¼Œå¹¶åœ¨å¯ç”¨ç©ºé—´è¶…è¿‡ <code>-XX:CodeCacheMinimumFreeSpace=&lt;N&gt;</code> æŒ‡å®šçš„ç©ºé—´ï¼ˆé»˜è®¤ 500Kï¼‰åå¯ç”¨å³æ—¶ç¼–è¯‘ã€‚<a href="https://blogs.oracle.com/poonam/why-do-i-get-message-codecache-is-full-compiler-has-been-disabled" target="_blank" rel="external">å‚è€ƒ</a>ã€‚|<br>|-XX:+UseCompressedOops|64 ä½ OS ä¸‹æœ‰æ•ˆï¼Œå¯åŠ¨æŒ‡é’ˆå‹ç¼©ã€‚|<br>|-XX:SoftRefLRUPolicyMSPerMB|æ¯å…†å †ç©ºé—´ä¸­è½¯å¼•ç”¨è·ä¸Šä¸€æ¬¡è¢«å¼•ç”¨åçš„å­˜æ´»æ—¶é—´ï¼Œé»˜è®¤ä¸€ç§’ã€‚|<br>|-ea|å¯åŠ¨æ–­è¨€ï¼Œåœ¨æ–­è¨€å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯|<br>|-Dsun.io.useCanonCaches|æ–‡ä»¶çš„å…¨è·¯å¾„ä¼šé»˜è®¤ç¼“å­˜ 30 ç§’ï¼Œä¸€èˆ¬å…³é—­è¿™ä¸ªåŠŸèƒ½é¿å…æ— æ³•åŠæ—¶æ‹¿åˆ°æ–‡ä»¶æ›´æ–°åçš„ä¿¡æ¯ã€‚<a href="https://stackoverflow.com/a/7479642/6027827" target="_blank" rel="external">å‚è€ƒ</a>ã€‚|<br>|-Djava.net.preferIPv4Stack|åœ¨è·å– IP åœ°å€æ—¶ï¼Œä¼˜å…ˆè·å– IPV4 åœ°å€ï¼Œè¿™åœ¨å¯ç”¨äº† IPV6 åœ°å€æ—¶æ¨èä½¿ç”¨ï¼Œé¿å…æ‹¿åˆ° IPV6 åœ°å€ï¼ŒåŒæ ·ç±»ä¼¼çš„æœ‰ <code>-Djava.net.preferIPv6Addresses=true</code> é…ç½®|<br>|-XX:-OmitStackTraceInFastThrow|ç¦ç”¨ fast throw ä¼˜åŒ–ï¼Œè™½ç„¶è¯¥ä¼˜åŒ–ä¼šè®©å¼‚å¸¸æŠ›å‡ºå˜å¿«ï¼Œä½†è¯¥ä¼˜åŒ–ä¼šæ¸…ç©ºå¼‚å¸¸çš„ message å’Œ stack trace ä¿¡æ¯ã€‚|</p>
<h3 id="æŸ¥çœ‹å¯åŠ¨æ—¥å¿—"><a href="#æŸ¥çœ‹å¯åŠ¨æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹å¯åŠ¨æ—¥å¿—"></a>æŸ¥çœ‹å¯åŠ¨æ—¥å¿—</h3><p>å‡†å¤‡å·¥ä½œåšå®Œäº†ï¼Œå°±å¯åŠ¨ idea æŸ¥çœ‹æ—¥å¿—ã€‚å¯åŠ¨å‚æ•°é‡Œæ²¡æœ‰æŒ‡å®šæ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œé»˜è®¤ä¼šä½¿ç”¨ <code>ParNew</code>ï¼Œè€å¹´ä»£æ˜¯ <code>CMS</code>ï¼Œæˆªå–æ—¥å¿—ä¸­å‘ç”Ÿäº†çš„ä¸€æ¬¡ CMS GCï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">2018-07-22T15:15:19.187-0800: 62.667: [GC (CMS Initial Mark) [1 CMS-initial-mark: 289195K(322756K)] 293702K(362052K), 0.0050779 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </div><div class="line">2018-07-22T15:15:19.192-0800: 62.673: [CMS-concurrent-mark-start]</div><div class="line">2018-07-22T15:15:19.440-0800: 62.921: [CMS-concurrent-mark: 0.233/0.248 secs] [Times: user=1.37 sys=0.04, real=0.25 secs] </div><div class="line">2018-07-22T15:15:19.440-0800: 62.921: [CMS-concurrent-preclean-start]</div><div class="line">2018-07-22T15:15:19.446-0800: 62.927: [CMS-concurrent-preclean: 0.006/0.006 secs] [Times: user=0.03 sys=0.00, real=0.00 secs] </div><div class="line">2018-07-22T15:15:19.446-0800: 62.927: [CMS-concurrent-abortable-preclean-start]</div><div class="line">2018-07-22T15:15:19.667-0800: 63.148: [GC (Allocation Failure) 2018-07-22T15:15:19.668-0800: 63.148: [ParNew: 39296K-&gt;4352K(39296K), 0.0214260 secs] 328491K-&gt;301375K(362052K), 0.0214942 secs] [Times: user=0.11 sys=0.01, real=0.02 secs] </div><div class="line">2018-07-22T15:15:19.831-0800: 63.312: [CMS-concurrent-abortable-preclean: 0.345/0.384 secs] [Times: user=2.15 sys=0.12, real=0.39 secs] </div><div class="line">2018-07-22T15:15:19.831-0800: 63.312: [GC (CMS Final Remark) [YG occupancy: 22132 K (39296 K)]2018-07-22T15:15:19.831-0800: 63.312: [Rescan (parallel) , 0.0115940 secs]2018-07-22T15:15:19.843-0800: 63.324: [weak refs processing, 0.0031763 secs]2018-07-22T15:15:19.846-0800: 63.327: [class unloading, 0.0451574 secs]2018-07-22T15:15:19.891-0800: 63.372: [scrub symbol table, 0.0384407 secs]2018-07-22T15:15:19.930-0800: 63.411: [scrub string table, 0.0024804 secs][1 CMS-remark: 297023K(322756K)] 319156K(362052K), 0.1190073 secs] [Times: user=0.40 sys=0.01, real=0.12 secs] </div><div class="line">2018-07-22T15:15:19.951-0800: 63.431: [CMS-concurrent-sweep-start]</div><div class="line">2018-07-22T15:15:20.045-0800: 63.526: [GC (Allocation Failure) 2018-07-22T15:15:20.045-0800: 63.526: [ParNew: 39296K-&gt;3219K(39296K), 0.0087767 secs] 314854K-&gt;281310K(362052K), 0.0088410 secs] [Times: user=0.06 sys=0.00, real=0.01 secs] </div><div class="line">2018-07-22T15:15:20.180-0800: 63.661: [GC (Allocation Failure) 2018-07-22T15:15:20.180-0800: 63.661: [ParNew: 38163K-&gt;1500K(39296K), 0.0034745 secs] 277714K-&gt;241051K(362052K), 0.0035767 secs] [Times: user=0.03 sys=0.00, real=0.00 secs] </div><div class="line">2018-07-22T15:15:20.259-0800: 63.740: [CMS-concurrent-sweep: 0.287/0.309 secs] [Times: user=2.03 sys=0.08, real=0.30 secs] </div><div class="line">2018-07-22T15:15:20.260-0800: 63.740: [CMS-concurrent-reset-start]</div><div class="line">2018-07-22T15:15:20.260-0800: 63.741: [CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.01 sys=0.00, real=0.00 secs]</div><div class="line">2018-07-22T15:44:56.811-0800: 1840.379: [GC (Allocation Failure) 2018-07-22T15:44:56.811-0800: 1840.379: [ParNew: 38715K-&gt;3210K(39296K), 0.0076007 secs] 269434K-&gt;235709K(391332K), 0.0076813 secs] [Times: user=0.05 sys=0.00, real=0.00 secs] </div><div class="line">2018-07-22T16:04:58.683-0800: 3042.310: [GC (Allocation Failure) 2018-07-22T16:04:58.685-0800: 3042.312: [ParNew: 38154K-&gt;2133K(39296K), 0.0106108 secs] 270653K-&gt;236587K(391332K), 0.0125843 secs] [Times: user=0.05 sys=0.00, real=0.01 secs] </div><div class="line">2018-07-22T16:15:20.083-0800: 3663.741: [Full GC (System.gc()) 2018-07-22T16:15:20.083-0800: 3663.741: [CMS: 234453K-&gt;78464K(352036K), 0.7207876 secs] 261866K-&gt;78464K(391332K), [Metaspace: 182541K-&gt;182541K(1216512K)], 0.7216869 secs] [Times: user=0.70 sys=0.01, real=0.72 secs] </div><div class="line">2018-07-22T17:05:26.942-0800: 6670.747: [GC (Allocation Failure) 2018-07-22T17:05:26.942-0800: 6670.747: [ParNew: 140864K-&gt;7213K(158464K), 0.0076618 secs] 219328K-&gt;85677K(510500K), 0.0077488 secs] [Times: user=0.04 sys=0.00, real=0.01 secs]</div></pre></td></tr></table></figure></p>
<p>ç»Ÿè®¡äº†ä¸€ä¸‹ï¼Œä¸€å…±å‘ç”Ÿäº† 15 æ¬¡ CMS GCï¼Œä¸€æ¬¡ <code>System.gc()</code> å¼•èµ·çš„ Full GCï¼Œé€šè¿‡å‘½ä»¤ <code>jstat -gcutil &lt;pid&gt;</code> åç»“æœå¦‚ä¸‹ï¼Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">S0      S1    E      O      M      CCS      YGC    YGCT     FGC   FGCT     GCT</div><div class="line">40.98   0.00  13.07  22.29  94.33  91.71    322    2.193    31    1.511    3.704</div></pre></td></tr></table></figure></p>
<p>31 æ¬¡ FGC åˆšå¥½æ˜¯ <code>15*2 + 1</code>ï¼Œå’Œæ—¥å¿—çš„å†…å®¹å±•ç¤ºç¬¦åˆã€‚å…¶ä¸­ 322 æ¬¡ YGC ç”¨æ—¶ 2.193sï¼Œå¹³å‡ 6.8msï¼Œ31 æ¬¡ FGC ç”¨æ—¶ 1.511sï¼Œå¹³å‡ 48msã€‚</p>
<h3 id="åˆ†æåŸå› "><a href="#åˆ†æåŸå› " class="headerlink" title="åˆ†æåŸå› "></a>åˆ†æåŸå› </h3><p>åªæ˜¯å¯åŠ¨æƒ…å†µï¼ŒFGC çš„æ¬¡æ•°è²Œä¼¼æœ‰ç‚¹è¿‡å¤šäº†ï¼Œå°±ä¸»è¦åˆ†æä¸€ä¸‹è¿™å—ã€‚å¯åŠ¨å‚æ•°æ²¡æœ‰æŒ‡å®šæ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ï¼Œä½¿ç”¨ <code>jmap -heap &lt;pid&gt;</code> æŸ¥çœ‹å †åˆ†é…æƒ…å†µï¼Œå…¶ä¸­ï¼ŒEden åŒº 200Mï¼ŒS0 å’Œ S1 éƒ½æ˜¯ 25Mï¼Œå³é»˜è®¤ 8:1ï¼Œè€å¹´ä»£ 500Mï¼Œä¸€å…± 750Mã€‚è¿™ä¸ªåˆ†é…æ˜¯ idea æ ¹æ®å‚æ•°åœ¨å¯åŠ¨æ—¶ç»è¿‡å¤šæ¬¡å †æ‰©å®¹åçš„ç»“æœï¼Œæˆ‘å°†è¿™ä¸ªç»“æœä½œä¸ºåˆå§‹é…ç½®ï¼ŒåŒæ—¶ï¼Œæ—¥å¿—æ˜¾ç¤ºè§¦å‘äº†ä¸€æ¬¡ <code>System.gc()</code> å¯¼è‡´çš„ FGCï¼Œå¼•ç”¨ä¸€å¥è¯ï¼šGC è¿œæ¯”æˆ‘ä»¬æƒ³è±¡çš„èªæ˜ï¼Œæ‰€ä»¥ä»€ä¹ˆæ—¶å€™è§¦å‘ GC æœ€å¥½è¿˜æ˜¯äº¤ç»™å®ƒè‡ªå·±å¤„ç†ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªä¹Ÿå¹²æ‰ï¼Œä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-Xms750m</div><div class="line">-Xmn250m</div><div class="line">-Xmx750m</div><div class="line">-XX:SurvivorRatio=8</div><div class="line">-XX:+DisableExplicitGC</div></pre></td></tr></table></figure>
<p>æ¸…ç©º GC æ—¥å¿—ï¼Œé‡å¯ idea åå†æŸ¥çœ‹ä¸€ä¸‹æƒ…å†µï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">S0   S1       E     O      M      CCS      YGC    YGCT    FGC    FGCT     GCT</div><div class="line">0.00 100.00   1.33  29.95  94.55  91.77      9    0.326     6    0.184    0.510</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œç”±äºæŒ‡å®šäº† <code>-Xms</code> å‚æ•°ï¼Œå¯åŠ¨æ—¶å¯¹ç©ºé—´ä¸éœ€è¦æ‰©å¤§ï¼Œç”±æ–°ç”Ÿä»£åˆå§‹ç©ºé—´è¿‡å°è§¦å‘çš„ YGCï¼Œå’Œè€å¹´ä»£åˆå§‹ç©ºé—´è¿‡å°å¯¼è‡´çš„ FGC éƒ½æ˜æ˜¾å°‘äº†å¾ˆå¤šã€‚å†åˆ†æä¸€ä¸‹ç¬¬ä¸€æ¬¡å‘ç”Ÿ FGC çš„æ—¥å¿—ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">2018-07-22T19:06:55.561-0800: 3.279: [GC (CMS Initial Mark) [1 CMS-initial-mark: 35531K(512000K)] 63204K(742400K), 0.0025610 secs] [Times: user=0.02 sys=0.00, real=0.00 secs] </div><div class="line">2018-07-22T19:06:55.564-0800: 3.282: [CMS-concurrent-mark-start]</div><div class="line">2018-07-22T19:06:55.570-0800: 3.288: [CMS-concurrent-mark: 0.006/0.006 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </div><div class="line">2018-07-22T19:06:55.570-0800: 3.288: [CMS-concurrent-preclean-start]</div><div class="line">2018-07-22T19:06:55.571-0800: 3.289: [CMS-concurrent-preclean: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </div><div class="line">2018-07-22T19:06:55.571-0800: 3.289: [CMS-concurrent-abortable-preclean-start]</div><div class="line">2018-07-22T19:06:56.021-0800: 3.739: [CMS-concurrent-abortable-preclean: 0.228/0.450 secs] [Times: user=1.38 sys=0.10, real=0.45 secs] </div><div class="line">2018-07-22T19:06:56.023-0800: 3.741: [GC (CMS Final Remark) [YG occupancy: 129882 K (230400 K)]2018-07-22T19:06:56.023-0800: 3.741: [Rescan (parallel) , 0.0091620 secs]2018-07-22T19:06:56.032-0800: 3.750: [weak refs processing, 0.0000412 secs]2018-07-22T19:06:56.032-0800: 3.750: [class unloading, 0.0041112 secs]2018-07-22T19:06:56.036-0800: 3.754: [scrub symbol table, 0.0058510 secs]2018-07-22T19:06:56.042-0800: 3.760: [scrub string table, 0.0005136 secs][1 CMS-remark: 35531K(512000K)] 165414K(742400K), 0.0208645 secs] [Times: user=0.09 sys=0.00, real=0.02 secs] </div><div class="line">2018-07-22T19:06:56.044-0800: 3.762: [CMS-concurrent-sweep-start]</div><div class="line">2018-07-22T19:06:56.050-0800: 3.768: [CMS-concurrent-sweep: 0.006/0.006 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </div><div class="line">2018-07-22T19:06:56.050-0800: 3.768: [CMS-concurrent-reset-start]</div><div class="line">2018-07-22T19:06:56.054-0800: 3.772: [CMS-concurrent-reset: 0.004/0.004 secs] [Times: user=0.01 sys=0.00, real=0.00 secs]</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè€å¹´ä»£åœ¨è§¦å‘ FGC åï¼Œåœ¨ CMS çš„ Initial Mark é˜¶æ®µï¼Œè€å¹´ä»£ä½¿ç”¨äº† 35531Kï¼Œè€å¹´ä»£æ€»å¤§å°æ˜¯ 51200Kï¼ŒæŒ‰ç† JDK8 é‡Œé¢ <code>-XX:CMSInitiatingOccupancyFraction=&lt;n&gt;</code> å‚æ•°åœ¨æœªæŒ‡å®šæƒ…å†µï¼Œé»˜è®¤å€¼çº¦ä¸º 92ï¼ˆ<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/cms.html" target="_blank" rel="external">å‚è€ƒ</a>ï¼‰ï¼Œè¿˜è¿œä¸åŠè¿›è¡Œ FGC çš„æ ‡å‡†ï¼ŒåŒ…æ‹¬åé¢ä¸¤æ¬¡ CMS GCï¼Œä¹Ÿæ˜¯è¿™æ ·çš„æƒ…å†µã€‚</p>
<h3 id="è¿›ä¸€æ­¥åˆ†æ"><a href="#è¿›ä¸€æ­¥åˆ†æ" class="headerlink" title="è¿›ä¸€æ­¥åˆ†æ"></a>è¿›ä¸€æ­¥åˆ†æ</h3><p>ä»ä¸Šé¢æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œè§¦å‘ FGC æ—¶ï¼Œå †ç©ºé—´æ˜¯è¶³å¤Ÿçš„ï¼Œå¹¶ä¸æ˜¯å¼•èµ· FGC çš„åŸå› ï¼Œè€ƒè™‘ JVM çš„å†…å­˜æ¨¡å‹ï¼ŒæŠŠæ ˆåŒºã€ç¨‹åºè®¡æ•°å™¨åŒºæ’é™¤å¼€ï¼Œé‚£æœ€æœ‰å¯èƒ½çš„å°±æ˜¯å…ƒç©ºé—´äº†ã€‚å…ƒç©ºé—´æœ€å¤§å€¼ä¸€èˆ¬éƒ½ 1G ä»¥ä¸Šï¼Œä¸€èˆ¬éƒ½ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ï¼Œä½†åœ¨ä¸Šé¢çš„å¯åŠ¨é…ç½®é‡Œï¼Œæ²¡æœ‰è®¾ç½®å…ƒç©ºé—´åˆå§‹å¤§å°ï¼Œå’Œå‰é¢åˆ†æä¸€æ ·ï¼Œå…ƒç©ºé—´å¤§å°åˆå§‹å€¼å¯èƒ½åå°ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­æ‰©å®¹å¯¼è‡´ FGCï¼Œä¹Ÿæ˜¯æŸ¥çœ‹å¯åŠ¨åå·²ä½¿ç”¨å…ƒç©ºé—´å¤§å°ï¼Œå°†æ¯”è¿™ä¸ªå€¼çš„ç•¥å¤§çš„å€¼ä½œä¸ºåˆå§‹å¤§å°ï¼Œäºæ˜¯å¢åŠ ä¸‹é¢å¯åŠ¨å‚æ•°ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-XX:MetaspaceSize=256m</div></pre></td></tr></table></figure>
<p>åˆ æ‰æ—¥å¿—å†æ¥ä¸€æ¬¡ï¼ŒæŸ¥çœ‹ GC æ¬¡æ•°ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">S0   S1      E      O      M      CCS      YGC    YGCT    FGC    FGCT     GCT</div><div class="line">0.00 100.00  67.64  27.19  94.54  92.11      9    0.247     0    0.000    0.247</div></pre></td></tr></table></figure>
<p>ç¬¦åˆé¢„æœŸï¼ŒFGC ä¸€æ¬¡éƒ½æ²¡æœ‰äº†ã€‚è€ƒè™‘è‡ªå·±ç”µè„‘å†…å­˜è¾ƒå……è¶³ï¼ŒæŠŠæœ€å¤§å†…å­˜æ‰©å¤§åˆ° 1024mï¼Œæ–°ç”Ÿä»£ 400mï¼Œé‡å¯å YGC åªæœ‰ 5 æ¬¡ï¼ŒFGC 0 æ¬¡ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-07-17T15:25:55.000Z"><a href="/2018/07/17/find-a-bug-in-scala/">2018-07-17</a></time>
      
      
  
    <h1 class="title"><a href="/2018/07/17/find-a-bug-in-scala/">ç»™ Scala çš„æºç æ‰¾äº†ä¸€ä¸ª bug</a></h1>
  

    </header>
    <div class="entry">
      
        <p>æ—¶é—´å—¨å¾—å›åˆ° 2016 å¹´ï¼Œé‚£ä¼šå„¿å¯¹ Scala å¾ˆæ˜¯å–œæ¬¢ï¼Œå­¦ä¹ äº†ä¸€ç‚¹çš®æ¯›ï¼Œä»Šå¤©æ¥çœ‹å·²ç»å¿˜çš„å·®ä¸å¤šäº†~~~å½“æ—¶æŠŠ List è¿™ä¸ªç±»çš„ API éƒ½ä»”ç»†çœ‹äº†ä¸€éï¼Œå‘ç° <code>indexOf</code> æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="type">List</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>).indexOf(<span class="number">8</span>,<span class="number">-2</span>)</div><div class="line">res393: <span class="type">Int</span> = <span class="number">1</span></div><div class="line"></div><div class="line">scala&gt; <span class="type">List</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>).indexOf(<span class="number">8</span>,<span class="number">-3</span>)</div><div class="line">res391: <span class="type">Int</span> = <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>ä¸ç”¨æˆ‘è§£é‡Šéƒ½çŸ¥é“ <code>indexOf</code> çš„å«ä¹‰ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œç»“æœè¿”å›æ˜¯é”™çš„ï¼Œä¸”å…·æœ‰ä¸ç¡®å®šæ€§ï¼Œäºæ˜¯åˆ° StackOverflow ä¸Š<a href="https://stackoverflow.com/questions/41395111/scala-list-indexof-has-bug" target="_blank" rel="external">æé—®</a>ã€‚</p>
<p>æœ‰ä¸ªå›ç­”è€… <em>Tzach Zohar</em> è¯´è¿™ç¡®å®æ˜¯ä¸€ä¸ª bugï¼Œå¦‚æœæˆ‘å¯¹ä»–çš„å›ç­”æ²¡æœ‰ç†è§£é”™çš„è¯ï¼Œä»–æ‰¿è¯ºè¯´ä¼šåœ¨ 2.12.2 ç‰ˆæœ¬é‡Œä¿®å¤ï¼Œå¹¶ç»™äº†ä¸€ä¸ª <a href="https://github.com/scala/scala/pull/5621/commits" target="_blank" rel="external">commit</a> é“¾æ¥ï¼Œcommit çš„æ—¶é—´åˆšå¥½æ˜¯æˆ‘æé—®çš„ç¬¬äºŒå¤©ï¼Œä¹Ÿæ˜¯ 2016 å¹´çš„æœ€åä¸€å¤©ï¼Œçœ‹äº†ä¸‹ commit æäº¤çš„å†…å®¹ï¼Œæ˜¯åœ¨ç¬¬äºŒä¸ªå‚æ•° <code>from</code> ä¼ å…¥æ—¶ï¼Œå°† <code>0</code> å’Œ <code>from</code> ä¸­æœ€å¤§çš„å€¼ä½œä¸ºèµ·å§‹ä¸‹æ ‡ï¼Œé¿å…äº†è´Ÿæ•°å¼•èµ·çš„é”™è¯¯ã€‚</p>
<p>è‡ªå·±å½“æ—¶è¿˜æ˜¯å¤ªèœï¼Œè¦æ˜¯å½“æ—¶ä»”ç»†ç ”ç©¶ä¸€ä¸‹ï¼Œå†æŠŠä¿®æ”¹åçš„ä»£ç æä¸Šå» mergeï¼Œç„¶åå°±å¯ä»¥å‡è£…è‡ªå·±ä¹Ÿæ˜¯ Scala çš„è´¡çŒ®è€…äº†ğŸ˜†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-07-17T14:56:13.000Z"><a href="/2018/07/17/reinstall-brew/">2018-07-17</a></time>
      
      
  
    <h1 class="title"><a href="/2018/07/17/reinstall-brew/">è§£å†³ä»£ç†å¯¼è‡´æ— æ³•é‡æ–°å®‰è£… brew çš„é—®é¢˜</a></h1>
  

    </header>
    <div class="entry">
      
        <p>ç”±äºä¹‹å‰ç½‘ç»œçš„åŸå› ï¼Œbrew å®‰è£…å’Œæ›´æ–°éƒ½éå¸¸æ…¢ï¼Œäºæ˜¯æ‰‹è´±æŠŠ brew ç»™åˆ æ‰ï¼Œé‡æ–°å®‰è£…å‘ç°ä¸€ç›´æç¤ºè¿™ä¸ªé”™è¯¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Failed to connect to 127.0.0.1 port 59095: Connection refused</div></pre></td></tr></table></figure></p>
<p>å½“æ—¶ Google äº†åŠå¤©ä¹Ÿæ‰¾ä¸åˆ°åŸå› ï¼Œå°±ä¸€ç›´æ”¾åœ¨é‚£é‡Œå‡‰å‡‰ã€‚</p>
<p>ä»Šå¤©æƒ³èµ·æ¥åˆç ”ç©¶äº†ä¸€æŠŠï¼Œçœ‹äº†å„ç§å„æ ·çš„è§£å†³æ–¹æ¡ˆåï¼Œåœ¨ StackOverflow ä¸Šæœåˆ°äº†ä¸€ä¸ª<a href="https://stackoverflow.com/a/17143676/6027827" target="_blank" rel="external">ç­”æ¡ˆ</a>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">For my specific case, I use SOCKS proxy for all traffic. So my installation command is:</div><div class="line"></div><div class="line">ruby -e &quot;$(curl -fsSL --socks5 127.0.0.1:30000 https://raw.github.com/mxcl/homebrew/go)&quot;</div><div class="line"></div><div class="line">where 127.0.0.1:30000 is the SOCKS proxy.</div></pre></td></tr></table></figure></p>
<p>å‡­ç€ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜çš„ç»éªŒï¼Œæˆ‘æ„Ÿè§‰æˆ‘æ‰¾åˆ°äº†é—®é¢˜çš„åŸå› ï¼Œç„¶åä»å®˜ç½‘æ‹·è´å®‰è£…è„šæœ¬ï¼Œå†æ‰¾äº†ä¸€ä¸‹è‡ªå·±çš„ä»£ç†ç«¯å£ï¼Œå°† 30000 æ”¹æˆäº† 1086ï¼Œæ‰§è¡Œå®‰è£…è„šæœ¬ï¼Œå›è½¦ï¼Œæˆäº†ï¼</p>
<p>çœ‹åˆ°å¯ä»¥å®‰è£…ï¼ŒçŒœæµ‹æ˜¯æœ¬åœ°ä½¿ç”¨äº†ä»£ç†ï¼Œå¯¼è‡´è„šæœ¬è¿˜æ˜¯ä½¿ç”¨äº†é»˜è®¤çš„ç«¯å£ï¼Œæ— æ³•èµ°æ­£å¸¸çš„ç½‘ç»œç«¯å£å‘èµ·è¯·æ±‚ï¼Œæ”¹æˆä»£ç†çš„ç«¯å£å°±å¯ä»¥æ­£å¸¸å‘èµ·è®¿é—®äº†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-03-10T02:39:16.000Z"><a href="/2018/03/10/delete-local-git-ssh-config/">2018-03-10</a></time>
      
      
  
    <h1 class="title"><a href="/2018/03/10/delete-local-git-ssh-config/">è§£å†³åˆ é™¤æœ¬åœ°çš„ GIT è´¦å·ä¸ç”Ÿæ•ˆçš„é—®é¢˜</a></h1>
  

    </header>
    <div class="entry">
      
        <p>å› ä¸ºåœ¨æœ¬åœ°é…ç½®äº†ä¸¤ä¸ª GIT è´¦å·ï¼Œä¸€ä¸ªç”¨ä¸åˆ°äº†æ‰“ç®—åˆ æ‰ã€‚  </p>
<p>åœ¨ .ssh ç›®å½•åˆ é™¤æ‰€æœ‰å’Œè¯¥è´¦å·ç›¸å…³çš„å…¬é’¥ç§é’¥å’Œé…ç½®ï¼Œå†å»æäº¤å‘ç°è¿˜æ˜¯ä½¿ç”¨çš„æ˜¯åˆ é™¤çš„è´¦å·ã€‚  </p>
<p>So, Google it.  </p>
<p>åŸæ¥æ˜¯ SSH çš„ç¼“å­˜è¿˜æ²¡æœ‰æ¸…ç†æ‰ï¼Œäºæ˜¯éœ€è¦æ‰§è¡Œåˆ é™¤ SSH ç¼“å­˜çš„å‘½ä»¤ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh-add -D</div></pre></td></tr></table></figure></p>
<p>å†å»æäº¤ä»£ç å°± O98K äº†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-02-19T08:40:21.000Z"><a href="/2017/02/19/scala-enumeration/">2017-02-19</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/19/scala-enumeration/">scala çš„æšä¸¾ç±»å‹</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1ã€å‡†å¤‡çŸ¥è¯†"><a href="#1ã€å‡†å¤‡çŸ¥è¯†" class="headerlink" title="1ã€å‡†å¤‡çŸ¥è¯†"></a>1ã€å‡†å¤‡çŸ¥è¯†</h3><p>åœ¨ Scala é‡Œï¼Œå¯ä»¥äº§ç”Ÿç±»å‹çš„å…³é”®å­—æœ‰ traitã€classã€object ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ typeï¼Œç”¨äºå¯¹ä¸€ä¸ªç±»å‹æ ‡è®°ä¸€ä¸ªåˆ«åäº§ç”Ÿä¸€ä¸ªæ–°ç±»å‹ã€‚ä¾‹å¦‚ä¸º Float å®šä¹‰ä¸€ä¸ªåˆ«åï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="class"><span class="keyword">type</span> <span class="title">Ft</span> </span>= <span class="type">Float</span></div><div class="line">defined <span class="class"><span class="keyword">type</span> <span class="title">alias</span> <span class="title">Ft</span></span></div></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹åƒä½¿ç”¨ Ft å°±åƒä½¿ç”¨ Float ä¸€æ ·äº†ã€‚</p>
<h3 id="2ã€æšä¸¾"><a href="#2ã€æšä¸¾" class="headerlink" title="2ã€æšä¸¾"></a>2ã€æšä¸¾</h3><p>Scala ä¸åƒ Javaï¼Œæ˜¯æ²¡æœ‰æšä¸¾å…³é”®å­—çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç»§æ‰¿ Enumeration è¿™ä¸ªæŠ½è±¡ç±»æ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚çœ‹ä¸ªä¾‹å­ğŸŒ°</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">TrafficLight</span> <span class="keyword">extends</span> <span class="title">Enumeration</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> <span class="type">Green</span> = <span class="type">Value</span></div><div class="line">  <span class="keyword">val</span> <span class="type">Red</span> = <span class="type">Value</span></div><div class="line">  <span class="keyword">val</span> <span class="type">Yellow</span> = <span class="type">Value</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®šä¹‰äº†äº¤é€šä¿¡å·çº¢ç»¿é»„ç¯çš„æšä¸¾ï¼Œé¦–å…ˆç»§æ‰¿ Enumeration æŠ½è±¡ç±»ï¼Œå£°æ˜æšä¸¾å˜é‡æ—¶ï¼Œè¦å°†å…¶èµ‹å€¼ä¸º Value ç±»å‹ï¼ˆä¸‹é¢ä»‹ç» Value ç±»ï¼‰ã€‚è¿™æ ·åœ¨å…¶ä»–åœ°æ–¹ï¼Œå¯ä»¥é€šè¿‡</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> xxx.<span class="type">TrafficLight</span>._</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span></span>(light: <span class="type">Value</span>) : <span class="type">String</span> = &#123;</div><div class="line">  <span class="keyword">val</span> msg = light <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Red</span> =&gt; <span class="string">"Stop"</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Green</span> =&gt; <span class="string">"Go"</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Yellow</span> =&gt; <span class="string">"Wait"</span></div><div class="line">  &#125;</div><div class="line">  msg</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çš„æ–¹å¼ï¼Œå¼•å…¥å’Œä½¿ç”¨è¯¥æšä¸¾çš„æ‰€æœ‰æˆå‘˜ã€‚æ³¨æ„ï¼Œjudge å‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯ Valueï¼Œå’Œå®šä¹‰æšä¸¾æ—¶æˆå‘˜å˜é‡çš„ç±»å‹ä¸€è‡´ã€‚å¦‚æœæœ‰äººä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå‚æ•°ç±»å‹æ˜¯ Value æ˜¾ç„¶ä¸èƒ½ç»™è°ƒç”¨è€…è¶³å¤Ÿçš„ä¿¡æ¯è¿™ä¸ªæ˜¯ TrafficLight æšä¸¾ç±»å‹ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬å®šä¹‰æšä¸¾æ—¶ï¼Œå°±ä¼šç»™ Value ç±»å‹èµ·ä¸ªåˆ«åï¼Œä½¿ç”¨æ—¶ä¸€çœ¼å°±çœ‹çš„å‡ºæ¥è¿™æ˜¯ä»€ä¹ˆæšä¸¾ç±»å‹ã€‚å¦å¤–ï¼ŒValue ç±»æ˜¯ Enumeration çš„å†…éƒ¨ç±»ï¼Œå¦‚æœä¸ç»™ Value ç±»èµ·åˆ«åï¼Œåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†… import äº†å¤šä¸ªæšä¸¾ï¼Œå¯åŠ¨è¿è¡Œæ—¶ä¼šæŠ¥ Value ç±»çš„è¯­ä¹‰æ­§ä¹‰ï¼Œæ‰€ä»¥ä¸€èˆ¬åƒä¸‹é¢è¿™æ ·æ“ä½œï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">TrafficLight</span> <span class="keyword">extends</span> <span class="title">Enumeration</span> </span>&#123;</div><div class="line">  <span class="class"><span class="keyword">type</span> <span class="title">TrafficLight</span> </span>= <span class="type">Value</span></div><div class="line"></div><div class="line">  <span class="keyword">val</span> <span class="type">Green</span> = <span class="type">Value</span></div><div class="line">  <span class="keyword">val</span> <span class="type">Red</span> = <span class="type">Value</span></div><div class="line">  <span class="keyword">val</span> <span class="type">Yellow</span> = <span class="type">Value</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å‰é¢çš„ judge å‡½æ•°çš„å£°æ˜å°±å¯ä»¥å˜æˆè¿™æ ·ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span></span>(light: <span class="type">TrafficLight</span>) : <span class="type">String</span> = &#123;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç½‘ä¸Šå¾ˆå¤šä»‹ç» Scala æšä¸¾ç›´æ¥ç»™å‡ºè¦å®šä¹‰ä¸€ä¸ª type å´æ²¡æœ‰è§£é‡Šä¸ºä»€ä¹ˆï¼Œè¿™é‡Œåº”è¯¥å°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚</p>
<h3 id="3ã€Enumeration-ç±»"><a href="#3ã€Enumeration-ç±»" class="headerlink" title="3ã€Enumeration ç±»"></a>3ã€Enumeration ç±»</h3><p>æŸ¥çœ‹ Enumeration çš„æºç ï¼Œé‡Œé¢ä¸»è¦ç»´æŠ¤äº†ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// vmap ä¿æŒæšä¸¾ id å’Œæšä¸¾å€¼ç›´æ¥çš„æ˜ å°„å…³ç³»</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">val</span> vmap: mutable.<span class="type">Map</span>[<span class="type">Int</span>, <span class="type">Value</span>] = <span class="keyword">new</span> mutable.<span class="type">HashMap</span></div><div class="line"></div><div class="line"><span class="comment">// nmap ä¿æŒæšä¸¾ id å’Œæšä¸¾å¯¹è±¡åç§°ç›´æ¥çš„å…³ç³»</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">val</span> nmap: mutable.<span class="type">Map</span>[<span class="type">Int</span>, <span class="type">String</span>] = <span class="keyword">new</span> mutable.<span class="type">HashMap</span></div><div class="line"></div><div class="line"><span class="comment">// å‡½æ•° values ä»¥ Set å½¢å¼è¿”å›æšä¸¾ç±»å‹æ‰€æœ‰çš„æšä¸¾å¯¹è±¡</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">values</span></span>: <span class="type">ValueSet</span> = &#123;</div><div class="line">  <span class="comment">//...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å››ä¸ªåˆå§‹åŒ–æšä¸¾å¯¹è±¡çš„ Value å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆå§‹åŒ–ä¸Šé¢ Redã€Greenã€Yellow çš„æ˜¯å¦ï¼Œä¸æ˜¯è°ƒç”¨ Value çš„æ„é€ å‡½æ•°ï¼Œ</span></div><div class="line"><span class="comment">// è€Œæ˜¯è°ƒç”¨è¿”å› Value ç±»å‹çš„å‡½æ•°ï¼Œåªä¸è¿‡è·Ÿ Value åŒåç½¢äº†</span></div><div class="line"><span class="comment">// åˆå§‹åŒ–æ—¶ä¸å¡« id å’Œåç§°ï¼Œid é»˜è®¤ä» 0 å¼€å§‹ï¼Œåç§°å’Œæšä¸¾å¯¹è±¡åŒå</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">Value</span></span>: <span class="type">Value</span> = <span class="type">Value</span>(nextId)</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">Value</span></span>(i: <span class="type">Int</span>): <span class="type">Value</span> = <span class="type">Value</span>(i, nextNameOrNull)</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">Value</span></span>(name: <span class="type">String</span>): <span class="type">Value</span> = <span class="type">Value</span>(nextId, name)</div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">Value</span></span>(i: <span class="type">Int</span>, name: <span class="type">String</span>): <span class="type">Value</span> = <span class="keyword">new</span> <span class="type">Val</span>(i, name)</div><div class="line"></div><div class="line"><span class="comment">// ä½¿ç”¨ TrafficLight(0) å’Œ TrafficLight.apply(0) æ•ˆæœä¸€è‡´</span></div><div class="line"><span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">Int</span>): <span class="type">Value</span> = vmap(x)</div><div class="line"></div><div class="line"><span class="comment">// è¿˜æœ‰ä¸€äº›å…¶ä»–è¿­ä»£ç”¨åˆ°çš„æˆå‘˜å˜é‡</span></div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure>
<h3 id="5ã€Value-ç±»"><a href="#5ã€Value-ç±»" class="headerlink" title="5ã€Value ç±»"></a>5ã€Value ç±»</h3><p>Value ç±»å®šä¹‰åœ¨ Enumeration.scala é‡Œï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¢« Val ç±»å®ç°ï¼ŒVal ç±»ä¹Ÿå®šä¹‰åœ¨ Enumeration.scala é‡Œï¼ŒVal æºç çš„ä¸»è¦å†…å®¹æœ‰ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å®šä¹‰äº†ä¸€ä¸ªä¸»æ„é€ å‡½æ•°å’Œä¸‰ä¸ªè¾…æ„é€ å‡½æ•°ï¼Œå¯¹åº”è¢« Enumeration é‡Œå››ä¸ª Value å‡½æ•°è°ƒç”¨</span></div><div class="line"><span class="keyword">protected</span> <span class="class"><span class="keyword">class</span> <span class="title">Val</span>(<span class="params">i: <span class="type">Int</span>, name: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Value</span> <span class="keyword">with</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(i: <span class="type">Int</span>)       = <span class="keyword">this</span>(i, nextNameOrNull)</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>) = <span class="keyword">this</span>(nextId, name)</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>()             = <span class="keyword">this</span>(nextId)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5ã€æšä¸¾çš„ç®€å•ä½¿ç”¨"><a href="#5ã€æšä¸¾çš„ç®€å•ä½¿ç”¨" class="headerlink" title="5ã€æšä¸¾çš„ç®€å•ä½¿ç”¨"></a>5ã€æšä¸¾çš„ç®€å•ä½¿ç”¨</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="type">TrafficLight</span>.values.foreach(println(_))</div><div class="line"><span class="comment">// Green</span></div><div class="line"><span class="comment">// Red</span></div><div class="line"><span class="comment">// Yellow</span></div><div class="line"></div><div class="line">println(<span class="type">TrafficLight</span>.<span class="type">Red</span>)               <span class="comment">// Red</span></div><div class="line">println(<span class="type">TrafficLight</span>.<span class="type">Red</span>.id) 			<span class="comment">// 1</span></div><div class="line">println(<span class="type">TrafficLight</span>.maxId) 			<span class="comment">// 3</span></div><div class="line">println(<span class="type">TrafficLight</span>.withName(<span class="string">"Red"</span>))   <span class="comment">// Red</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-02-05T04:26:40.000Z"><a href="/2017/02/05/scala-partialfunction/">2017-02-05</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/05/scala-partialfunction/">Scalaçš„åå‡½æ•°</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="1ã€åå‡½æ•°çš„å®šä¹‰"><a href="#1ã€åå‡½æ•°çš„å®šä¹‰" class="headerlink" title="1ã€åå‡½æ•°çš„å®šä¹‰"></a>1ã€åå‡½æ•°çš„å®šä¹‰</h3><p>ç®€å•çš„è¯´ï¼šè¾“å…¥å€¼é›†åˆ <em>X</em> ä¸­ï¼Œå¯èƒ½å­˜åœ¨æŸäº›å€¼ <em>Xi</em> åœ¨è¾“å‡ºé›†åˆ <em>Y</em> ä¸­æ‰¾ä¸åˆ°æ˜ å°„çš„å€¼ã€‚  </p>
<p>æ‰€ä»¥åœ¨ Scala ä¸­ï¼Œåå‡½æ•°åªæ¥æ”¶æŸä¸ªè¾“å…¥å‚æ•°ç±»å‹çš„æŸäº›ç‰¹å®šå€¼ã€‚ä¾‹å¦‚ <code>(Int) =&gt; String</code> åªæ¥æ”¶ <code>Int</code> ç±»å‹çš„æŸäº›å€¼ä½œä¸ºåˆæ³•è¾“å…¥ã€‚è¿™ä¹Ÿæ˜¯åå‡½æ•°å’Œ scala.Function1 çš„ä¸»è¦åŒºåˆ«ã€‚  </p>
<p>è¿™ç‚¹å°±å’Œ <code>case</code> è¯­å¥å…³è”ä¸Šæ¥æœ‰æœ¨æœ‰ï¼Œ<code>case</code> è¯­å¥ä¸å°±æ˜¯åªå¤„ç†æŸä¸ªç±»å‹ä¸‹çš„æŸäº›å€¼ä¹ˆï¼Œcase è¯­å¥å…¶å®å°±æ˜¯ä¸€ä¸ªåŒ¿åçš„åå‡½æ•°ã€‚</p>
<p>è¯¦ç»†å¯ä»¥æŸ¥çœ‹ wiki ç™¾ç§‘å¯¹<a href="https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B0#.E5.AE.9A.E7.BE.A9" target="_blank" rel="external">å‡½æ•°</a>çš„å®šä¹‰ï¼Œé‡Œé¢æœ‰å¯¹åå‡½æ•°çš„ä»‹ç»ã€‚</p>
<h3 id="2ã€Scala-çš„åå‡½æ•°"><a href="#2ã€Scala-çš„åå‡½æ•°" class="headerlink" title="2ã€Scala çš„åå‡½æ•°"></a>2ã€Scala çš„åå‡½æ•°</h3><p>Scala é‡Œæœ‰ä¸“é—¨å®šä¹‰çš„åå‡½æ•°çš„ç±»å‹ PartialFunctionï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> pf: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">String</span>] = &#123;</div><div class="line">    <span class="keyword">case</span> i <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> =&gt; <span class="string">"even"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å’Œ <code>orElse</code> ç»„åˆä½¿ç”¨ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> tf: (<span class="type">Int</span> =&gt; <span class="type">String</span>) = pf orElse &#123; <span class="keyword">case</span> _ =&gt; <span class="string">"odd"</span>&#125;</div><div class="line"></div><div class="line">tf(<span class="number">1</span>) == <span class="string">"odd"</span></div><div class="line">tf(<span class="number">2</span>) == <span class="string">"even"</span></div></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>isDefinedAt</code> æ¥æ£€æŸ¥è¾“å…¥å€¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pf.isDefinedAt(<span class="number">1</span>) == <span class="literal">false</span></div><div class="line">pf.isDefinedAt(<span class="number">2</span>) == <span class="literal">true</span></div></pre></td></tr></table></figure>
<h3 id="3ã€åº”ç”¨"><a href="#3ã€åº”ç”¨" class="headerlink" title="3ã€åº”ç”¨"></a>3ã€åº”ç”¨</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> sample = <span class="number">1</span> to <span class="number">10</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> isEven: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">String</span>] = &#123;</div><div class="line">    <span class="keyword">case</span> x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> =&gt; x + <span class="string">" is even"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// method collect use isDefinedAt to select members</span></div><div class="line"><span class="keyword">val</span> evens = sample collect isEven</div><div class="line"></div><div class="line"><span class="keyword">val</span> isOdd: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">String</span>] = &#123;</div><div class="line">    <span class="keyword">case</span> x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span> =&gt; x + <span class="string">" is Odd"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ä½¿ç”¨ map æ–¹æ³•è¦ä¿è¯è¾“å…¥åŸŸçš„å…¨è¦†ç›–ï¼Œå¦åˆ™æŠ¥é”™ï¼Œcollect æ–¹æ³•å¯ä»¥ä¸ç”¨å…¨è¦†ç›–</span></div><div class="line"><span class="keyword">val</span> result1 = sample map (isEven orElse isOdd)</div><div class="line"><span class="keyword">val</span> result2 = sample collect (isEven orElse isOdd)</div></pre></td></tr></table></figure>
<p>å¦‚æœæŠŠåå‡½æ•°çš„è¿”å›å€¼å®šä¹‰ä¸º Booleanï¼Œè¾“å…¥åŸŸåœ¨ isDefinedAt åˆ¤æ–­ä¸‹å…¨ä¸º trueï¼Œæ­¤æ—¶åå‡½æ•°å°±é€€åŒ–ä¸ºæ¥å’Œè°“è¯å‡½æ•°åŠŸèƒ½ä¸€æ ·ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> p: <span class="type">PartialFunction</span>[<span class="type">Int</span>, <span class="type">Boolean</span>] = &#123;</div><div class="line">	<span class="keyword">case</span> x <span class="keyword">if</span> x &gt; <span class="number">0</span> =&gt; <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ­¤æ—¶ filter æ²¡æœ‰ä»»ä½•è¿‡æ»¤åŠŸèƒ½ï¼Œcollect ç›¸å½“äº map å‡½æ•°ï¼Œå› ä¸º isDefinedAt å…¨éƒ¨éƒ½æ˜¯è¿”å› trueï¼Œ</span></div><div class="line">sample filter p</div><div class="line">sample collect p</div><div class="line"></div><div class="line"><span class="comment">// è¿™æ ·åšå¥½åƒæ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯å½“ case è¯­å¥å¯¹åº”çš„ç±»å‹æ˜¯ case ç±»æ—¶ï¼Œè¿‡æ»¤åŠ ä¸Š case å°±éå¸¸æ–¹ä¾¿äº†</span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span></span>)</span></div><div class="line"><span class="keyword">val</span> persons = <span class="type">List</span>(<span class="type">Person</span>(<span class="string">"steve"</span>, <span class="number">15</span>), <span class="type">Person</span>(<span class="string">"Leo"</span>, <span class="number">19</span>))</div><div class="line">persons filter &#123;</div><div class="line">	<span class="keyword">case</span> <span class="type">Person</span>(name, age) =&gt; age &gt; <span class="number">18</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Scala çš„é›†åˆç±»å¾ˆå¤šéƒ½æœ‰æ–¹æ³• <code>isDefinedAt(idx: Int)</code>ï¼Œç”¨æ¥åˆ¤æ–­åœ¨ç´¢å¼• idx ä¸‹æ˜¯å¦å®šä¹‰äº†å€¼ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œé›†åˆå¯¹è±¡ Seq[A] ä¼šè¢«è½¬æ¢ä¸ºåå‡½æ•° PartialFunction[Int, A]ï¼ŒInt å¯¹åº”çš„å°±æ˜¯é›†åˆå…ƒç´ çš„ç´¢å¼•ï¼Œçœ‹ä¸ªä¾‹å­ğŸŒ°å§~~~</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> colors = <span class="type">List</span>(<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>)</div><div class="line">colors.isDefinedAt(<span class="number">1</span>) == <span class="literal">true</span></div><div class="line">colors.isDefinedAt(<span class="number">9</span>) == <span class="literal">false</span></div><div class="line"></div><div class="line">colors(<span class="number">9</span>) <span class="comment">// error</span></div><div class="line"></div><div class="line"><span class="type">Seq</span>(<span class="number">1</span>,<span class="number">9</span>) collect colors</div><div class="line"><span class="comment">// List(blue)  é¿å…äº†è¶Šç•Œä¸‹æ ‡çš„å¼‚å¸¸</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T12:08:21.000Z"><a href="/2016/09/11/a-refactor-of-threads-calling/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/a-refactor-of-threads-calling/">è®°ä¸€æ¬¡å¤šçº¿ç¨‹è°ƒç”¨çš„é‡æ„ä¼˜åŒ–</a></h1>
  

    </header>
    <div class="entry">
      
        <blockquote>
<p>è¿™æ¬¡é‡æ„å¯¹æ•ˆç‡ä¸Šæœ‰å°å¹…æå‡ï¼Œä½†å¤§å¤§çš„ç®€åŒ–äº†è°ƒç”¨æ–¹å¼ï¼Œå¯¹åº”çš„ä»£ç ä¹Ÿå‡å°‘äº†å¾ˆå¤šã€‚</p>
</blockquote>
<p>&emsp;&emsp;äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œé¡¹ç›®é‡Œæ•°æ®åº“åˆ†äº†åº“ï¼Œéœ€è¦åˆ†åº“è°ƒç”¨ï¼Œäºæ˜¯è€å‘˜å·¥å†™äº†ä¸€ä¸ªå·¥å…·ï¼Œå½“ä¸€ä¸ªè¯·æ±‚æ¥äº†åï¼ŒæŠŠè¯·æ±‚å°è£…æˆä¸€ä¸ªTaskï¼ŒæŠŠTaskä¸¢ç»™çº¿ç¨‹æ± å–æ‰§è¡Œï¼Œç„¶åå¾ªç¯ç­‰å¾…æ‰§è¡Œç»“æœã€‚ä¸‹é¢å¤§æ¦‚è¯´ä¸‹å„ä¸ªç±»çš„ä»£ç ï¼Œä¸ä¸€å®šèƒ½ç¼–è¯‘è¿‡ï¼Œå‡­è®°å¿†å†™ã€‚</p>
<p>1ã€Taskç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Object&gt; results;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Task</span><span class="params">(String dbKey, Object object, String methodName, Object ... args)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        TaskIdentity.setIdentity(dbKey);</div><div class="line">        <span class="comment">// .......</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// other methods</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;ä¸Šé¢resultsç”¨æ¥ä¿å­˜æ‰§è¡Œå®Œåçš„ç»“æœï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªç»“æœï¼Œä¹Ÿè¿”å›åŒ…å«ä¸€ä¸ªå…ƒç´ çš„Listã€‚æ„é€ å‡½æ•°æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ•°æ®åº“åˆ†åº“çš„è·¯ç”±ï¼Œç”±è°ƒç”¨è€…çš„å‚æ•°å†³å®šã€‚ç¬¬äºŒä¸ªæ˜¯è¦è°ƒç”¨çš„æ–¹æ³•æ‰€åœ¨çš„ç±»çš„å®ä¾‹ï¼ˆå¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼‰ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è°ƒç”¨çš„æ–¹æ³•çš„å­—ç¬¦ä¸²å½¢å¼ï¼ˆå¯¹ï¼Œæ˜¯è¿™æ ·çš„ï¼‰ï¼Œæœ€åä¸€ä¸ªæ˜¯è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼Œæœ‰äº†ä»¥ä¸Šä¿¡æ¯ï¼Œé€šè¿‡åå°„æ¥ç¡®å®šè¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚<br>&emsp;&emsp;è®¾è®¡è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯å¯ä»¥ä¿æŒä»»ä½•ç±»å‹çš„ç»“æœï¼Œç”¨äº†List<object>ï¼Œä¸ºäº†å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„æ–¹æ³•ï¼Œæ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªå‚æ•°éƒ½è®¾è®¡çš„æœ‰ç‚¹è¿åç›´è§‰ï¼Œæœ€åä¹Ÿæ˜¯ä¸ºäº†æ¥å—ä»»æ„å‚æ•°ï¼Œä½¿ç”¨Objectçš„å¯å˜å‚æ•°ã€‚<br>&emsp;&emsp;æœ€åï¼ŒTaské‡Œè¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†å‚æ•°çš„åŒ¹é…é—®é¢˜ã€‚å› ä¸ºå‚æ•°åˆ—è¡¨å¯èƒ½æ˜¯åŸç”Ÿç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åŒ…è£…ç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯äºŒè€…çš„æ··åˆï¼Œè¿˜ä¼šåŠ ä¸Šå…¶ä»–å¼•ç”¨ç±»å‹ä»€ä¹ˆçš„ã€‚æˆ‘æ›¾ç»å°è¯•é‡å†™é‡Œé¢é€šè¿‡æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç¡®å®šæ˜¯å“ªä¸ªæ–¹æ³•çš„å‡½æ•°ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ŒåŸå› å°±æ˜¯ä¼ åŸç”Ÿç±»å‹å’ŒåŒ…è£…ç±»å‹æ—¶ï¼Œé€šè¿‡åå°„æ˜¯ä¸èƒ½ç¡®å®šåˆ°åº•æ˜¯å“ªä¸€ä¸ªã€‚æ‰€ä»¥é‡Œé¢é€šè¿‡åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å‚æ•°ç»„åˆï¼Œæ¥åå°„å¯¹åº”çš„æ–¹æ³•ï¼Œç›´åˆ°åå°„æˆåŠŸä¸ºæ­¢ï¼ˆæˆ‘è§‰å¾—ä¹Ÿåªèƒ½è¿™æ ·çš„äº†ï¼‰ã€‚<br>&emsp;&emsp;æ€»ä¹‹ï¼ŒåŠŸèƒ½è¿˜æ˜¯å®ç°äº†ï¼Œåå°„ä¹Ÿåå°„æˆåŠŸäº†ï¼Œåªæ˜¯å®ç°çš„æœ‰äº›ä¸‘é™‹ï¼Œä¸ä¼˜ç¾ï¼Œæ•´ä¸ªç±»æœ‰300è¡Œä»¥ä¸Šçš„ä»£ç ã€‚</object></p>
<p>2ã€TaskIndentityç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskIdentity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; identity = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setIdentity</span><span class="params">(String dbKey)</span> </span>&#123;</div><div class="line">        identity.set(dbKey);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getIdentity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> identity.get();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;è¿™ä¸ªç±»æ²¡å•¥è¯´çš„ï¼Œå°±æ˜¯å¯¹çº¿ç¨‹ä¿å­˜å½“å‰æ‰§è¡Œå¯¹åº”çš„æ•°æ®åº“æ ‡è¯†ï¼Œåœ¨çº¿ç¨‹åˆšå¼€å§‹æ‰§è¡Œå‰è°ƒç”¨setIndentityï¼ŒçœŸæ­£è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ•°æ®åº“è¿æ¥ï¼ˆSpringæ¥å®Œæˆï¼‰ã€‚   </p>
<p>3ã€TaskExecutorç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskExecutor</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">submitSelectTask</span><span class="params">(List&lt;Task&gt; tasks)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">submitUpdateTask</span><span class="params">(List&lt;Task&gt; tasks)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå·¥å…·ç±»ã€‚é‡Œé¢æœ‰ä¸€ä¸ªçº¿ç¨‹æ± å˜é‡ï¼Œç”¨æ¥æ‰§è¡Œä»»åŠ¡ã€‚å‚æ•°éƒ½æ˜¯ä»»åŠ¡çš„åˆ—è¡¨ï¼ˆæƒ³è¦†ç›–ä¸€ä¸ªä»»åŠ¡æˆ–å¤šä¸ªä»»åŠ¡çš„æƒ…å†µï¼‰ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŸ¥è¯¢ç±»ä»»åŠ¡ï¼Œä¾æ¬¡æäº¤äº†æ‰€æœ‰ä»»åŠ¡åï¼Œåœ¨åé¢å¾ªç¯ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå®Œæˆåå–å‡ºæ‰€æœ‰ç»“æœï¼Œå†å¼ºåˆ¶å°†Objectç±»å‹ç»“æœè½¬æ¢ä¸ºè¿”å›çš„Tç±»å‹ã€‚å…¶å®åœ¨å¾ªç¯ç­‰å¾…ç»“æœå‰ï¼Œä»£ç é‡Œä¼šç¡çœ 10æ¯«ç§’ï¼ˆåŸä½œè€…è¿™æ ·å†™çš„ï¼‰ã€‚<br>&emsp;&emsp;ç¬¬äºŒä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œæ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥ä»»åŠ¡ï¼Œè¿”å›å€¼æŒ‰ç†è¯´æ˜¯æ•´å½¢ï¼Œä¸è¿‡è®¾è®¡çš„æ—¶å€™æ²¡æœ‰æŠŠè¿™äº›å€¼è¿”å›ï¼Œè¿”å›çš„æ„ä¹‰ä¹Ÿä¸å¤§ï¼Œæ¯•ç«Ÿæ‰§è¡Œäº†å¤šä¸ªä»»åŠ¡ã€‚æ•´ä¸ªç±»å¤§æ¦‚æœ‰100~200è¡Œä»£ç ã€‚   </p>
<p>4ã€å¥½äº†ï¼Œä»‹ç»å®Œä¸Šé¢çš„ç±»ï¼Œç»ˆäºå¯ä»¥è¯´æ€ä¹ˆè°ƒç”¨äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Task task = <span class="keyword">new</span> Task(<span class="string">"dbkey"</span>, SomeObject.instance(), <span class="string">"someMethod"</span>, <span class="string">"hello"</span>, <span class="string">"world"</span>);</div><div class="line">List&lt;Task&gt; tasks = Arrays.asList(task);</div><div class="line">List&lt;String&gt; ret = TaskExecutor.submitSelectTask(tasks);</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¦‚ä¸Šã€‚åœ¨new Taskå¯¹è±¡çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Objectç±»å‹ï¼Œæ‰€ä»¥ä¼ ä»»ä½•å¼•ç”¨ç±»å‹éƒ½ä¸ä¼šæŠ¥é”™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¼ ä»»æ„çš„å­—ç¬¦ä¸²éƒ½å¯ä»¥ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯å¯å˜é•¿åº¦ï¼Œä¼ ä»»æ„ä¸ªå‚æ•°ä¹Ÿä¸ä¼šç¼–è¯‘å™¨æŠ¥é”™ã€‚æˆ‘åœ¨ä½¿ç”¨è¿™å¥—ä»£ç æä¾›çš„æ¥å£ï¼Œå¶å°”å°±ä¼šå¿˜äº†æ”¹å‚æ•°ï¼Œå¯¼è‡´åˆ°è¿è¡Œæ—¶æ‰æŠ¥é”™ï¼Œæå¾—å¾ˆå¤´ç—›ã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯æ²¡æœ‰åˆ©ç”¨Javaçš„å¼ºç±»å‹ç‰¹æ€§ï¼Œåœ¨ç¼–è¯‘æœŸæ¥é¢„é˜²é”™è¯¯çš„å‚æ•°ä¼ å…¥ã€‚   </p>
<p>5ã€é‡æ„åçš„ä»£ç <br>&emsp;&emsp;ä¸Šé¢çš„è¿™å¥—ä»£ç å…¶å®æœ‰ä¸ªè¯¯åŒºï¼Œå°±æ˜¯æƒ³æŠŠæ‰€æœ‰çš„è°ƒç”¨å°è£…èµ·æ¥ï¼Œç»Ÿä¸€å…¥å£å’Œç»Ÿä¸€å‡ºå£ã€‚å…¶å®æ ¹æœ¬ä¸ç”¨å°è£…ï¼Œåœ¨ä¸åŒçš„å¯¹å¤–æ¥å£é‡Œï¼Œèµ·ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å¯¹åº”çš„æ¥å£å°±è¡Œäº†ã€‚<br>&emsp;&emsp;é¦–å…ˆå¯¹æ‰§è¡Œä»»åŠ¡çš„å·¥å…·ç±»é‡æ„ï¼Œä¸å†å°è£…Taskï¼Œç›´æ¥æ¥æ”¶ä¸€ä¸ªCallableå­ç±»æˆ–Runnableå­ç±»ï¼Œæ•´ä¸ªå·¥å…·ç±»ä¹Ÿä¸ç”¨å»å¼ºè½¬ç»“æœçš„ç±»å‹ï¼Œä¹Ÿä¸ç”¨å¾ªç¯ç­‰å¾…ç»“æœï¼Œè°ƒç”¨æ˜¯é˜»å¡ï¼ŒTaskExceptionæ˜¯è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskExecutor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService service = Executors.newFixedThreadPool(<span class="number">8</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V&gt; <span class="function">V <span class="title">submitTask</span><span class="params">(Callable&lt;V&gt; callable)</span> <span class="keyword">throws</span> TaskException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> service.submit(callable).get(<span class="number">10</span>, TimeUnit.SECONDS);</div><div class="line">        &#125; <span class="keyword">catch</span> (RejectedExecutionException | InterruptedException | ExecutionException | TimeoutException e) &#123;</div><div class="line">            <span class="comment">// log</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TaskException(e.getMessage());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">submitTask</span><span class="params">(Runnable runnable)</span> <span class="keyword">throws</span> TaskException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            service.submit(runnable);</div><div class="line">        &#125; <span class="keyword">catch</span> (RejectedExecutionException e) &#123;</div><div class="line">            <span class="comment">// log</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TaskException(e.getMessage());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;æœ€åçœ‹ä¸‹æ€ä¹ˆè°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; ret = TaskExecutor.submitTask(<span class="keyword">new</span> Callable&lt;List&lt;String&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        TaskIdentity.setIdentity(<span class="string">"dbkey"</span>);</div><div class="line">        <span class="keyword">return</span> SomeObject.someMethod(<span class="string">"param1"</span>, <span class="string">"param2"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;åœ¨è°ƒç”¨æ—¶å€™ï¼Œä¸å†new Taskå¯¹è±¡ï¼Œåœ¨callæ–¹æ³•é‡Œè®¾ç½®æ•°æ®åº“è·¯ç”±ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸å†æœ‰ç¡¬ç¼–ç ï¼Œä»»ä½•ç±»å‹çš„ä¸åŒ¹é…éƒ½ä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼Œä¸å†æœ‰å¯¹ç»“æœçš„å¼ºåˆ¶è½¬æ¢ï¼Œå’Œå¯¹ç»“æœçš„å¾ªç¯ç­‰å¾…ï¼Œè°ƒç”¨æ–¹å¼ä¹Ÿç®€å•æ˜äº†äº†è®¸å¤šï¼ŒTaskç±»ä¹Ÿå¯ä»¥å»æ‰äº†ï¼Œæ•´ä¸ªåŠŸèƒ½ä»£ç é‡ä¹Ÿå°±20æ¥è¡Œã€‚<br>&emsp;&emsp;è¿˜æœ‰ä¸€ä¸ªä¸åŒçš„æ˜¯é‡æ„ä»¥åï¼Œåªæ¥æ”¶ä¸€ä¸ªä»»åŠ¡ã€‚å…¶å®åœ¨æˆ‘é‡æ„ä»¥å‰ï¼Œæˆ‘æ²¡æœ‰ä»»ä½•ä¸€æ¬¡æ˜¯ä¼ äº†å¤šä¸ªä»»åŠ¡ç»™è€æ¥å£ï¼Œæ¯æ¬¡éƒ½è¦å»æ„é€ ä¸€ä¸ªList<task>å»é…åˆä»¥å‰çš„æ¥å£ï¼Œä¸ºæ­¤æˆ‘è¿˜ä¸“é—¨å†™äº†ä¸€ä¸ªä¸­é—´å·¥å…·ç±»åªæ¥æ”¶ä¸€ä¸ªTaskï¼Œæ‰€ä»¥ä¼ å¤šä¸ªTaskæƒ…å†µå¾ˆå°‘å¾ˆå°‘ï¼Œä¸è¿‡é‡æ„åè¿™äº›ç±»éƒ½å¯ä»¥å»æ‰äº†ã€‚<br>&emsp;&emsp;æ•´ä¸ªè¿‡ç¨‹å›è¿‡å¤´æ¥çœ‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯åŸå…ˆçš„æ¥å£ä½œè€…ä¼°è®¡ä¸çŸ¥é“æœ‰Callableè¿™ä¸ªä¸œè¥¿ï¼Œæˆ–è€…æ˜¯ä¸ºäº†å·¥å…·åŒ–è€Œå·¥å…·åŒ–ã€‚é‡æ„åä¹Ÿæ²¡ä»€ä¹ˆé«˜å¤§ä¸Šçš„ä¸œè¥¿ï¼Œä¸è¿‡æ•ˆæœæ˜¯å¥½çš„ï¼ŒåŠŸèƒ½ä¸å˜ï¼Œå‡å°‘äº†ä»£ç é‡å’Œå¤æ‚åº¦ã€‚</task></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T06:01:09.000Z"><a href="/2016/09/11/scala-pattern-match/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/scala-pattern-match/">Scalaçš„æ¨¡å¼åŒ¹é…</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“æ¨¡å¼åŒ¹é…çš„ç”¨æ³•ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<p>Scalaçš„æ¨¡å¼åŒ¹é…æœ‰ç‚¹åƒä»¥å‰æ¥è§¦çš„switch-caseè¯­å¥ï¼Œä½†åŠŸèƒ½æ¯”switch-caseä¸°å¯Œå¾ˆå¤šï¼Œæ˜¯ä¸€ç§å¼ºå¤§çš„â€œåè®®â€ã€‚</p>
<h3 id="1ã€ç®€å•åŒ¹é…"><a href="#1ã€ç®€å•åŒ¹é…" class="headerlink" title="1ã€ç®€å•åŒ¹é…"></a>1ã€ç®€å•åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> bools = <span class="type">Seq</span>(<span class="literal">true</span>, <span class="literal">false</span>)</div><div class="line"><span class="keyword">for</span> (bool &lt;- bools) &#123;</div><div class="line">  bool <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="literal">true</span> =&gt; println(<span class="string">"hello"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="literal">false</span> =&gt; println(<span class="string">"world"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// hello</span></div><div class="line"><span class="comment">// world</span></div></pre></td></tr></table></figure>
<p>caseåé¢æ²¡æœ‰è·Ÿbreakè¯­å¥ã€‚å¦‚æœå°†ä¸Šé¢ä»»æ„ä¸€ä¸ªcaseè¯­å¥æ³¨é‡Šï¼Œç¼–è¯‘å™¨ä¼šæŠ›å‡ºMatchErrorï¼Œå› ä¸ºcaseè¯­å¥æ²¡æœ‰åŒ…å«æ‰€æœ‰å¯èƒ½å‡ºç°çš„æƒ…å†µã€‚</p>
<h3 id="2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹"><a href="#2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹" class="headerlink" title="2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹"></a>2ã€matchä¸­çš„å€¼ã€å˜é‡å’Œç±»å‹</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  x &lt;- <span class="type">Seq</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3.7</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="symbol">'four</span>)</div><div class="line">&#125; &#123;</div><div class="line">  <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>          =&gt; <span class="string">"int 1"</span></div><div class="line">    <span class="keyword">case</span> i: <span class="type">Int</span>     =&gt; <span class="string">"other int :"</span> + i                <span class="comment">// é™¤1ä»¥å¤–çš„æ‰€æœ‰æ•´æ•°</span></div><div class="line">    <span class="keyword">case</span> d: <span class="type">Double</span>  =&gt; <span class="string">"a double:"</span> + d</div><div class="line">    <span class="keyword">case</span> <span class="string">"one"</span>      =&gt; <span class="string">"String one"</span></div><div class="line">    <span class="keyword">case</span> s: <span class="type">String</span>  =&gt; <span class="string">"other string:"</span> + s</div><div class="line">    <span class="keyword">case</span> unexpected =&gt; <span class="string">"unexpected value:"</span> + unexpected <span class="comment">// åŒ¹é…å…¶ä»–çš„æƒ…å†µï¼Œxçš„å€¼èµ‹å€¼ç»™unexpectedï¼Œç±»å‹ä¸ºAny</span></div><div class="line">  &#125;</div><div class="line">  println(str)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸Šé¢åºåˆ—æœ€åä¸€ä¸ªæ˜¯Scalaçš„Symbolå¯¹è±¡ã€‚strçš„ç±»å‹æ˜¯æ‰€æœ‰caseè¯­å¥è¿”å›å€¼ç±»å‹çš„æœ€è¿‘å…¬å…±çˆ¶ç±»ã€‚å¦å¤–ï¼Œ<strong>åŒ¹é…å…·ä½“çš„caseè¯­å¥è¦å‡ºç°åœ¨åŒ¹é…å®½æ³›çš„caseè¯­å¥å‰</strong>ï¼Œå¦åˆ™å…·ä½“çš„caseè¯­å¥æ°¸è¿œæ²¡æœ‰æœºä¼šåŒ¹é…ä¸Šï¼ˆç¼–è¯‘å™¨ä¹Ÿå¯ä»¥è¯†åˆ«è¿™ç§é”™è¯¯ï¼‰ã€‚åœ¨åŒ¹é…Doubleç±»å‹æ—¶ï¼Œä¸ºäº†é¿å…èˆå…¥è¯¯å·®å¯¼è‡´çš„æ— æ³•åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  x &lt;- <span class="type">Seq</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3.7</span>, <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="symbol">'four</span>)</div><div class="line">&#125; &#123;</div><div class="line">  <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">1</span>          =&gt; <span class="string">"int 1"</span></div><div class="line">    <span class="keyword">case</span> _: <span class="type">Int</span>     =&gt; <span class="string">"other int :"</span> + x                </div><div class="line">    <span class="keyword">case</span> _: <span class="type">Double</span>  =&gt; <span class="string">"a double:"</span> + x</div><div class="line">    <span class="keyword">case</span> <span class="string">"one"</span>      =&gt; <span class="string">"String one"</span></div><div class="line">    <span class="keyword">case</span> _: <span class="type">String</span>  =&gt; <span class="string">"other string:"</span> + x</div><div class="line">    <span class="keyword">case</span> _          =&gt; <span class="string">"unexpected value:"</span> + x</div><div class="line">  &#125;</div><div class="line">  println(str)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä½¿ç”¨å ä½ç¬¦<code>_</code>æ›¿ä»£äº†å˜é‡ï¼Œä½¿ç”¨xæ¥è·å–åŒ¹é…çš„å€¼ã€‚ç¼–å†™caseè¯­å¥æ—¶æœ‰ä¸ªé™·é˜±ï¼Œå°±æ˜¯ç¼–è¯‘å™¨ä¼šå‡å®šå¤§å†™å­—æ¯å¼€å¤´çš„æ˜¯ç±»å‹åï¼Œå°å†™å­—æ¯å¼€å¤´çš„æ˜¯å˜é‡åã€‚å¦‚æœè¦å¼•ç”¨åœ¨å‰é¢å®šä¹‰çš„å˜é‡æ—¶ï¼Œç”¨åå¼•å·å°†å…¶æ‹¬èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkY</span></span>(y:<span class="type">Int</span>) = &#123;</div><div class="line">  <span class="keyword">for</span> &#123;</div><div class="line">    x &lt;- <span class="type">Seq</span>(<span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>)</div><div class="line">  &#125; &#123;</div><div class="line">    <span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">      <span class="keyword">case</span> `y` =&gt; <span class="string">"found y!"</span></div><div class="line">      <span class="keyword">case</span> i:<span class="type">Int</span> =&gt; <span class="string">"found other"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ‰æ—¶ä¸åŒçš„åŒ¹é…è¯­å¥éœ€è¦å¤„ç†ç›¸åŒçš„é€»è¾‘ä»£ç ï¼Œä¸ºäº†é¿å…å†—ä½™ï¼Œå¯ä»¥ä½¿ç”¨â€œ|â€ç¬¦å·ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> str = x <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> _:<span class="type">Int</span> | <span class="keyword">case</span> _:<span class="type">Double</span> =&gt; <span class="string">"found number:"</span> + x</div><div class="line">  <span class="keyword">case</span> _:<span class="type">Any</span> =&gt; <span class="string">"found other"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3ã€åºåˆ—çš„åŒ¹é…"><a href="#3ã€åºåˆ—çš„åŒ¹é…" class="headerlink" title="3ã€åºåˆ—çš„åŒ¹é…"></a>3ã€åºåˆ—çš„åŒ¹é…</h3><p>å…ˆçœ‹ä¸€ä¸ªScalaçš„è¯­æ³•ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> x +: y = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// x: Int = 1</span></div><div class="line"><span class="comment">// y: List[Int] = List(2, 3)</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>+:</code>æ˜¯åºåˆ—çš„æ„é€ æ“ä½œç¬¦ï¼ˆå…¶å®å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼‰ï¼ŒScalaé‡Œä»¥<code>:</code>ç»“å°¾çš„æ–¹æ³•æ˜¯å‘å³ç»“åˆçš„ï¼Œæ‰€æœ‰xåªæœ‰ä¸€ä¸ªå¤´éƒ¨ï¼ŒyåŒ…å«æ•´ä¸ªå°¾éƒ¨ã€‚ç±»ä¼¼çš„è¿˜æœ‰<code>++:</code>ã€<code>/:</code>ç­‰ã€‚å¯¹åºåˆ—å°±å¯ä»¥è¿™æ ·åŒ¹é…ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">seqToString</span></span>[<span class="type">T</span>](seq: <span class="type">Seq</span>[<span class="type">T</span>]): <span class="type">String</span> = seq <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> head +: tail =&gt; <span class="string">s"<span class="subst">$head</span> +: "</span> + seqToString(tail)</div><div class="line">  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; <span class="string">"Nil"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">seqToString(<span class="type">Seq</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>))</div><div class="line"><span class="comment">// String = 2 +: 3 +: 4 +: 1 +: Nil</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä½¿ç”¨<code>+:</code>æ¥<strong>æå–</strong>åºåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨æ”¾åˆ°headå’Œtailå˜é‡é‡Œï¼ŒSeqé‡Œä¹Ÿæœ‰headå’Œtailæ–¹æ³•ï¼Œå’Œè¿™é‡Œçš„æ˜¯ä¸ä¸€æ ·æ¦‚å¿µã€‚è¿”å›çš„å­—ç¬¦ä¸²æ˜¯å¤´éƒ¨åŠ å°¾éƒ¨çš„é€’å½’è°ƒç”¨è¿”å›çš„ç»“æœã€‚ä¸‹é¢æ˜¯ç”¨Nilæ¥åŒ¹é…ç©ºåºåˆ—ã€‚ä¸¤ä¸ªcaseè¯­å¥åŒ…å«äº†åºåˆ—å¯èƒ½å‡ºç°çš„æ‰€æœ‰å¯ä»¥åŒ¹é…çš„æƒ…å†µï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Œåºåˆ—è¦ä¹ˆåŒ…å«ä¸€ä¸ªä»¥ä¸Šçš„å…ƒç´ ï¼Œè¦ä¹ˆä¸ºç©ºï¼Œéç©ºçš„æ—¶å€™å¯ä»¥è°ƒç”¨<code>+:</code>ï¼ŒåŒ¹é…ç¬¬ä¸€ä¸ªcaseï¼Œç©ºçš„æ—¶å€™å°±åŒ¹é…ç¬¬äºŒä¸ªcaseï¼Œç›¸å½“äºåˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ã€‚<br><code>+:</code>å…¶å®æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªç±»å‹åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå³ç¼–è¯‘å™¨åœ¨caseè¯­å¥ä¸­ç”¨æ¥æå–æ•°æ®çš„unapplyæ–¹æ³•ï¼Œunapplyçš„ç¤ºæ„ï¼ˆéå®Œæ•´ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>[<span class="type">T</span>, <span class="type">Coll</span>](collection:<span class="type">Coll</span>):<span class="type">Option</span>[(<span class="type">T</span>, <span class="type">Coll</span>)]</div></pre></td></tr></table></figure>
<p>å¤´éƒ¨ç±»å‹è¢«æ¨æ–­ä¸ºTï¼Œå‰©ä½™éƒ¨åˆ†çš„ç±»å‹å’Œåºåˆ—æœ¬èº«ç±»å‹ä¸€è‡´ï¼ˆå¯èƒ½ä¸ºç©ºåºåˆ—ï¼‰ã€‚<code>case head +: tail =&gt; â€¦</code>æ˜¯ä¸­ç¼€è¡¨è¾¾å¼çš„å†™æ³•ï¼Œå¯¹åº”çš„å½¢å¼æ˜¯<code>case +:(head, tail)</code>ï¼ŒçœŸæ­£è°ƒç”¨æ˜¯<code>+:.unapply(collection)</code>ã€‚ç›¸å¯¹çš„ï¼Œä½¿ç”¨<code>:+</code>å¯ä»¥è¾¾åˆ°ç›¸åçš„æ•ˆæœï¼Œ<code>prefix :+ end</code>å‰åä¸¤ä¸ªå˜é‡åˆ†åˆ«æå–äº†å‰N-1ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚   </p>
<p>ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯Optionå‘¢ï¼Ÿå…¶å®è¿™æ˜¯ä¸ºäº†å…è®¸åœ¨è‡ªå®šä¹‰unapplyé‡Œè¿”å›éœ€è¦çš„å±æ€§ï¼Œå¯¹å¤–éšè—å†…éƒ¨çš„ç»†èŠ‚ï¼Œæ¯”å¦‚å¹´é¾„ã€ä½å€ä»€ä¹ˆçš„ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½è¿”å›Noneã€‚</p>
<h3 id="4ã€å…ƒç»„çš„åŒ¹é…"><a href="#4ã€å…ƒç»„çš„åŒ¹é…" class="headerlink" title="4ã€å…ƒç»„çš„åŒ¹é…"></a>4ã€å…ƒç»„çš„åŒ¹é…</h3><p>ç›´æ¥ä¸¾æ —å­æŠŠï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> langs = <span class="type">Seq</span>(</div><div class="line">  (<span class="string">"Scala"</span>, <span class="string">"Martin"</span>),</div><div class="line">  (<span class="string">"Clojure"</span>, <span class="string">"Rich"</span>),</div><div class="line">  (<span class="string">"Lisp"</span>, <span class="string">"John"</span>)</div><div class="line">)</div><div class="line"><span class="keyword">for</span> (tuple &lt;- langs) &#123;</div><div class="line">  tuple <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> (_, <span class="string">"Martin"</span>) =&gt; println(<span class="string">"found Scala"</span>)</div><div class="line">    <span class="keyword">case</span> (lang, name) =&gt; println(<span class="string">s"found other language:<span class="subst">$lang</span> (<span class="subst">$name</span>)"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŒ¹é…å…ƒç»„æ—¶å¯ä»¥åŒ¹é…ä¸€éƒ¨åˆ†ï¼Œlangå’Œnameéƒ½è¢«æ¨æ–­ä¸ºStringã€‚</p>
<h3 id="5ã€caseä¸­çš„guardè¯­å¥"><a href="#5ã€caseä¸­çš„guardè¯­å¥" class="headerlink" title="5ã€caseä¸­çš„guardè¯­å¥"></a>5ã€caseä¸­çš„guardè¯­å¥</h3><p>å’Œforæ¨å¯¼å¼ä¸­ä¸€æ ·ï¼Œcaseè¯­å¥ä¹Ÿå¯ä»¥æœ‰guardè¯­å¥ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (i &lt;- <span class="type">Seq</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)) &#123;</div><div class="line">  i <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> _ <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> =&gt; println(<span class="string">"even"</span>)</div><div class="line">    <span class="keyword">case</span> _               =&gt; println(<span class="string">"odd"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6ã€caseç±»çš„åŒ¹é…"><a href="#6ã€caseç±»çš„åŒ¹é…" class="headerlink" title="6ã€caseç±»çš„åŒ¹é…"></a>6ã€caseç±»çš„åŒ¹é…</h3><p>caseç±»çš„æˆå‘˜éƒ½æ˜¯valä¿®é¥°çš„ï¼Œæ‰€ä»¥ç±»çš„å¯¹è±¡å’Œå…ƒç»„æœ‰ç‚¹åƒã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span>(<span class="params">street:<span class="type">String</span>, city:<span class="type">String</span>, country:<span class="type">String</span></span>)</span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name:<span class="type">String</span>, age:<span class="type">Int</span>, address:<span class="type">Address</span></span>)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> alice = <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(<span class="string">"1 Lane"</span>, <span class="string">"Chicago"</span>, <span class="string">"USA"</span>))</div><div class="line"><span class="keyword">val</span> bob   = <span class="type">Person</span>(<span class="string">"Bob"</span>, <span class="number">33</span>, <span class="type">Address</span>(<span class="string">"2 Ave"</span>, <span class="string">"Miami"</span>, <span class="string">"USA"</span>))</div><div class="line"><span class="keyword">val</span> charlie = <span class="type">Person</span>(<span class="string">"Charlie"</span>, <span class="number">21</span>, <span class="type">Address</span>(<span class="string">"3 Ct"</span>, <span class="string">"Boston"</span>, <span class="string">"USA"</span>))</div><div class="line"></div><div class="line"><span class="keyword">for</span> (person &lt;- <span class="type">Seq</span>(alice, bob, charlie)) &#123;</div><div class="line">  person <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(_, <span class="string">"Chicago"</span>, _)) =&gt; println(<span class="string">"hi Alice"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(<span class="string">"Bob"</span>, <span class="number">33</span>, <span class="type">Address</span>(<span class="string">"2 Ave"</span>, <span class="string">"Miami"</span>, <span class="string">"USA"</span>)) =&gt; println(<span class="string">"hi bob"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">Person</span>(name, age, _) =&gt; println(<span class="string">s"who is <span class="subst">$name</span>, age is <span class="subst">$age</span>"</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå’ŒåŒ¹é…å…ƒç»„ç±»ä¼¼ï¼Œä¹Ÿç”¨äº†é€šé…ç¬¦ï¼ŒåŒ¹é…éœ€è¦çš„éƒ¨åˆ†ã€‚æœ€åä¸€æ¡åŒ¹é…å…¶ä½™çš„æƒ…å†µã€‚åŒ¹é…caseç±»çš„åŸç†ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†caseç±»çš„unapplyæ–¹æ³•ï¼Œè¿”å›Option[TupleN[ ]]ï¼ŒNè¡¨ç¤ºç±»é‡Œæˆå‘˜å˜é‡ä¸ªæ•°ã€‚</p>
<h3 id="7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…"><a href="#7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…" class="headerlink" title="7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…"></a>7ã€å¯å˜å‚æ•°åˆ—è¡¨çš„åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lists = <span class="type">Seq</span>(</div><div class="line">  <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),</div><div class="line">  <span class="type">List</span>(<span class="number">4</span>,<span class="number">5</span>)</div><div class="line">)</div><div class="line"><span class="keyword">for</span> (list &lt;- lists) &#123;</div><div class="line">  list <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">List</span>(_, _)         =&gt; println(<span class="string">"2 elements"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="type">List</span>(<span class="number">1</span>, vals @ _*) =&gt; println(<span class="string">"tail:"</span> + vals)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// tail:List(2, 3)</span></div><div class="line"><span class="comment">// 2 elements</span></div></pre></td></tr></table></figure>
<h3 id="8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…"><a href="#8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…" class="headerlink" title="8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…"></a>8ã€æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> bookRE = <span class="string">""</span><span class="string">"Book: title=([^,]+),\s+issue=(.+)"</span><span class="string">""</span>.r   <span class="comment">// åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</span></div><div class="line"><span class="keyword">val</span> catalog = <span class="string">"Book: title=Programming Scala, author=Deam Wampler"</span></div><div class="line"></div><div class="line">catalog <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> bookRE(title, author) =&gt; println(<span class="string">"title is $titile,author is $author"</span>)</div><div class="line">  <span class="keyword">case</span> notmatch              =&gt; println(<span class="string">"not match"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨titleå’Œauthoræ¥åœ¨åŒ¹é…çš„åŒæ—¶ï¼Œæå–å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´"><a href="#9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´" class="headerlink" title="9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´"></a>9ã€æ¨¡å¼åŒ¹é…çš„æ¼æ´</h3><p>è€ƒè™‘ä¸‹é¢çš„åŒ¹é…è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x match &#123;</div><div class="line">  case s1:Seq[Double] =&gt; println(&quot;Double&quot;)</div><div class="line">  case s2:Seq[String] =&gt; println(&quot;String&quot;)</div><div class="line">  case _              =&gt; println(&quot;unkonwn&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„åŒ¹é…è¯­å¥çœ‹ä¼¼æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå…¶å®ç¼–è¯‘ä¼šäº§ç”Ÿå‘Šè­¦ã€‚é—®é¢˜å‡ºåœ¨JVMçš„ç±»å‹æ“¦é™¤æœºåˆ¶ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨è®¤ä¸ºç¬¬äºŒä¸ªcaseè¯­å¥ä¸å¯è¾¾ã€‚æœ‰ä¸€ä¸ªä¸å¤ªç¾è§‚ä½†æœ‰æ•ˆçš„è§£å†³åŠæ³•ï¼Œå…ˆåŒ¹é…å¤´éƒ¨ï¼Œæ ¹æ®å¤´éƒ¨ç±»å‹åˆ¤æ–­æ€ä¹ˆå¤„ç†ï¼Œå¯¹ç©ºåˆ—è¡¨åˆ™å•ç‹¬å¤„ç†ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">x <span class="keyword">match</span> &#123;</div><div class="line">  <span class="keyword">case</span> <span class="type">Nil</span> =&gt; <span class="string">"nothing"</span></div><div class="line">  <span class="keyword">case</span> head +: _ =&gt; head <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> _:<span class="type">Double</span> =&gt; <span class="string">"do with double"</span></div><div class="line">    <span class="keyword">case</span> _:<span class="type">String</span> =&gt; <span class="string">"do with string"</span></div><div class="line">    <span class="keyword">case</span> _        =&gt; <span class="string">"un-matched"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="10ã€å…¶ä»–"><a href="#10ã€å…¶ä»–" class="headerlink" title="10ã€å…¶ä»–"></a>10ã€å…¶ä»–</h3><h4 id="1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…"><a href="#1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…" class="headerlink" title="1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…"></a>1ã€é¿å…ä½¿ç”¨æšä¸¾æ¥åŒ¹é…</h4><p>ç”¨æšä¸¾æ¥åŒ¹é…çš„åå¤„æ˜¯ç¼–è¯‘å™¨æ— æ³•åˆ¤å®šcaseè¯­å¥æ˜¯å¦ä»¥åŠå…¨è¦†ç›–ï¼Œåªæœ‰åˆ°äº†è¿è¡Œæ—¶æ‰ä¼šæŠ›å‡ºMatchErrorå¼‚å¸¸ã€‚</p>
<h4 id="2ã€æå–æƒ³è¦çš„å€¼"><a href="#2ã€æå–æƒ³è¦çš„å€¼" class="headerlink" title="2ã€æå–æƒ³è¦çš„å€¼"></a>2ã€æå–æƒ³è¦çš„å€¼</h4><p>ä»¥å‰é¢çš„Personå’ŒAddressä¸ºä¾‹ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> <span class="type">Persion</span>(name, age, <span class="type">Address</span>(_, state, _)) = <span class="type">Person</span>(<span class="string">"Alice"</span>, <span class="number">25</span>, <span class="type">Address</span>(<span class="string">"1 Lane"</span>, <span class="string">"Chicago"</span>, <span class="string">"USA"</span>))</div></pre></td></tr></table></figure>
<p>æƒ³è¦æå–çš„å€¼éƒ½ä¿æŒåœ¨å˜é‡nameã€ageç­‰å˜é‡é‡Œã€‚åŒæ ·å¯¹Listä¹Ÿå¯ä»¥æœ‰ç±»ä¼¼æ“ä½œï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> head +: tail = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// head = 1, tail:List[Int] = List(2,3)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> head1 +: head2 +: tail = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// head1 = 1, head2 = 2, tail = List(3)</span></div><div class="line"></div><div class="line"><span class="keyword">val</span> <span class="type">Seq</span>(a,b,c) = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line"><span class="comment">// a = 1, b = 2, c = 3</span></div></pre></td></tr></table></figure>
<p>å›é¡¾å‰é¢çš„ç”¨æ³•ï¼Œå¾ˆå¤šæ—¶å€™æ¨¡å¼åŒ¹é…éƒ½ä¼šç”¨æ¥æå–å¯¹åº”çš„å€¼ï¼Œå†è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-11T02:27:42.000Z"><a href="/2016/09/11/scala-for-comprehension/">2016-09-11</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/11/scala-for-comprehension/">Scalaçš„foræ¨å¯¼å¼</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“foræ¨å¯¼å¼çš„ç”¨æ³•å’Œå†…éƒ¨åŸç†ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<h3 id="1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•"><a href="#1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•" class="headerlink" title="1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•"></a>1ã€foræ¨å¯¼å¼çš„ä¸€èˆ¬ç”¨æ³•</h3><p>1 foræ¨å¯¼å¼åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª<strong>ç”Ÿæˆå™¨</strong>è¡¨è¾¾å¼ï¼Œå¤–åŠ å¯é€‰çš„<strong>ä¿æŠ¤è¡¨è¾¾å¼</strong>ï¼ˆç”¨äºè¿‡æ»¤è¯—å¥ï¼‰ã€‚<br>2 æ¨å¯¼å¼å¯ä»¥ç”¨äºç”Ÿæˆæ–°çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå…·æœ‰å‰¯ä½œç”¨çš„ä»£ç å—ï¼ˆæ‰“å°è¾“å‡ºï¼‰ã€‚<br>3 ç¤ºä¾‹ï¼Œç§»é™¤æ–‡æœ¬ä¸­çš„ç©ºè¡Œï¼š   </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">RemeoveBlanks</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(path:<span class="type">String</span>, compressWhiteSpace:<span class="type">Boolean</span>=<span class="literal">false</span>):<span class="type">Seq</span>[<span class="type">String</span>]=</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">      line &lt;- scala.io.<span class="type">Source</span>.fromFile(path).getLines.toSeq        <span class="comment">// 1</span></div><div class="line">      <span class="keyword">if</span> line.matches(<span class="string">""</span><span class="string">"^\s*$"</span><span class="string">""</span>) == <span class="literal">false</span>                        <span class="comment">// 2</span></div><div class="line">      line2 = <span class="keyword">if</span> (compressWhiteSpace) line replaceAll(<span class="string">"\\s+"</span>, <span class="string">" "</span>) <span class="comment">// 3</span></div><div class="line">              <span class="keyword">else</span> line</div><div class="line">    &#125; <span class="keyword">yield</span> line2                                                  <span class="comment">// 4</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args:<span class="type">Array</span>[<span class="type">String</span>]) = <span class="keyword">for</span> &#123;</div><div class="line">    path2 &lt;- args                                                  <span class="comment">// 5</span></div><div class="line">    (compress, path) = <span class="keyword">if</span> (path2 startWith <span class="string">"-"</span>) (<span class="literal">true</span>, path2.substring(<span class="number">1</span>))</div><div class="line">                       <span class="keyword">else</span> (<span class="literal">false</span>, path2)                         <span class="comment">// 6</span></div><div class="line">    line &lt;- apply(path, compress)</div><div class="line">  &#125; println(line)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ³¨é‡Šä¸­ï¼š<br>&emsp;&emsp;1ã€ getLinesè¿”å›çš„å¯¹è±¡æ˜¯scala.collection.Iteratorï¼Œæ— æ³•ç”¨äºforæ¨å¯¼å¼ï¼Œæ•…ä½¿ç”¨toSeqè½¬æ¢ä¸ºåºåˆ—ã€‚<br>&emsp;&emsp;2ã€ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å‡ºéç©ºç™½è¡Œã€‚<br>&emsp;&emsp;3ã€ å¦‚æœå‹ç¼©æ ‡è®°ä¸ºtrueï¼Œåˆ™å°†æ‰€æœ‰ç©ºç™½å­—ç¬¦æ›¿æ¢ä¸ºä¸€ä¸ªç©ºæ ¼ã€‚<br>&emsp;&emsp;4ã€ ä½¿ç”¨yieldè¿”å›å†…å®¹ã€‚<br>&emsp;&emsp;5ã€ å¯¹å‚æ•°é‡Œçš„æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚<br>&emsp;&emsp;6ã€ å¦‚æœæ–‡ä»¶è·¯å¾„ä»¥â€œ-â€å¼€å¤´ï¼Œåˆ™æ ‡è®°ä¸ºå‹ç¼©ç©ºç™½å­—ç¬¦ï¼Œå¦åˆ™ä¸å‹ç¼©ã€‚<br>&emsp;&emsp;1ã€3ã€5ã€6æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œ2æ˜¯ä¿æŠ¤è¡¨è¾¾å¼ã€‚</p>
<p>æ³¨æ„ï¼Œæ ‡è®°4ç”¨äº†yieldï¼Œè¡¨æ˜è¿”å›ç»“æœæ˜¯æƒ°æ€§çš„ï¼Œå¦‚æœè°ƒç”¨applyæ–¹æ³•è¿”å›ç»“æœé‡Œåªä¼šè®¡ç®—å‡ºå¤´éƒ¨ï¼Œåºåˆ—çš„å‰©ä½™éƒ¨åˆ†ï¼ˆç”¨?è¡¨ç¤ºï¼‰åªæœ‰ä½¿ç”¨åˆ°äº†æ‰ä¼šè®¡ç®—å‡ºæ¥ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> lines = <span class="type">RemeoveBlanks</span>.apply(<span class="string">"src/main/scala/for-comreh/test-file.txt"</span>)</div><div class="line">lines:<span class="type">Seq</span>[<span class="type">String</span>] = <span class="type">Stream</span>(test-content, ?)</div></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼å¤„ç†å¤§æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚å¦å¤–ï¼Œmainå’Œapplyé‡Œçš„foræ¨å¯¼å¼æ¯æ¬¡è¿­ä»£éƒ½ä¸ä¼šä¿å­˜çŠ¶æ€ï¼Œæ‰€ä»¥å†…å­˜é‡Œä¿å­˜çš„æ•°æ®ä¸ä¼šå¤šäºä¸€è¡Œã€‚</p>
<h3 id="2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶"><a href="#2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶" class="headerlink" title="2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶"></a>2ã€foræ¨å¯¼å¼ï¼šå†…éƒ¨æœºåˆ¶</h3><p>1 foræ¨å¯¼å¼çš„è¯­æ³•å®é™…æ˜¯ç¼–è¯‘å™¨çš„è¯­æ³•ç³–ï¼Œå®ƒä¼šè°ƒç”¨å®¹å™¨çš„foreachã€mapã€flatMapã€withFilteræ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ç°äº†è¿™å‡ ä¸ªæ–¹æ³•çš„å®¹å™¨éƒ½å¯ä»¥ç”¨äºforæ¨å¯¼å¼ã€‚<br>2 å…·ä½“æ€ä¹ˆè°ƒç”¨çš„ï¼Œçœ‹ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;s &lt;- states&#125; <span class="keyword">yield</span> s.toUpperCase</div><div class="line"><span class="comment">// List[String] = List(ALABAMA, ALASKA, VIRGINIA, WYOMING)</span></div><div class="line"></div><div class="line">states map (_.toUpperCase)</div><div class="line"><span class="comment">// List[String] = List(ALABAMA, ALASKA, VIRGINIA, WYOMING)</span></div></pre></td></tr></table></figure>
<p>ç”Ÿæˆå™¨è¡¨è¾¾å¼é‡ŒåŒ…å«äº†ä¸€æ¬¡mapæ“ä½œï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆå™¨è¡¨è¾¾å¼å†³å®šäº†æœ€ç»ˆçš„å®¹å™¨ç±»å‹ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªç”Ÿæˆå™¨çš„ç±»å‹æ˜¯List[String]ï¼Œè¿”å›çš„ç»“æœä¹Ÿæ˜¯List[String]ã€‚</p>
<p>3 å¦‚æœæœ‰å¤šä¸ªç”Ÿæˆå™¨æ—¶ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">&#125; <span class="keyword">yield</span> <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line"><span class="comment">// List(A-A, l-L, a-A, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq map (c =&gt; <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>))</div><div class="line"><span class="comment">// List(A-A, l-L, a-A, ...)</span></div></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªç”Ÿæˆå™¨ä¼šéå†å­—ç¬¦ä¸²sã€‚å¦‚æœæœ‰å¤šä¸ªç”Ÿæˆå™¨ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼Œå…¶ä»–ç”Ÿæˆå™¨ä¼šè¢«è½¬æ¢ä¸ºflatMapè°ƒç”¨ï¼Œæœ€åä¸€ä¸ªç”Ÿæˆå™¨åˆ™å¯¹åº”mapè°ƒç”¨ï¼Œä»è¾“å‡ºç»“æœå¯ä»¥è¯æ˜ã€‚</p>
<p>4 å¦‚æœå†æ·»åŠ ä¸€ä¸ªä¿æŠ¤ç”Ÿæˆå™¨ï¼Œä¼šåœ¨æœ€åmapè°ƒç”¨ä¹‹å‰æ’å…¥ä¸€æ¡withFilterè¯­å¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">  <span class="keyword">if</span> c.isLower</div><div class="line">&#125; <span class="keyword">yield</span> <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq withFilter (_.isLower) map (c =&gt; <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>))</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div></pre></td></tr></table></figure>
<p>5 æœ€åçœ‹ä¸‹åœ¨foræ¨å¯¼å¼é‡Œæ·»åŠ å˜é‡çš„æƒ…å†µï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> states = <span class="type">List</span>(<span class="string">"Alabama"</span>, <span class="string">"Alaska"</span>, <span class="string">"Virginia"</span>, <span class="string">"Wyoming"</span>)</div><div class="line"><span class="keyword">for</span>&#123;</div><div class="line">  s &lt;- states</div><div class="line">  c &lt;- s</div><div class="line">  <span class="keyword">if</span> c.isLower</div><div class="line">  c2 = <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span></div><div class="line">&#125; <span class="keyword">yield</span> c2</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div><div class="line"></div><div class="line">states flatMap (_.toSeq withFilter (_.isLower) map &#123;</div><div class="line">  <span class="keyword">val</span> c2 = <span class="string">s"<span class="subst">$c</span>-<span class="subst">$&#123;c.toUpper&#125;</span>"</span>)</div><div class="line">  c2</div><div class="line">&#125;</div><div class="line"><span class="comment">// List(l-L, a-A, b-B, ...)</span></div></pre></td></tr></table></figure>
<h3 id="3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™"><a href="#3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™" class="headerlink" title="3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™"></a>3ã€foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™</h3><p>1 é€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­å¤§æ¦‚å¯¹foræ¨å¯¼å¼è½¬åŒ–æˆå®¹å™¨æ–¹æ³•çš„è°ƒç”¨æœ‰äº†åˆæ­¥äº†è§£ï¼Œä¸‹é¢å°†è¯¦ç»†è®¨è®ºè½¬åŒ–çš„ç»†èŠ‚ã€‚<br>2 Scalaä¼šè¯†åˆ«è¡¨è¾¾å¼é‡Œçš„æ¨¡å¼è¡¨è¾¾å¼ã€‚åƒ<code>pat &lt;- expr</code>è¿™ç§å½¢å¼ï¼ŒScalaä¼šåœ¨foræ¨å¯¼å¼è½¬åŒ–æ—¶è½¬åŒ–ä¸ºï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat &lt;- expr</span></div><div class="line">pat &lt;- expr.withFilter &#123;<span class="keyword">case</span> pat =&gt; <span class="literal">true</span>; <span class="keyword">case</span> _ <span class="literal">false</span>&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åScalaä¼šé‡å¤ä¸Šè¿°åŠ¨ä½œï¼Œç›´åˆ°æ‰€æœ‰è¡¨è¾¾å¼è½¬åŒ–å®Œæˆã€‚å¦‚æœforæ¨å¯¼å¼åŒ…å«ä¸€ä¸ªç”Ÿæˆå™¨å’Œyieldè¡¨è¾¾å¼ï¼Œé‚£è¡¨è¾¾å¼ä¼šè¢«è½¬åŒ–ä¸ºï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat &lt;- expr1) yield expr2</span></div><div class="line">expr map &#123;<span class="keyword">case</span> pat =&gt; expr2&#125;</div></pre></td></tr></table></figure>
<p>åŒ…å«å¤šä¸ªè¡¨è¾¾å¼ç”Ÿæˆå™¨å’Œyieldè¯­å¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat1 &lt;- expr1; pat2 &lt;- expr2; ...) yield exprN</span></div><div class="line">expr1 flatMap &#123;<span class="keyword">case</span> pat1 =&gt; <span class="keyword">for</span> (pat2 &lt;- expr2) ... &#125; <span class="keyword">yield</span> exprN</div></pre></td></tr></table></figure>
<p>å…¶å®çœ‹åˆ°è¿™é‡Œå°±å’Œå‰é¢æœ‰ç‚¹åƒäº†ï¼Œå¤šä¸ªç”Ÿæˆå™¨ä¼šå…ˆflatMapè°ƒç”¨ï¼Œå†åšmapè°ƒç”¨ï¼ˆå‰©ä¸‹çš„ä¸€ä¸ªforç”Ÿæˆå™¨ï¼‰ã€‚ç„¶åä¿æŠ¤å¼çš„è½¬åŒ–å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat1 &lt;- expr1 if guard</span></div><div class="line">pat1 &lt;- expr1 withFilter ((arg1,arg2,...) =&gt; guard)</div></pre></td></tr></table></figure>
<p>ä¸Šé¢filterå‚æ•°åˆ—å‡ºäº†å¤šä¸ªï¼Œä¸è¿‡ä¸€èˆ¬éƒ½åªæœ‰ä¸€ä¸ªå‚æ•°ã€‚å¯¹å¤šä¸ªåŒ…å«å¤šä¸ªç”Ÿæˆå™¨çš„forå¾ªç¯å°†è¢«ç¿»è¯‘æˆï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// for (pat1 &lt;- expr1; pat2 &lt;- expr2; ...) exprN</span></div><div class="line">expr1 foreach &#123;<span class="keyword">case</span> pat1 =&gt; <span class="keyword">for</span> (pat2 &lt;- expr2 ... ) <span class="keyword">yield</span> exprN&#125;</div></pre></td></tr></table></figure>
<p>3 åœ¨çœ‹æœ€åä¸€ç§æƒ…å†µï¼Œç”Ÿæˆå™¨é‡ŒåŒ…å«å€¼å®šä¹‰å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªScalaçš„è¯­æ³•ã€‚   </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> z @ (x, y) = (<span class="number">1</span> -&gt; <span class="number">2</span>)</div><div class="line">z:(<span class="type">Int</span>, <span class="type">Int</span>) = (<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">x:<span class="type">Int</span> <span class="number">1</span></div><div class="line">y:<span class="type">Int</span> <span class="number">2</span></div></pre></td></tr></table></figure>
<p>å˜é‡zä¿å­˜å…ƒç»„çš„å€¼ï¼Œè€Œå˜é‡xå’Œyåˆ™å¯¹åº”å…ƒç»„å„ä¸ªéƒ¨åˆ†çš„å€¼ã€‚å¥½äº†è§£çš„è¿™ä¸ªè¯­æ³•ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªè½¬åŒ–ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// pat &lt;- expr1; pat2 = expr2</span></div><div class="line">(pat1, pat2) &lt;- <span class="keyword">for</span> &#123;        <span class="comment">// 1</span></div><div class="line">  x1 @ pat1 &lt;- expr1         <span class="comment">// 2</span></div><div class="line">&#125; <span class="keyword">yield</span> &#123;</div><div class="line">  <span class="keyword">val</span> x2 @ pat2 = expr2      <span class="comment">// 3</span></div><div class="line">  (x1, x2)                   <span class="comment">// 4</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&emsp;&emsp;1ã€foræ¨å¯¼å¼å°†è¿”å›åŒ…å«ä¸¤ä¸ªæ¨¡å¼çš„pairå¯¹è±¡ã€‚<br>&emsp;&emsp;2ã€x1 @ pat1 è¯­å¥å°†ä¼šæŠŠæ•´ä¸ªè¡¨è¾¾å¼ä¸­pat1æ‰€åŒ¹é…çš„å€¼èµ‹å€¼ç»™x1ï¼Œè¯¥å€¼ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸¤ä¸ªå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚<br>&emsp;&emsp;3ã€å°†pat2èµ‹å€¼ç»™x2ã€‚<br>&emsp;&emsp;4ã€è¿”å›å…ƒç»„ã€‚<br>4 ä¸¾ä¸ªå…·ä½“çš„è½¬åŒ–ä¾‹å­å§ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> map = <span class="type">Map</span>(<span class="string">"one"</span> -&gt; <span class="number">1</span>, <span class="string">"two"</span> -&gt; <span class="number">2</span>)</div><div class="line"><span class="keyword">val</span> list1 = <span class="keyword">for</span> &#123;</div><div class="line">  (key, value) &lt;- map</div><div class="line">  i10 = value + <span class="number">10</span></div><div class="line">&#125; <span class="keyword">yield</span> i10</div><div class="line"><span class="comment">// list1: scala.collection.immutable.Iterable[Int] = List(11, 12)</span></div><div class="line"></div><div class="line"><span class="comment">// ç¿»è¯‘åçš„è¯­å¥</span></div><div class="line"><span class="keyword">val</span> list2 = <span class="keyword">for</span> &#123;</div><div class="line">  (i, i10) &lt;- <span class="keyword">for</span> &#123;               <span class="comment">// foræ¨å¯¼å¼è¿”å›å…ƒç»„</span></div><div class="line">    x1 @ (key, value) &lt;- map      <span class="comment">// x1å°±æ˜¯ä¸€ä¸ªkey-valueçš„å…ƒç»„å¯¹è±¡</span></div><div class="line">  &#125; <span class="keyword">yield</span> &#123;</div><div class="line">    <span class="keyword">val</span> x2 @ i10 = value + <span class="number">10</span>     <span class="comment">// x2å’Œi10å€¼ä¸€æ ·</span></div><div class="line">    (x1, x2)                      <span class="comment">// è¿”å›x1ã€x2ï¼Œèµ‹å€¼ç»™(i, i10)</span></div><div class="line">  &#125;</div><div class="line">&#125; <span class="keyword">yield</span> (i10)                     <span class="comment">// å…¶å®æœ€åè¿”å›çš„æ˜¯i10ï¼Œå³x2çš„å€¼</span></div></pre></td></tr></table></figure>
<p>5 æœ€åï¼Œå†™äº†è¿™ä¹ˆå¤šforæ¨å¯¼å¼çš„å·¥ä½œåŸç†ï¼Œå…¶å®å°±æ˜¯å¯¹foræ¨å¯¼å¼å†…å®¹çš„è½¬åŒ–ï¼Œè½¬åŒ–æ—¶éµå¾ªä¸€å®šè§„åˆ™ï¼Œè½¬åŒ–æ—¶è°ƒç”¨å®¹å™¨çš„foreachã€mapã€flatmapã€withFilteræ–¹æ³•ï¼Œå…·ä½“çš„è§„åˆ™å¯èƒ½ä¸éœ€è¦æŒæ¡ï¼ŒçŸ¥é“æ˜¯æ€ä¹ˆå›äº‹å°±å¥½äº†ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-09-04T03:11:14.000Z"><a href="/2016/09/04/scala-option-and-others/">2016-09-04</a></time>
      
      
  
    <h1 class="title"><a href="/2016/09/04/scala-option-and-others/">Scalaçš„Optionä»¥åŠå…¶ä»–å®¹å™¨</a></h1>
  

    </header>
    <div class="entry">
      
        <p><em>æœ¬æ–‡ä¸»è¦æ€»ç»“Optionã€Eitherã€Tryå®¹å™¨ã€‚æœ€åç®€å•ä»‹ç»ä¸‹Scalaç¬¬ä¸‰æ–¹åº“çš„Validationç±»ã€‚<br> æœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠScalaç¨‹åºè®¾è®¡ã€‹[ç¾]Dean Wampler Alex Payneï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚</em></p>
<h3 id="1ã€Option-å®¹å™¨"><a href="#1ã€Option-å®¹å™¨" class="headerlink" title="1ã€Option å®¹å™¨"></a>1ã€Option å®¹å™¨</h3><ol>
<li>Optionå®¹å™¨æ¯”è¾ƒå¸¸è§ï¼ŒJava8å’ŒJavaç¬¬ä¸‰æ–¹åº“Guavaé‡Œéƒ½æœ‰ç±»ä¼¼çš„å®ç°ã€‚  </li>
<li>Scalaé‡Œå¸¸è§çš„å®¹å™¨åƒListã€Mapç­‰éƒ½å¯ä»¥ä½¿ç”¨foræ¨å¯¼å¼ï¼ŒScalaçš„foræ¨å¯¼å¼æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«å±•å¼€ä¸ºå¯¹foreachã€mapã€flatMapã€withFilterçš„è°ƒç”¨ï¼ŒOptionå®ç°äº†è¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨foræ¨å¯¼å¼ä¸­ä½¿ç”¨Optionå®¹å™¨ã€‚</li>
<li>Optionçš„APIå®šä¹‰ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Option</span>[+<span class="type">A</span>] </span>&#123; self =&gt;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isEmpty</span></span>: <span class="type">Boolean</span> <span class="comment">// å­ç±»ä¼šå®ç°è¿™ä¸ªå˜é‡</span></div><div class="line"></div><div class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">foreach</span></span>[<span class="type">U</span>](f:<span class="type">A</span> =&gt; <span class="type">U</span>): <span class="type">Unit</span> =</div><div class="line">    <span class="keyword">if</span> (!isEmpty) f(<span class="keyword">this</span>.get)</div><div class="line"></div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>sealed</code>å…³é”®å­—é™å®šå­ç±»å¿…é¡»å’Œçˆ¶ç±»åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œ<code>self</code>æ˜¯Optionçš„åˆ«åï¼Œ<code>final</code>é™åˆ¶å­ç±»é‡å†™ï¼Œå…¶ä½™æ–¹æ³•å®šä¹‰å’Œforeachç±»ä¼¼ã€‚</p>
<h3 id="2ã€Someå’ŒNone"><a href="#2ã€Someå’ŒNone" class="headerlink" title="2ã€Someå’ŒNone"></a>2ã€Someå’ŒNone</h3><ol>
<li>è¿™ä¸¤ä¸ªæ˜¯Optionçš„å­ç±»ï¼Œåˆ†åˆ«æ˜¯éç©ºå¯¹è±¡å’Œç©ºå¯¹è±¡ã€‚</li>
<li>ä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•ï¼Œåªæœ‰å½“Optionä¸ºéç©ºæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ä¼ å…¥çš„å‡½æ•°å‚æ•°ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿‡æ»¤å‡ºç»“æœé‡Œçš„éç©ºç»“æœã€‚åˆ†å¸ƒå¼ä»»åŠ¡æ”¶é›†ç»“æœä¹Ÿä¼šåˆ©ç”¨äº†è¿™ä¸ªç‰¹æ€§ã€‚</li>
<li>ç¤ºä¾‹ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> results: <span class="type">Seq</span>[<span class="type">Option</span>[<span class="type">Int</span>]] = <span class="type">Vector</span>(<span class="type">Some</span>(<span class="number">10</span>), <span class="type">Some</span>(<span class="number">20</span>), <span class="type">None</span>)</div><div class="line"><span class="keyword">val</span> results2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results</div><div class="line">&#125; <span class="keyword">yield</span> (<span class="number">2</span> * i)</div><div class="line"><span class="comment">// results2:Seq[Int] = Vector(20, 40)</span></div></pre></td></tr></table></figure>
<p><code>Some(i) &lt;- results</code>ä¼šå¯¹resultsé‡Œçš„å…ƒç´ è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œç§»é™¤Noneå…ƒç´ ï¼Œå¹¶æŠ½å–åŒ…å«çš„æ•°å€¼ã€‚åˆ©ç”¨foræ¨å¯¼å¼çš„è½¬åŒ–è§„åˆ™ï¼Œå¯ä»¥è½¬åŒ–ä¸ºï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">val</span> result2 = <span class="keyword">for</span> &#123;</div><div class="line">  <span class="type">Some</span>(i) &lt;- results withFilter &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; <span class="literal">true</span></div><div class="line">    <span class="keyword">case</span> <span class="type">None</span> =&gt; <span class="literal">false</span></div><div class="line">  &#125; map &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Some</span>(i) =&gt; (<span class="number">2</span> * i)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mapé‡Œçš„caseä¼šäº§ç”Ÿè­¦å‘Šï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œåœ¨withFilteré‡Œå·²ç»è¿‡æ»¤äº†Noneçš„æƒ…å†µï¼Œè¿è¡Œæ—¶ä»£ç ä¸ä¼šæŠ¥MatchErrorã€‚<br>åº”ç”¨ï¼šå¯¹ä¸€ç»„å€¼åšåˆæ³•æ€§æ£€æŸ¥ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Option</span>[<span class="type">Int</span>] = </div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Some</span>(i) <span class="keyword">else</span> <span class="type">None</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = Some(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>) <span class="comment">// ä¸€æ—¦è¿™é‡Œè¿”å›Noneï¼Œåç»­è¡¨è¾¾å¼ä¼šåœæ­¢æ‰§è¡Œï¼Œæ‰€ä»¥ä¸‹ä¸€å¥å¯ä»¥å¼•ç”¨i2å˜é‡</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šOption[Int] = None</span></div></pre></td></tr></table></figure>
<h3 id="3ã€Eitherå®¹å™¨"><a href="#3ã€Eitherå®¹å™¨" class="headerlink" title="3ã€Eitherå®¹å™¨"></a>3ã€Eitherå®¹å™¨</h3><ol>
<li>Optionå®¹å™¨çš„Noneæœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸èƒ½è¿”å›ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›å€¼ã€‚æ­¤æ—¶Eitheræ˜¯æ›¿ä»£Optionçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä¸å…¶å­—é¢æ„æ€ä¸€è‡´ï¼ŒOptionè¡¨ç¤ºå«æœ‰0æˆ–1ä¸ªå…ƒç´ ï¼ŒEitherè¡¨ç¤ºå«æœ‰è¿™ä¸ªæˆ–é‚£ä¸ªå…ƒç´ ã€‚  </li>
<li>Eitherçš„å®šä¹‰ï¼š<code>sealed abstract class Either[+A, +B] extends AnyRef</code>ï¼ŒAã€Bè¡¨ç¤ºEitherå¯¹è±¡å¯ä»¥æŒæœ‰çš„å¯¹è±¡ç±»å‹ï¼ˆå¯ä»¥ä¸åŒï¼‰ï¼ŒåŠ å·è¡¨ç¤ºå‚æ•°æ˜¯åå˜çš„ã€‚  </li>
<li>Eitheræœ‰ä¸¤ä¸ªå­ç±»ï¼Œ<code>Left[A]</code>å’Œ<code>Right[B]</code>ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå­ç±»ä»ä¸¤ä¸ªå¯èƒ½çš„å…ƒç´ ä¸­é€‰ä¸€ä¸ªã€‚Eitherçš„å†å²æ—©äºScalaï¼Œçº¦å®šç”¨Leftæ¥è¡¨ç¤ºé”™è¯¯ï¼ŒRightè¡¨ç¤ºæ­£å¸¸è¿”å›ç»“æœã€‚  </li>
<li>ç¤ºä¾‹ï¼šç”¨Eitheré‡å†™å‰é¢çš„ğŸŒ°ï¼š</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>) : <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Int</span>] =</div><div class="line">  <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Right</span>(i) <span class="keyword">else</span> <span class="type">Left</span>(<span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>).right</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">2</span>).right</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Right(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>).right</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>).right</div><div class="line">  i4 &lt;- positive(i3 * <span class="number">-2</span>).right <span class="comment">// å¤±è´¥</span></div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Either[String,Int] = Left(non-positive number -5)</span></div></pre></td></tr></table></figure>
<p>å’Œå‰é¢ä¸€æ ·ï¼Œä¸€æ—¦è°ƒç”¨<code>.right</code>è¿”å›çš„æ˜¯Leftç±»å‹æ—¶ï¼Œè°ƒç”¨ç»“æŸï¼Œåé¢çš„ä¸å†æ‰§è¡Œã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œç›®å‰æ¥çœ‹ï¼ŒLeftå’ŒRightéƒ½å¯ä»¥è°ƒç”¨<code>left</code>å’Œ<code>right</code>æ–¹æ³•ï¼Œåˆ†åˆ«è¿”å›LeftProjectionå’ŒRightProjectionå®ä¾‹ï¼Œä½†å†å¯¹LeftProjectionå’ŒRightProjectionå–å€¼æ—¶ï¼Œforæ¨å¯¼å¼å¯ä»¥è‡ªå·±æ¨å¯¼å‡ºæ¥ã€‚æ¯”å¦‚ï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> <span class="type">L</span> = <span class="type">Left</span>(<span class="number">33</span>)</div><div class="line"><span class="keyword">val</span> left = <span class="type">L</span>.left      <span class="comment">// left = LeftProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> lvalue = left.get  <span class="comment">// lvalue = 33</span></div><div class="line"><span class="keyword">val</span> right = <span class="type">L</span>.right    <span class="comment">// right = RightProjection(Left(33))</span></div><div class="line"><span class="keyword">val</span> rvalue = right.get <span class="comment">// NoSuchElementException</span></div></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹2ï¼Œå¯¹äºå‡ºç°å¼‚å¸¸çš„æƒ…å†µï¼Œå¯ä»¥å°†å¼‚å¸¸åˆ—åœ¨è¿”å›å€¼çš„Eitherå·¦å€¼é‡Œï¼Œä¸å†é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ•è·è°ƒç”¨å †æ ˆä¸­æŸäº›åº”ç”¨çš„æ§åˆ¶æƒï¼ŒåŒæ—¶è°ƒç”¨è€…æ›´èƒ½æ˜ç™½APIçš„å«ä¹‰ã€‚<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">addInts</span></span>(s1: <span class="type">String</span>, s2: <span class="type">String</span>): <span class="type">Either</span>[<span class="type">NumberFormatException</span>,<span class="type">Int</span>] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="type">Right</span>(s1.toInt + s2.toInt)</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> nfe: <span class="type">NumberFormatException</span> =&gt; <span class="type">Left</span>(nfe)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">println(addInts(<span class="string">"11"</span>, <span class="string">"22"</span>)) <span class="comment">// Right(33)</span></div><div class="line">println(addInts(<span class="string">"f"</span>, <span class="string">"33"</span>))  <span class="comment">// Left(java.lang.NumberFormatException: For input string: "f")</span></div></pre></td></tr></table></figure></p>
<h3 id="4ã€Tryå®¹å™¨"><a href="#4ã€Tryå®¹å™¨" class="headerlink" title="4ã€Tryå®¹å™¨"></a>4ã€Tryå®¹å™¨</h3><ol>
<li>scala.util.Tryçš„ç»“æ„å’ŒEitherç±»ä¼¼ï¼Œæœ‰ä¸¤ä¸ªå­ç±»Successå’ŒFailureï¼ŒSuccessä¸Rightç›¸ä¼¼ï¼Œä¿å­˜æ­£å¸¸çš„è¿”å›å€¼ï¼ŒFailureä¸Leftç›¸ä¼¼ï¼Œä½†æ€»æ˜¯åŒ…å«Throwableå¯¹è±¡ï¼Œæ‰€ä»¥Tryçš„å®šä¹‰åªæœ‰ä¸€ä¸ªæ³›å‹å‚æ•°ï¼š<code>sealed abstract class Try[+T] extends AnyRef</code>ã€‚</li>
<li>ç¤ºä¾‹ï¼šä»ä¸€ç»„Tryå€¼ä¸­ï¼Œè¿‡æ»¤æ‰Failureå¯¹è±¡ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scala.util.&#123;<span class="type">Try</span>, <span class="type">Success</span>, <span class="type">Failure</span>&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(i: <span class="type">Int</span>): <span class="type">Try</span>[<span class="type">Int</span>] = <span class="type">Try</span> &#123;</div><div class="line">  assert(i &gt; <span class="number">0</span>, <span class="string">s"non-positive number <span class="subst">$i</span>"</span>)</div><div class="line">  i</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">10</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Success(3805)</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">  i1 &lt;- positive(<span class="number">5</span>)</div><div class="line">  i2 &lt;- positive(i1 * <span class="number">-1</span>)</div><div class="line">  i3 &lt;- positive(i2 * <span class="number">25</span>)</div><div class="line">  i3 &lt;- positive(i3 * <span class="number">-2</span>)</div><div class="line">&#125; <span class="keyword">yield</span>(i1 + i2 + i3 + i4)</div><div class="line"><span class="comment">// ç»“æœï¼šscala.util.Try[Int] = Failure(java.lang.AssertionError: assert failed: non-positive number -5)</span></div></pre></td></tr></table></figure>
<h3 id="5ã€Scalazæä¾›çš„Validationç±»"><a href="#5ã€Scalazæä¾›çš„Validationç±»" class="headerlink" title="5ã€Scalazæä¾›çš„Validationç±»"></a>5ã€Scalazæä¾›çš„Validationç±»</h3><ol>
<li>ä»¥ä¸Šä»‹ç»çš„å®¹å™¨ï¼Œåœ¨foræ¨åˆ°ä¸­é‡åˆ°ä¸æ»¡è¶³æƒ…å†µä¼šç«‹å³åœæ­¢ï¼Œå¦‚æœæƒ³æ”¶é›†æ‰€æœ‰æ‰€æœ‰æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼Œå¹¶åˆ¤æ–­åé¢æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œå…¸å‹çš„åœºæ™¯å°±æ˜¯éªŒè¯ç½‘é¡µè¡¨å•ï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡å°†æ‰€æœ‰é”™è¯¯ä¿¡æ¯è¿”å›ã€‚Scalaæ ‡å‡†åº“æ— æ³•æä¾›è¿™æ ·çš„åŠŸèƒ½ï¼Œç¬¬ä¸‰æ–¹åº“Scalazæä¾›äº†Validationæ»¡è¶³è¿™ç§éœ€æ±‚ã€‚</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scalaz._, std.<span class="type">AllInstance</span>._</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validName</span></span>(key: <span class="type">String</span>, name: <span class="type">String</span>): </div><div class="line">        <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">val</span> n = name.trim</div><div class="line">  <span class="keyword">if</span> (n.length &gt; <span class="number">0</span> &amp;&amp; n.matches(<span class="string">""</span><span class="string">"^\p&#123;Alpha&#125;$"</span><span class="string">""</span>)) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; n))</div><div class="line">  <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> &lt;<span class="subst">$n</span>&gt;"</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">positive</span></span>(key: <span class="type">String</span>, n: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">val</span> i = n.toInt</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="type">Success</span>(<span class="type">List</span>(key -&gt; i))</div><div class="line">    <span class="keyword">else</span> <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"Invalid <span class="subst">$key</span> <span class="subst">$i</span>"</span>))</div><div class="line">  &#125; <span class="keyword">catch</span> &#123;</div><div class="line">    <span class="keyword">case</span> _: java.lang.<span class="type">NumberFormatException</span> =&gt; <span class="type">Failure</span>(<span class="type">List</span>(<span class="string">s"<span class="subst">$n</span> is not a Integer"</span>))</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validForm</span></span>(firstName: <span class="type">String</span>, lastName: <span class="type">String</span>, age: <span class="type">String</span>): </div><div class="line">      <span class="type">Validation</span>[<span class="type">List</span>[<span class="type">String</span>], <span class="type">List</span>[(<span class="type">String</span>, <span class="type">Any</span>)]] = &#123;</div><div class="line">  validName(<span class="string">"first-name"</span>, firstName) </div><div class="line">  +++ validName(<span class="string">"last-name"</span>, lastName) </div><div class="line">  +++ positive(<span class="string">"age"</span>, age)</div><div class="line">&#125;</div><div class="line"></div><div class="line">validForm(<span class="string">"Dean"</span>, <span class="string">"Wampler"</span>, <span class="string">"29"</span>)</div><div class="line"><span class="comment">// Success(List((first-name,Dean),(last-name,Wampler),(age,29)))</span></div><div class="line"></div><div class="line">validForm(<span class="string">""</span>, <span class="string">"Wampler"</span>, <span class="string">"0"</span>)</div><div class="line"><span class="comment">// Failure(List(Invalid first-name &lt;&gt;, Invalid age 0))</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„Successå’ŒFailureå’ŒTryçš„ä¸¤ä¸ªå­ç±»ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">NÃ¤chste Seite</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 Ling0fa çš„åšå®¢
  
  <p>Theme by <a href="https://caisiduo.xyz" target="_blank">LightOne</a></p>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
